/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, ChangeDetectorRef, EventEmitter, ElementRef, HostBinding, Input, Output, ContentChild, forwardRef, } from '@angular/core';
import { AnimationBuilder, useAnimation } from '@angular/animations';
import { growVerOut, growVerIn } from '../animations/main';
import { IgxExpansionPanelBodyComponent } from './expansion-panel-body.component';
import { IgxExpansionPanelHeaderComponent } from './expansion-panel-header.component';
var /** @type {?} */ NEXT_ID = 0;
var IgxExpansionPanelComponent = /** @class */ (function () {
    function IgxExpansionPanelComponent(cdr, elementRef, builder) {
        this.cdr = cdr;
        this.elementRef = elementRef;
        this.builder = builder;
        this.animationSettings = {
            openAnimation: growVerIn,
            closeAnimation: growVerOut
        };
        /**
         * Sets/gets the `id` of the expansion panel component.
         * If not set, `id` will have value `"igx-expansion-panel-0"`;
         * ```html
         * <igx-expansion-panel id = "my-first-expansion-panel"></igx-expansion-panel>
         * ```
         * ```typescript
         * let panelId =  this.panel.id;
         * ```
         * \@memberof IgxExpansionPanelComponent
         */
        this.id = "igx-expansion-panel-" + NEXT_ID++;
        this.cssClass = 'igx-expansion-panel';
        this.collapsed = true;
        this.onCollapsed = new EventEmitter();
        this.onExpanded = new EventEmitter();
    }
    Object.defineProperty(IgxExpansionPanelComponent.prototype, "headerId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.header ? this.id + "-header" : '';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} cb
     * @return {?}
     */
    IgxExpansionPanelComponent.prototype.playOpenAnimation = /**
     * @param {?} cb
     * @return {?}
     */
    function (cb) {
        if (!this.body) {
            // if not body element is passed, there is nothing to animate
            return;
        }
        var /** @type {?} */ animation = useAnimation(this.animationSettings.openAnimation);
        var /** @type {?} */ animationBuilder = this.builder.build(animation);
        var /** @type {?} */ openAnimationPlayer = animationBuilder.create(this.body.element.nativeElement);
        openAnimationPlayer.onDone(function () {
            cb();
            openAnimationPlayer.reset();
        });
        openAnimationPlayer.play();
    };
    /**
     * @param {?} cb
     * @return {?}
     */
    IgxExpansionPanelComponent.prototype.playCloseAnimation = /**
     * @param {?} cb
     * @return {?}
     */
    function (cb) {
        if (!this.body) {
            // if not body element is passed, there is nothing to animate
            return;
        }
        var /** @type {?} */ animation = useAnimation(this.animationSettings.closeAnimation);
        var /** @type {?} */ animationBuilder = this.builder.build(animation);
        var /** @type {?} */ closeAnimationPlayer = animationBuilder.create(this.body.element.nativeElement);
        closeAnimationPlayer.onDone(function () {
            cb();
            closeAnimationPlayer.reset();
        });
        closeAnimationPlayer.play();
    };
    /**
     * @param {?=} evt
     * @return {?}
     */
    IgxExpansionPanelComponent.prototype.collapse = /**
     * @param {?=} evt
     * @return {?}
     */
    function (evt) {
        var _this = this;
        this.playCloseAnimation(function () {
            _this.onCollapsed.emit({ event: evt, panel: _this });
            _this.collapsed = true;
        });
    };
    /**
     * @param {?=} evt
     * @return {?}
     */
    IgxExpansionPanelComponent.prototype.expand = /**
     * @param {?=} evt
     * @return {?}
     */
    function (evt) {
        var _this = this;
        this.collapsed = false;
        this.cdr.detectChanges();
        this.playOpenAnimation(function () {
            _this.onExpanded.emit({ event: evt, panel: _this });
        });
    };
    /**
     * @param {?=} evt
     * @return {?}
     */
    IgxExpansionPanelComponent.prototype.toggle = /**
     * @param {?=} evt
     * @return {?}
     */
    function (evt) {
        if (this.collapsed) {
            this.expand(evt);
        }
        else {
            this.collapse(evt);
        }
    };
    IgxExpansionPanelComponent.decorators = [
        { type: Component, args: [{
                    selector: 'igx-expansion-panel',
                    template: "<ng-content select=\"igx-expansion-panel-header\"></ng-content>\n<ng-content *ngIf=\"!collapsed\" select=\"igx-expansion-panel-body\"></ng-content>\n"
                },] },
    ];
    /** @nocollapse */
    IgxExpansionPanelComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef, },
        { type: ElementRef, },
        { type: AnimationBuilder, },
    ]; };
    IgxExpansionPanelComponent.propDecorators = {
        "animationSettings": [{ type: Input },],
        "id": [{ type: HostBinding, args: ['attr.id',] }, { type: Input },],
        "cssClass": [{ type: HostBinding, args: ['class.igx-expansion-panel',] },],
        "collapsed": [{ type: Input },],
        "onCollapsed": [{ type: Output },],
        "onExpanded": [{ type: Output },],
        "body": [{ type: ContentChild, args: [forwardRef(function () { return IgxExpansionPanelBodyComponent; }), { read: IgxExpansionPanelBodyComponent },] },],
        "header": [{ type: ContentChild, args: [forwardRef(function () { return IgxExpansionPanelHeaderComponent; }), { read: IgxExpansionPanelHeaderComponent },] },],
    };
    return IgxExpansionPanelComponent;
}());
export { IgxExpansionPanelComponent };
function IgxExpansionPanelComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    IgxExpansionPanelComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    IgxExpansionPanelComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    IgxExpansionPanelComponent.propDecorators;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.animationSettings;
    /**
     * Sets/gets the `id` of the expansion panel component.
     * If not set, `id` will have value `"igx-expansion-panel-0"`;
     * ```html
     * <igx-expansion-panel id = "my-first-expansion-panel"></igx-expansion-panel>
     * ```
     * ```typescript
     * let panelId =  this.panel.id;
     * ```
     * \@memberof IgxExpansionPanelComponent
     * @type {?}
     */
    IgxExpansionPanelComponent.prototype.id;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.cssClass;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.collapsed;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.onCollapsed;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.onExpanded;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.body;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.header;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.cdr;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.elementRef;
    /** @type {?} */
    IgxExpansionPanelComponent.prototype.builder;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwYW5zaW9uLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lnbml0ZXVpLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvZXhwYW5zaW9uLXBhbmVsL2V4cGFuc2lvbi1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsR0FDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQThCLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pHLE9BQU8sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDM0QsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGdDQUFnQyxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFdEYscUJBQUksT0FBTyxHQUFHLENBQUMsQ0FBQzs7SUE4Q1osb0NBQ1csS0FDQSxZQUNDO1FBRkQsUUFBRyxHQUFILEdBQUc7UUFDSCxlQUFVLEdBQVYsVUFBVTtRQUNULFlBQU8sR0FBUCxPQUFPO2lDQXRDbUc7WUFDbEgsYUFBYSxFQUFFLFNBQVM7WUFDeEIsY0FBYyxFQUFFLFVBQVU7U0FDN0I7Ozs7Ozs7Ozs7OztrQkFlVyx5QkFBdUIsT0FBTyxFQUFJO3dCQUc1QixxQkFBcUI7eUJBR3BCLElBQUk7MkJBR0YsSUFBSSxZQUFZLEVBQU87MEJBR3hCLElBQUksWUFBWSxFQUFPO0tBUUQ7MEJBTi9CLGdEQUFROzs7OztZQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBSSxJQUFJLENBQUMsRUFBRSxZQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQzs7Ozs7Ozs7O0lBYzFD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QUdMLE1BQU07K0JBR04sTUFBTTt5QkFXTixZQUFZLFNBQUMsVUFBVSxDQUFDLGNBQU0sT0FBQSw4QkFBOEIsRUFBOUIsQ0FBOEIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLDhCQUE4QixFQUFFOzJCQUd2RyxZQUFZLFNBQUMsVUFBVSxDQUFDLGNBQU0sT0FBQSxnQ0FBZ0MsRUFBaEMsQ0FBZ0MsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGdDQUFnQyxFQUFFOztxQ0F0RWhIOztTQXdCYSwwQkFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIENvbXBvbmVudCxcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgRWxlbWVudFJlZixcbiAgICBIb3N0QmluZGluZyxcbiAgICBJbnB1dCxcbiAgICBPdXRwdXQsXG4gICAgQ29udGVudENoaWxkLFxuICAgIGZvcndhcmRSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQW5pbWF0aW9uQnVpbGRlciwgQW5pbWF0aW9uUmVmZXJlbmNlTWV0YWRhdGEsIHVzZUFuaW1hdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgZ3Jvd1Zlck91dCwgZ3Jvd1ZlckluIH0gZnJvbSAnLi4vYW5pbWF0aW9ucy9tYWluJztcbmltcG9ydCB7IElneEV4cGFuc2lvblBhbmVsQm9keUNvbXBvbmVudCB9IGZyb20gJy4vZXhwYW5zaW9uLXBhbmVsLWJvZHkuY29tcG9uZW50JztcbmltcG9ydCB7IElneEV4cGFuc2lvblBhbmVsSGVhZGVyQ29tcG9uZW50IH0gZnJvbSAnLi9leHBhbnNpb24tcGFuZWwtaGVhZGVyLmNvbXBvbmVudCc7XG5cbmxldCBORVhUX0lEID0gMDtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdpZ3gtZXhwYW5zaW9uLXBhbmVsJyxcbiAgICB0ZW1wbGF0ZTogYDxuZy1jb250ZW50IHNlbGVjdD1cImlneC1leHBhbnNpb24tcGFuZWwtaGVhZGVyXCI+PC9uZy1jb250ZW50PlxuPG5nLWNvbnRlbnQgKm5nSWY9XCIhY29sbGFwc2VkXCIgc2VsZWN0PVwiaWd4LWV4cGFuc2lvbi1wYW5lbC1ib2R5XCI+PC9uZy1jb250ZW50PlxuYFxufSlcbmV4cG9ydCBjbGFzcyBJZ3hFeHBhbnNpb25QYW5lbENvbXBvbmVudCB7XG5cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBhbmltYXRpb25TZXR0aW5nczogeyBvcGVuQW5pbWF0aW9uOiBBbmltYXRpb25SZWZlcmVuY2VNZXRhZGF0YSwgY2xvc2VBbmltYXRpb246IEFuaW1hdGlvblJlZmVyZW5jZU1ldGFkYXRhIH0gPSB7XG4gICAgICAgIG9wZW5BbmltYXRpb246IGdyb3dWZXJJbixcbiAgICAgICAgY2xvc2VBbmltYXRpb246IGdyb3dWZXJPdXRcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2V0cy9nZXRzIHRoZSBgaWRgIG9mIHRoZSBleHBhbnNpb24gcGFuZWwgY29tcG9uZW50LlxuICAgICAqIElmIG5vdCBzZXQsIGBpZGAgd2lsbCBoYXZlIHZhbHVlIGBcImlneC1leHBhbnNpb24tcGFuZWwtMFwiYDtcbiAgICAgKiBgYGBodG1sXG4gICAgICogPGlneC1leHBhbnNpb24tcGFuZWwgaWQgPSBcIm15LWZpcnN0LWV4cGFuc2lvbi1wYW5lbFwiPjwvaWd4LWV4cGFuc2lvbi1wYW5lbD5cbiAgICAgKiBgYGBcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogbGV0IHBhbmVsSWQgPSAgdGhpcy5wYW5lbC5pZDtcbiAgICAgKiBgYGBcbiAgICAgKiBAbWVtYmVyb2YgSWd4RXhwYW5zaW9uUGFuZWxDb21wb25lbnRcbiAgICAgKi9cbiAgICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGlkID0gYGlneC1leHBhbnNpb24tcGFuZWwtJHtORVhUX0lEKyt9YDtcblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MuaWd4LWV4cGFuc2lvbi1wYW5lbCcpXG4gICAgcHVibGljIGNzc0NsYXNzID0gJ2lneC1leHBhbnNpb24tcGFuZWwnO1xuXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgY29sbGFwc2VkID0gdHJ1ZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHB1YmxpYyBvbkNvbGxhcHNlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgcHVibGljIG9uRXhwYW5kZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIHB1YmxpYyBnZXQgaGVhZGVySWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhlYWRlciA/IGAke3RoaXMuaWR9LWhlYWRlcmAgOiAnJztcbiAgICB9XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHB1YmxpYyBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBwdWJsaWMgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgcHJpdmF0ZSBidWlsZGVyOiBBbmltYXRpb25CdWlsZGVyKSB7IH1cblxuICAgIEBDb250ZW50Q2hpbGQoZm9yd2FyZFJlZigoKSA9PiBJZ3hFeHBhbnNpb25QYW5lbEJvZHlDb21wb25lbnQpLCB7IHJlYWQ6IElneEV4cGFuc2lvblBhbmVsQm9keUNvbXBvbmVudCB9KVxuICAgIHB1YmxpYyBib2R5OiBJZ3hFeHBhbnNpb25QYW5lbEJvZHlDb21wb25lbnQ7XG5cbiAgICBAQ29udGVudENoaWxkKGZvcndhcmRSZWYoKCkgPT4gSWd4RXhwYW5zaW9uUGFuZWxIZWFkZXJDb21wb25lbnQpLCB7IHJlYWQ6IElneEV4cGFuc2lvblBhbmVsSGVhZGVyQ29tcG9uZW50IH0pXG4gICAgcHVibGljIGhlYWRlcjogSWd4RXhwYW5zaW9uUGFuZWxIZWFkZXJDb21wb25lbnQ7XG5cblxuICAgIHByaXZhdGUgcGxheU9wZW5BbmltYXRpb24oY2I6ICgpID0+IHZvaWQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmJvZHkpIHsgLy8gaWYgbm90IGJvZHkgZWxlbWVudCBpcyBwYXNzZWQsIHRoZXJlIGlzIG5vdGhpbmcgdG8gYW5pbWF0ZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IHVzZUFuaW1hdGlvbih0aGlzLmFuaW1hdGlvblNldHRpbmdzLm9wZW5BbmltYXRpb24pO1xuICAgICAgICBjb25zdCBhbmltYXRpb25CdWlsZGVyID0gdGhpcy5idWlsZGVyLmJ1aWxkKGFuaW1hdGlvbik7XG4gICAgICAgIGNvbnN0IG9wZW5BbmltYXRpb25QbGF5ZXIgPSBhbmltYXRpb25CdWlsZGVyLmNyZWF0ZSh0aGlzLmJvZHkuZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcblxuICAgICAgICBvcGVuQW5pbWF0aW9uUGxheWVyLm9uRG9uZSgoKSA9PiB7XG4gICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgb3BlbkFuaW1hdGlvblBsYXllci5yZXNldCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBvcGVuQW5pbWF0aW9uUGxheWVyLnBsYXkoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBsYXlDbG9zZUFuaW1hdGlvbihjYjogKCkgPT4gdm9pZCkge1xuICAgICAgICBpZiAoIXRoaXMuYm9keSkgeyAvLyBpZiBub3QgYm9keSBlbGVtZW50IGlzIHBhc3NlZCwgdGhlcmUgaXMgbm90aGluZyB0byBhbmltYXRlXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYW5pbWF0aW9uID0gdXNlQW5pbWF0aW9uKHRoaXMuYW5pbWF0aW9uU2V0dGluZ3MuY2xvc2VBbmltYXRpb24pO1xuICAgICAgICBjb25zdCBhbmltYXRpb25CdWlsZGVyID0gdGhpcy5idWlsZGVyLmJ1aWxkKGFuaW1hdGlvbik7XG4gICAgICAgIGNvbnN0IGNsb3NlQW5pbWF0aW9uUGxheWVyID0gYW5pbWF0aW9uQnVpbGRlci5jcmVhdGUodGhpcy5ib2R5LmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGNsb3NlQW5pbWF0aW9uUGxheWVyLm9uRG9uZSgoKSA9PiB7XG4gICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgY2xvc2VBbmltYXRpb25QbGF5ZXIucmVzZXQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2xvc2VBbmltYXRpb25QbGF5ZXIucGxheSgpO1xuICAgIH1cblxuICAgIGNvbGxhcHNlKGV2dD86IEV2ZW50KSB7XG4gICAgICAgIHRoaXMucGxheUNsb3NlQW5pbWF0aW9uKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub25Db2xsYXBzZWQuZW1pdCh7IGV2ZW50OiBldnQsIHBhbmVsOiB0aGlzIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGFwc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBleHBhbmQoZXZ0PzogRXZlbnQpIHtcbiAgICAgICAgdGhpcy5jb2xsYXBzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB0aGlzLnBsYXlPcGVuQW5pbWF0aW9uKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub25FeHBhbmRlZC5lbWl0KHsgZXZlbnQ6IGV2dCwgcGFuZWw6IHRoaXMgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgdG9nZ2xlKGV2dD86IEV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmNvbGxhcHNlZCkge1xuICAgICAgICAgICAgdGhpcy5leHBhbmQoZXZ0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29sbGFwc2UoZXZ0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==