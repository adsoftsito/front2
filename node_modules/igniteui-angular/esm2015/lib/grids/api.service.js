/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { cloneArray, isEqual, mergeObjects } from '../core/utils';
import { DataUtil, DataType } from '../data-operations/data-util';
import { SortingDirection } from '../data-operations/sorting-expression.interface';
import { FilteringExpressionsTree } from '../data-operations/filtering-expressions-tree';
import { TransactionType } from '../services/index';
// unsupported: template constraints.
/**
 * @hidden
 * @template T
 */
export class GridBaseAPIService {
    constructor() {
        this.change = new Subject();
        this.state = new Map();
        this.editCellState = new Map();
        this.editRowState = new Map();
        this.summaryCacheMap = new Map();
        this.destroyMap = new Map();
    }
    /**
     * @param {?} grid
     * @return {?}
     */
    register(grid) {
        this.state.set(grid.id, grid);
        this.destroyMap.set(grid.id, new Subject());
    }
    /**
     * @param {?} grid
     * @return {?}
     */
    unsubscribe(grid) {
        this.state.delete(grid.id);
    }
    /**
     * @param {?} id
     * @return {?}
     */
    get(id) {
        return this.state.get(id);
    }
    /**
     * @param {?} id
     * @return {?}
     */
    unset(id) {
        this.state.delete(id);
        this.summaryCacheMap.delete(id);
        this.editCellState.delete(id);
        this.editRowState.delete(id);
        this.destroyMap.delete(id);
    }
    /**
     * @param {?} oldId
     * @param {?} newId
     * @return {?}
     */
    reset(oldId, newId) {
        const /** @type {?} */ destroy = this.destroyMap.get(oldId);
        const /** @type {?} */ summary = this.summaryCacheMap.get(oldId);
        const /** @type {?} */ editCellState = this.editCellState.get(oldId);
        const /** @type {?} */ editRowState = this.editRowState.get(oldId);
        const /** @type {?} */ grid = this.get(oldId);
        this.unset(oldId);
        if (grid) {
            this.state.set(newId, grid);
        }
        if (destroy) {
            this.destroyMap.set(newId, destroy);
        }
        if (summary) {
            this.summaryCacheMap.set(newId, summary);
        }
        if (editCellState) {
            this.editCellState.set(newId, editCellState);
        }
        if (editRowState) {
            this.editRowState.set(newId, editRowState);
        }
    }
    /**
     * @param {?} id
     * @param {?} name
     * @return {?}
     */
    get_column_by_name(id, name) {
        return this.get(id).columnList.find((col) => col.field === name);
    }
    /**
     * @param {?} id
     * @param {?} name
     * @return {?}
     */
    set_summary_by_column_name(id, name) {
        if (!this.summaryCacheMap.get(id)) {
            this.summaryCacheMap.set(id, new Map());
        }
        const /** @type {?} */ column = this.get_column_by_name(id, name);
        const /** @type {?} */ grid = this.get(id);
        let /** @type {?} */ data = grid.filteredData;
        if (!data) {
            if (grid.transactions.enabled) {
                data = DataUtil.mergeTransactions(cloneArray(grid.data), grid.transactions.getAggregatedChanges(true), grid.primaryKey);
            }
            else {
                data = grid.data;
            }
        }
        if (data) {
            const /** @type {?} */ columnValues = data.map((rec) => rec[column.field]);
            this.calculateSummaries(id, column, columnValues);
        }
    }
    /**
     * @param {?} id
     * @return {?}
     */
    get_summaries(id) {
        return this.summaryCacheMap.get(id);
    }
    /**
     * @param {?} id
     * @param {?=} name
     * @return {?}
     */
    remove_summary(id, name) {
        if (this.summaryCacheMap.has(id)) {
            if (!name) {
                this.summaryCacheMap.delete(id);
            }
            else {
                this.summaryCacheMap.get(id).delete(name);
            }
        }
    }
    /**
     * @param {?} gridId
     * @param {?} cell
     * @return {?}
     */
    set_cell_inEditMode(gridId, cell) {
        const /** @type {?} */ grid = this.get(gridId);
        const /** @type {?} */ args = {
            rowID: cell.cellID.rowID,
            cellID: cell.cellID,
            oldValue: cell.value,
            cancel: false
        };
        grid.onCellEditEnter.emit(args);
        if (args.cancel) {
            return;
        }
        if (grid.rowEditable) {
            const /** @type {?} */ currentEditRow = this.get_edit_row_state(gridId);
            if (currentEditRow && currentEditRow.rowID !== cell.cellID.rowID) {
                grid.endEdit(true);
                grid.startRowEdit(cell.cellID);
            }
            if (!currentEditRow) {
                grid.startRowEdit(cell.cellID);
            }
        }
        if (!this.get_cell_inEditMode(gridId)) {
            const /** @type {?} */ cellCopy = Object.assign({}, cell);
            cellCopy.row = Object.assign({}, cell.row);
            this.editCellState.set(gridId, { cellID: cell.cellID, cell: cellCopy });
        }
    }
    /**
     * @param {?} gridId
     * @param {?=} cellId
     * @return {?}
     */
    escape_editMode(gridId, cellId) {
        const /** @type {?} */ editableCell = this.get_cell_inEditMode(gridId);
        if (editableCell) {
            if (cellId) {
                if (cellId.rowID === editableCell.cellID.rowID &&
                    cellId.columnID === editableCell.cellID.columnID) {
                    this.editCellState.delete(gridId);
                }
            }
            else {
                const /** @type {?} */ grid = this.get(gridId);
                this.editCellState.delete(gridId);
            }
        }
        this.get(gridId).refreshSearch();
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    get_cell_inEditMode(gridId) {
        const /** @type {?} */ editCellId = this.editCellState.get(gridId);
        if (editCellId) {
            return editCellId;
        }
        else {
            return null;
        }
    }
    /**
     * @param {?} id
     * @param {?} rowID
     * @return {?}
     */
    get_row_index_in_data(id, rowID) {
        const /** @type {?} */ grid = /** @type {?} */ (this.get(id));
        if (!grid) {
            return -1;
        }
        const /** @type {?} */ data = this.get_all_data(id);
        return grid.primaryKey ? data.findIndex(record => record[grid.primaryKey] === rowID) : data.indexOf(rowID);
    }
    /**
     * @param {?} id
     * @param {?} rowSelector
     * @return {?}
     */
    get_row_by_key(id, rowSelector) {
        const /** @type {?} */ primaryKey = this.get(id).primaryKey;
        if (primaryKey !== undefined && primaryKey !== null) {
            return this.get(id).dataRowList.find((row) => row.rowData[primaryKey] === rowSelector);
        }
        else {
            return this.get(id).dataRowList.find((row) => row.rowData === rowSelector);
        }
    }
    /**
     * @param {?} id
     * @param {?} rowIndex
     * @return {?}
     */
    get_row_by_index(id, rowIndex) {
        return this.get(id).rowList.find((row) => row.index === rowIndex);
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    get_edit_row_state(gridId) {
        const /** @type {?} */ editRow = this.editRowState.get(gridId);
        return editRow ? editRow : null;
    }
    /**
     * @param {?} gridId
     * @param {?} row
     * @return {?}
     */
    set_edit_row_state(gridId, row) {
        if (!row) {
            this.editRowState.delete(gridId);
        }
        else {
            this.editRowState.set(gridId, row);
        }
    }
    /**
     * @param {?} id
     * @param {?} rowSelector
     * @param {?} field
     * @return {?}
     */
    get_cell_by_key(id, rowSelector, field) {
        const /** @type {?} */ row = this.get_row_by_key(id, rowSelector);
        if (row && row.cells) {
            return row.cells.find((cell) => cell.column.field === field);
        }
    }
    /**
     * @param {?} id
     * @param {?} rowIndex
     * @param {?} columnIndex
     * @return {?}
     */
    get_cell_by_index(id, rowIndex, columnIndex) {
        const /** @type {?} */ row = this.get_row_by_index(id, rowIndex);
        if (row && row.cells) {
            return row.cells.find((cell) => cell.columnIndex === columnIndex);
        }
    }
    /**
     * @param {?} id
     * @param {?} rowIndex
     * @param {?} columnIndex
     * @return {?}
     */
    get_cell_by_visible_index(id, rowIndex, columnIndex) {
        const /** @type {?} */ row = this.get_row_by_index(id, rowIndex);
        if (row && row.cells) {
            return row.cells.find((cell) => cell.visibleColumnIndex === columnIndex);
        }
    }
    /**
     * @param {?} gridId
     * @return {?}
     */
    submit_value(gridId) {
        const /** @type {?} */ editableCell = this.get_cell_inEditMode(gridId);
        if (editableCell) {
            const /** @type {?} */ gridEditState = this.create_grid_edit_args(gridId, editableCell.cellID.rowID, editableCell.cellID.columnID, editableCell.cell.editValue);
            if (!editableCell.cell.column.inlineEditorTemplate && editableCell.cell.column.dataType === 'number') {
                if (!editableCell.cell.editValue) {
                    gridEditState.args.newValue = 0;
                    this.update_cell(gridId, editableCell.cellID.rowID, editableCell.cellID.columnID, 0, gridEditState);
                }
                else {
                    const /** @type {?} */ val = parseFloat(editableCell.cell.editValue);
                    if (!isNaN(val) || isFinite(val)) {
                        gridEditState.args.newValue = val;
                        this.update_cell(gridId, editableCell.cellID.rowID, editableCell.cellID.columnID, val, gridEditState);
                    }
                }
            }
            else {
                this.update_cell(gridId, editableCell.cellID.rowID, editableCell.cellID.columnID, editableCell.cell.editValue, gridEditState);
            }
            if (gridEditState.args.cancel) {
                return;
            }
            this.escape_editMode(gridId, editableCell.cellID);
        }
    }
    /**
     * @param {?} id
     * @param {?} rowID
     * @param {?} columnID
     * @param {?} editValue
     * @return {?}
     */
    create_grid_edit_args(id, rowID, columnID, editValue) {
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ data = this.get_all_data(id);
        const /** @type {?} */ isRowSelected = grid.selection.is_item_selected(id, rowID);
        const /** @type {?} */ editableCell = this.get_cell_inEditMode(id);
        const /** @type {?} */ column = grid.columnList.toArray()[columnID];
        columnID = columnID !== undefined && columnID !== null ? columnID : null;
        let /** @type {?} */ cellObj;
        if (columnID !== null) {
            if ((editableCell && editableCell.cellID.rowID === rowID && editableCell.cellID.columnID === columnID)) {
                cellObj = editableCell;
            }
            else {
                cellObj = grid.columnList.toArray()[columnID].cells.find((cell) => cell.cellID.rowID === rowID);
            }
        }
        let /** @type {?} */ rowIndex = this.get_row_index_in_data(id, rowID);
        let /** @type {?} */ oldValue;
        let /** @type {?} */ rowData;
        if (rowIndex !== -1) {
            oldValue = columnID !== null ? data[rowIndex][column.field] : null;
            rowData = data[rowIndex];
        }
        //  if we have transactions and add row was edited look for old value and row data in added rows
        if (rowIndex < 0 && grid.transactions.enabled) {
            const /** @type {?} */ dataWithTransactions = grid.dataWithAddedInTransactionRows;
            rowIndex = grid.primaryKey ?
                dataWithTransactions.map((record) => record[grid.primaryKey]).indexOf(rowID) :
                dataWithTransactions.indexOf(rowID);
            if (rowIndex !== -1) {
                //  Check if below change will work on added rows with transactions
                // oldValue = this.get_all_data(id, true)[rowIndex][column.field];
                // rowData = this.get_all_data(id, true)[rowIndex];
                oldValue = columnID !== null ? dataWithTransactions[rowIndex][column.field] : null;
                rowData = dataWithTransactions[rowIndex];
            }
        }
        const /** @type {?} */ args = {
            rowID,
            oldValue: oldValue,
            newValue: editValue,
            cancel: false
        };
        if (cellObj) {
            Object.assign(args, {
                cellID: cellObj.cellID
            });
        }
        return {
            args,
            isRowSelected,
            rowData
        };
    }
    /**
     * @param {?} id
     * @param {?} rowID
     * @param {?} columnID
     * @param {?} editValue
     * @param {?=} gridEditState
     * @return {?}
     */
    update_cell(id, rowID, columnID, editValue, gridEditState) {
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ data = this.get_all_data(id);
        const /** @type {?} */ currentGridEditState = gridEditState || this.create_grid_edit_args(id, rowID, columnID, editValue);
        const /** @type {?} */ emittedArgs = currentGridEditState.args;
        const /** @type {?} */ column = grid.columnList.toArray()[columnID];
        const /** @type {?} */ rowIndex = this.get_row_index_in_data(id, rowID);
        if (emittedArgs.oldValue !== undefined && currentGridEditState.rowData !== undefined) {
            grid.onCellEdit.emit(emittedArgs);
            if (emittedArgs.cancel) {
                return;
            }
            //  if we are editing the cell for second or next time, get the old value from transaction
            const /** @type {?} */ oldValueInTransaction = grid.transactions.getAggregatedValue(rowID, true);
            if (oldValueInTransaction) {
                emittedArgs.oldValue = oldValueInTransaction[column.field];
            }
            //  if edit (new) value is same as old value do nothing here
            if (emittedArgs.oldValue !== undefined
                && isEqual(emittedArgs.oldValue, emittedArgs.newValue)) {
                return;
            }
            const /** @type {?} */ transaction = {
                id: rowID, type: TransactionType.UPDATE, newValue: { [column.field]: emittedArgs.newValue }
            };
            if (grid.transactions.enabled) {
                grid.transactions.add(transaction, currentGridEditState.rowData);
            }
            else {
                const /** @type {?} */ rowValue = this.get_all_data(id)[rowIndex];
                mergeObjects(rowValue, { [column.field]: emittedArgs.newValue });
            }
            if (grid.primaryKey === column.field && currentGridEditState.isRowSelected) {
                grid.selection.deselect_item(id, rowID);
                grid.selection.select_item(id, emittedArgs.newValue);
            }
            if (!grid.rowEditable || !grid.rowInEditMode || grid.rowInEditMode.rowID !== rowID) {
                (/** @type {?} */ (grid))._pipeTrigger++;
            }
        }
    }
    /**
     * @param {?} value
     * @param {?} id
     * @param {?} rowID
     * @param {?=} gridState
     * @return {?}
     */
    update_row(value, id, rowID, gridState) {
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ data = this.get_all_data(id);
        const /** @type {?} */ currentGridState = gridState ? gridState : this.create_grid_edit_args(id, rowID, null, value);
        const /** @type {?} */ emitArgs = currentGridState.args;
        const /** @type {?} */ index = this.get_row_index_in_data(id, rowID);
        const /** @type {?} */ currentRowInEditMode = this.get_edit_row_state(id);
        let /** @type {?} */ oldValue = Object.assign({}, data[index]);
        if (grid.currentRowState && grid.currentRowState[grid.primaryKey] === rowID
            || currentRowInEditMode && currentRowInEditMode.rowID === rowID) {
            oldValue = Object.assign(oldValue, grid.currentRowState);
        }
        else if (grid.transactions.enabled) {
            // If transactions are enabled, old value == last commited value (as it's not applied in data yet)
            const /** @type {?} */ lastCommitedValue = 
            // Last commited value (w/o pending)
            grid.transactions.getState(rowID) ? Object.assign({}, grid.transactions.getState(rowID).value) : null;
            oldValue = lastCommitedValue ? Object.assign(oldValue, lastCommitedValue) : oldValue;
        }
        Object.assign(emitArgs, { oldValue, rowID });
        if (index !== -1) {
            grid.onRowEdit.emit(emitArgs);
            if (emitArgs.cancel) {
                return;
            }
            if (currentRowInEditMode) {
                grid.transactions.endPending(false);
            }
            if (grid.transactions.enabled && emitArgs.newValue !== null) {
                grid.transactions.add({ id: rowID, newValue: emitArgs.newValue, type: TransactionType.UPDATE }, emitArgs.oldValue);
            }
            else if (emitArgs.newValue !== null && emitArgs.newValue !== undefined) {
                Object.assign(data[index], emitArgs.newValue);
            }
            if (currentGridState.isRowSelected) {
                grid.selection.deselect_item(id, rowID);
                const /** @type {?} */ newRowID = (grid.primaryKey) ? emitArgs.newValue[grid.primaryKey] : emitArgs.newValue;
                grid.selection.select_item(id, newRowID);
            }
            (/** @type {?} */ (grid))._pipeTrigger++;
        }
    }
    /**
     * @param {?} id
     * @param {?} value
     * @param {?} rowID
     * @param {?} index
     * @return {?}
     */
    update_row_in_array(id, value, rowID, index) {
        const /** @type {?} */ grid = this.get(id);
        grid.data[index] = value;
    }
    /**
     * @param {?} id
     * @param {?} fieldName
     * @param {?} dir
     * @param {?} ignoreCase
     * @param {?} strategy
     * @return {?}
     */
    sort(id, fieldName, dir, ignoreCase, strategy) {
        if (dir === SortingDirection.None) {
            this.remove_grouping_expression(id, fieldName);
        }
        const /** @type {?} */ sortingState = cloneArray(this.get(id).sortingExpressions);
        strategy = strategy ? strategy : this.getSortStrategyPerColumn(id, fieldName);
        this.prepare_sorting_expression([sortingState], { fieldName, dir, ignoreCase, strategy });
        this.get(id).sortingExpressions = sortingState;
    }
    /**
     * @param {?} id
     * @param {?} expressions
     * @return {?}
     */
    sort_multiple(id, expressions) {
        const /** @type {?} */ sortingState = cloneArray(this.get(id).sortingExpressions);
        for (const /** @type {?} */ each of expressions) {
            if (each.dir === SortingDirection.None) {
                this.remove_grouping_expression(id, each.fieldName);
            }
            each.strategy = each.strategy ? each.strategy : this.getSortStrategyPerColumn(id, each.fieldName);
            this.prepare_sorting_expression([sortingState], each);
        }
        this.get(id).sortingExpressions = sortingState;
    }
    /**
     * @param {?} id
     * @param {?} fieldName
     * @param {?} term
     * @param {?} conditionOrExpressionsTree
     * @param {?} ignoreCase
     * @return {?}
     */
    filter(id, fieldName, term, conditionOrExpressionsTree, ignoreCase) {
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ filteringTree = grid.filteringExpressionsTree;
        grid.endEdit(false);
        if (grid.paging) {
            grid.page = 0;
        }
        const /** @type {?} */ fieldFilterIndex = filteringTree.findIndex(fieldName);
        if (fieldFilterIndex > -1) {
            filteringTree.filteringOperands.splice(fieldFilterIndex, 1);
        }
        this.prepare_filtering_expression(filteringTree, fieldName, term, conditionOrExpressionsTree, ignoreCase);
        grid.filteringExpressionsTree = filteringTree;
    }
    /**
     * @param {?} id
     * @param {?} term
     * @param {?} condition
     * @param {?} ignoreCase
     * @return {?}
     */
    filter_global(id, term, condition, ignoreCase) {
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ filteringTree = grid.filteringExpressionsTree;
        if (grid.paging) {
            grid.page = 0;
        }
        filteringTree.filteringOperands = [];
        this.remove_summary(id);
        if (condition) {
            for (const /** @type {?} */ column of grid.columns) {
                this.prepare_filtering_expression(filteringTree, column.field, term, condition, ignoreCase || column.filteringIgnoreCase);
            }
        }
        grid.filteringExpressionsTree = filteringTree;
    }
    /**
     * @param {?} id
     * @param {?} fieldName
     * @return {?}
     */
    clear_filter(id, fieldName) {
        if (fieldName) {
            const /** @type {?} */ column = this.get_column_by_name(id, fieldName);
            if (!column) {
                return;
            }
        }
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ filteringState = grid.filteringExpressionsTree;
        const /** @type {?} */ index = filteringState.findIndex(fieldName);
        if (index > -1) {
            filteringState.filteringOperands.splice(index, 1);
            this.remove_summary(id, fieldName);
        }
        else {
            filteringState.filteringOperands = [];
            this.remove_summary(id);
        }
        grid.filteredData = null;
        grid.filteringExpressionsTree = filteringState;
    }
    /**
     * @param {?} id
     * @param {?} column
     * @param {?} data
     * @return {?}
     */
    calculateSummaries(id, column, data) {
        if (!this.summaryCacheMap.get(id).get(column.field)) {
            this.summaryCacheMap.get(id).set(column.field, column.summaries.operate(data));
        }
    }
    /**
     * @param {?} id
     * @param {?} fieldName
     * @return {?}
     */
    clear_sort(id, fieldName) {
        const /** @type {?} */ sortingState = this.get(id).sortingExpressions;
        const /** @type {?} */ index = sortingState.findIndex((expr) => expr.fieldName === fieldName);
        if (index > -1) {
            sortingState.splice(index, 1);
            this.get(id).sortingExpressions = sortingState;
        }
    }
    /**
     * @param {?} filteringState
     * @param {?} fieldName
     * @param {?} searchVal
     * @param {?} conditionOrExpressionsTree
     * @param {?} ignoreCase
     * @return {?}
     */
    prepare_filtering_expression(filteringState, fieldName, searchVal, conditionOrExpressionsTree, ignoreCase) {
        let /** @type {?} */ newExpressionsTree;
        const /** @type {?} */ oldExpressionsTreeIndex = filteringState.findIndex(fieldName);
        const /** @type {?} */ expressionsTree = conditionOrExpressionsTree instanceof FilteringExpressionsTree ? /** @type {?} */ (conditionOrExpressionsTree) : null;
        const /** @type {?} */ condition = conditionOrExpressionsTree instanceof FilteringExpressionsTree ?
            null : /** @type {?} */ (conditionOrExpressionsTree);
        const /** @type {?} */ newExpression = { fieldName, searchVal, condition, ignoreCase };
        if (oldExpressionsTreeIndex === -1) {
            // no expressions tree found for this field
            if (expressionsTree) {
                filteringState.filteringOperands.push(expressionsTree);
            }
            else if (condition) {
                // create expressions tree for this field and add the new expression to it
                newExpressionsTree = new FilteringExpressionsTree(filteringState.operator, fieldName);
                newExpressionsTree.filteringOperands.push(newExpression);
                filteringState.filteringOperands.push(newExpressionsTree);
            }
        }
    }
    /**
     * @param {?} stateCollections
     * @param {?} expression
     * @return {?}
     */
    prepare_sorting_expression(stateCollections, expression) {
        if (expression.dir === SortingDirection.None) {
            stateCollections.forEach(state => {
                state.splice(state.findIndex((expr) => expr.fieldName === expression.fieldName), 1);
            });
            return;
        }
        /**
         * We need to make sure the states in each collection with same fields point to the same object reference.
         * If the different state collections provided have different sizes we need to get the largest one.
         * That way we can get the state reference from the largest one that has the same fieldName as the expression to prepare.
         */
        let /** @type {?} */ maxCollection = stateCollections[0];
        for (let /** @type {?} */ i = 1; i < stateCollections.length; i++) {
            if (maxCollection.length < stateCollections[i].length) {
                maxCollection = stateCollections[i];
            }
        }
        const /** @type {?} */ maxExpr = maxCollection.find((expr) => expr.fieldName === expression.fieldName);
        stateCollections.forEach(collection => {
            const /** @type {?} */ myExpr = collection.find((expr) => expr.fieldName === expression.fieldName);
            if (!myExpr && !maxExpr) {
                // Expression with this fieldName is missing from the current and the max collection.
                collection.push(expression);
            }
            else if (!myExpr && maxExpr) {
                // Expression with this fieldName is missing from the current and but the max collection has.
                collection.push(maxExpr);
                Object.assign(maxExpr, expression);
            }
            else {
                // The current collection has the expression so just update it.
                Object.assign(myExpr, expression);
            }
        });
    }
    /**
     * @param {?} id
     * @param {?} fieldName
     * @return {?}
     */
    remove_grouping_expression(id, fieldName) {
    }
    /**
     * @param {?} column
     * @return {?}
     */
    should_apply_number_style(column) {
        return column.dataType === DataType.Number;
    }
    /**
     * @param {?} id
     * @param {?=} transactions
     * @return {?}
     */
    get_all_data(id, transactions) {
        const /** @type {?} */ grid = this.get(id);
        const /** @type {?} */ data = transactions ? grid.dataWithAddedInTransactionRows : grid.data;
        return data ? data : [];
    }
    /**
     * @param {?} id
     * @param {?} fieldName
     * @return {?}
     */
    getSortStrategyPerColumn(id, fieldName) {
        return this.get_column_by_name(this.get(id).id, fieldName) ?
            this.get_column_by_name(id, fieldName).sortStrategy : undefined;
    }
}
GridBaseAPIService.decorators = [
    { type: Injectable },
];
function GridBaseAPIService_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    GridBaseAPIService.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    GridBaseAPIService.ctorParameters;
    /** @type {?} */
    GridBaseAPIService.prototype.change;
    /** @type {?} */
    GridBaseAPIService.prototype.state;
    /** @type {?} */
    GridBaseAPIService.prototype.editCellState;
    /** @type {?} */
    GridBaseAPIService.prototype.editRowState;
    /** @type {?} */
    GridBaseAPIService.prototype.summaryCacheMap;
    /** @type {?} */
    GridBaseAPIService.prototype.destroyMap;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pZ25pdGV1aS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2dyaWRzL2FwaS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFJbEUsT0FBTyxFQUFzQixnQkFBZ0IsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBTXZHLE9BQU8sRUFBNkIsd0JBQXdCLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQztBQUNwSCxPQUFPLEVBQWUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7OztBQU9qRSxNQUFNOztzQkFFNEIsSUFBSSxPQUFPLEVBQU87cUJBQ2QsSUFBSSxHQUFHLEVBQWE7NkJBQ1YsSUFBSSxHQUFHLEVBQWU7NEJBQ00sSUFBSSxHQUFHLEVBQUU7K0JBQ3BCLElBQUksR0FBRyxFQUE4QjswQkFDNUMsSUFBSSxHQUFHLEVBQTRCOzs7Ozs7SUFFbEYsUUFBUSxDQUFDLElBQU87UUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksT0FBTyxFQUFXLENBQUMsQ0FBQzs7Ozs7O0lBR2xELFdBQVcsQ0FBQyxJQUFPO1FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzs7Ozs7O0lBR3hCLEdBQUcs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OztJQUVTLDBCQUEwQixDQUFDLEVBQUUsRUFBRSxTQUFTO0tBQzdDOzs7OztJQUVFLHlCQUF5QixDQUFDLE1BQTBCO1FBQ3ZELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxNQUFNLENBQUM7Ozs7Ozs7SUFHeEMsWUFBWSxDQUFDLEVBQVUsRUFBRSxZQUFzQjtRQUNsRCx1QkFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMxQix1QkFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDNUUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7Ozs7Ozs7SUFHbEIsd0JBQXdCLENBQUMsRUFBVSxFQUFFLFNBQWlCO1FBQzVELE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0tBQ3ZFOzs7WUE5a0JKLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjbG9uZUFycmF5LCBpc0VxdWFsLCBtZXJnZU9iamVjdHMgfSBmcm9tICcuLi9jb3JlL3V0aWxzJztcbmltcG9ydCB7IERhdGFVdGlsLCBEYXRhVHlwZSB9IGZyb20gJy4uL2RhdGEtb3BlcmF0aW9ucy9kYXRhLXV0aWwnO1xuaW1wb3J0IHsgSUZpbHRlcmluZ0V4cHJlc3Npb24sIEZpbHRlcmluZ0xvZ2ljIH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL2ZpbHRlcmluZy1leHByZXNzaW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBJR3JvdXBCeUV4cGFuZFN0YXRlIH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL2dyb3VwYnktZXhwYW5kLXN0YXRlLmludGVyZmFjZSc7XG5pbXBvcnQgeyBJR3JvdXBCeVJlY29yZCB9IGZyb20gJy4uL2RhdGEtb3BlcmF0aW9ucy9ncm91cGJ5LXJlY29yZC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSVNvcnRpbmdFeHByZXNzaW9uLCBTb3J0aW5nRGlyZWN0aW9uIH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL3NvcnRpbmctZXhwcmVzc2lvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSWd4R3JpZENlbGxDb21wb25lbnQgfSBmcm9tICcuL2NlbGwuY29tcG9uZW50JztcbmltcG9ydCB7IElneENvbHVtbkNvbXBvbmVudCB9IGZyb20gJy4vY29sdW1uLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJR3JpZEVkaXRFdmVudEFyZ3MsIElneEdyaWRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9ncmlkLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IElneFJvd0NvbXBvbmVudCB9IGZyb20gJy4vcm93LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJRmlsdGVyaW5nT3BlcmF0aW9uIH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL2ZpbHRlcmluZy1jb25kaXRpb24nO1xuaW1wb3J0IHsgSUZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZSwgRmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlIH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL2ZpbHRlcmluZy1leHByZXNzaW9ucy10cmVlJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uLCBUcmFuc2FjdGlvblR5cGUgfSBmcm9tICcuLi9zZXJ2aWNlcy9pbmRleCc7XG5pbXBvcnQgeyBJU29ydGluZ1N0cmF0ZWd5IH0gZnJvbSAnLi4vZGF0YS1vcGVyYXRpb25zL3NvcnRpbmctc3RyYXRlZ3knO1xuaW1wb3J0IHsgU29ydGluZ1N0YXRlRGVmYXVsdHMgfSBmcm9tICcuLi9kYXRhLW9wZXJhdGlvbnMvc29ydGluZy1zdGF0ZS5pbnRlcmZhY2UnO1xuLyoqXG4gKkBoaWRkZW5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEdyaWRCYXNlQVBJU2VydmljZSA8VCBleHRlbmRzIElneEdyaWRCYXNlQ29tcG9uZW50PiB7XG5cbiAgICBwdWJsaWMgY2hhbmdlOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gICAgcHJvdGVjdGVkIHN0YXRlOiBNYXA8c3RyaW5nLCBUPiA9IG5ldyBNYXA8c3RyaW5nLCBUPigpO1xuICAgIHByb3RlY3RlZCBlZGl0Q2VsbFN0YXRlOiBNYXA8c3RyaW5nLCBhbnk+ID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgICBwcm90ZWN0ZWQgZWRpdFJvd1N0YXRlOiBNYXA8c3RyaW5nLCB7IHJvd0lEOiBhbnksIHJvd0luZGV4OiBudW1iZXIgfT4gPSBuZXcgTWFwKCk7XG4gICAgcHJvdGVjdGVkIHN1bW1hcnlDYWNoZU1hcDogTWFwPHN0cmluZywgTWFwPHN0cmluZywgYW55W10+PiA9IG5ldyBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBhbnlbXT4+KCk7XG4gICAgcHJvdGVjdGVkIGRlc3Ryb3lNYXA6IE1hcDxzdHJpbmcsIFN1YmplY3Q8Ym9vbGVhbj4+ID0gbmV3IE1hcDxzdHJpbmcsIFN1YmplY3Q8Ym9vbGVhbj4+KCk7XG5cbiAgICBwdWJsaWMgcmVnaXN0ZXIoZ3JpZDogVCkge1xuICAgICAgICB0aGlzLnN0YXRlLnNldChncmlkLmlkLCBncmlkKTtcbiAgICAgICAgdGhpcy5kZXN0cm95TWFwLnNldChncmlkLmlkLCBuZXcgU3ViamVjdDxib29sZWFuPigpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdW5zdWJzY3JpYmUoZ3JpZDogVCkge1xuICAgICAgICB0aGlzLnN0YXRlLmRlbGV0ZShncmlkLmlkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0KGlkOiBzdHJpbmcpOiBUIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuZ2V0KGlkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdW5zZXQoaWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnN0YXRlLmRlbGV0ZShpZCk7XG4gICAgICAgIHRoaXMuc3VtbWFyeUNhY2hlTWFwLmRlbGV0ZShpZCk7XG4gICAgICAgIHRoaXMuZWRpdENlbGxTdGF0ZS5kZWxldGUoaWQpO1xuICAgICAgICB0aGlzLmVkaXRSb3dTdGF0ZS5kZWxldGUoaWQpO1xuICAgICAgICB0aGlzLmRlc3Ryb3lNYXAuZGVsZXRlKGlkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQob2xkSWQ6IHN0cmluZywgbmV3SWQ6IHN0cmluZykge1xuICAgICAgICBjb25zdCBkZXN0cm95ID0gdGhpcy5kZXN0cm95TWFwLmdldChvbGRJZCk7XG4gICAgICAgIGNvbnN0IHN1bW1hcnkgPSB0aGlzLnN1bW1hcnlDYWNoZU1hcC5nZXQob2xkSWQpO1xuICAgICAgICBjb25zdCBlZGl0Q2VsbFN0YXRlID0gdGhpcy5lZGl0Q2VsbFN0YXRlLmdldChvbGRJZCk7XG4gICAgICAgIGNvbnN0IGVkaXRSb3dTdGF0ZSA9IHRoaXMuZWRpdFJvd1N0YXRlLmdldChvbGRJZCk7XG4gICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldChvbGRJZCk7XG5cbiAgICAgICAgdGhpcy51bnNldChvbGRJZCk7XG5cbiAgICAgICAgaWYgKGdyaWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc2V0KG5ld0lkLCBncmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkZXN0cm95KSB7XG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3lNYXAuc2V0KG5ld0lkLCBkZXN0cm95KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdW1tYXJ5KSB7XG4gICAgICAgICAgICB0aGlzLnN1bW1hcnlDYWNoZU1hcC5zZXQobmV3SWQsIHN1bW1hcnkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVkaXRDZWxsU3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdENlbGxTdGF0ZS5zZXQobmV3SWQsIGVkaXRDZWxsU3RhdGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVkaXRSb3dTdGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5lZGl0Um93U3RhdGUuc2V0KG5ld0lkLCBlZGl0Um93U3RhdGUpO1xuICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0X2NvbHVtbl9ieV9uYW1lKGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZyk6IElneENvbHVtbkNvbXBvbmVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChpZCkuY29sdW1uTGlzdC5maW5kKChjb2wpID0+IGNvbC5maWVsZCA9PT0gbmFtZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldF9zdW1tYXJ5X2J5X2NvbHVtbl9uYW1lKGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZykge1xuICAgICAgICBpZiAoIXRoaXMuc3VtbWFyeUNhY2hlTWFwLmdldChpZCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3VtbWFyeUNhY2hlTWFwLnNldChpZCwgbmV3IE1hcDxzdHJpbmcsIGFueVtdPigpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdldF9jb2x1bW5fYnlfbmFtZShpZCwgbmFtZSk7XG4gICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldChpZCk7XG4gICAgICAgIGxldCBkYXRhID0gZ3JpZC5maWx0ZXJlZERhdGE7XG4gICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgaWYgKGdyaWQudHJhbnNhY3Rpb25zLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gRGF0YVV0aWwubWVyZ2VUcmFuc2FjdGlvbnMoXG4gICAgICAgICAgICAgICAgICAgIGNsb25lQXJyYXkoZ3JpZC5kYXRhKSxcbiAgICAgICAgICAgICAgICAgICAgZ3JpZC50cmFuc2FjdGlvbnMuZ2V0QWdncmVnYXRlZENoYW5nZXModHJ1ZSksXG4gICAgICAgICAgICAgICAgICAgIGdyaWQucHJpbWFyeUtleVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBncmlkLmRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtblZhbHVlcyA9IGRhdGEubWFwKChyZWMpID0+IHJlY1tjb2x1bW4uZmllbGRdKTtcbiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlU3VtbWFyaWVzKGlkLCBjb2x1bW4sIGNvbHVtblZhbHVlcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0X3N1bW1hcmllcyhpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN1bW1hcnlDYWNoZU1hcC5nZXQoaWQpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW1vdmVfc3VtbWFyeShpZDogc3RyaW5nLCBuYW1lPzogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLnN1bW1hcnlDYWNoZU1hcC5oYXMoaWQpKSB7XG4gICAgICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN1bW1hcnlDYWNoZU1hcC5kZWxldGUoaWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN1bW1hcnlDYWNoZU1hcC5nZXQoaWQpLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzZXRfY2VsbF9pbkVkaXRNb2RlKGdyaWRJZDogc3RyaW5nLCBjZWxsOiBJZ3hHcmlkQ2VsbENvbXBvbmVudCkge1xuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXQoZ3JpZElkKTtcbiAgICAgICAgY29uc3QgYXJnczogSUdyaWRFZGl0RXZlbnRBcmdzID0ge1xuICAgICAgICAgICAgcm93SUQ6IGNlbGwuY2VsbElELnJvd0lELFxuICAgICAgICAgICAgY2VsbElEOiBjZWxsLmNlbGxJRCxcbiAgICAgICAgICAgIG9sZFZhbHVlOiBjZWxsLnZhbHVlLFxuICAgICAgICAgICAgY2FuY2VsOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICBncmlkLm9uQ2VsbEVkaXRFbnRlci5lbWl0KGFyZ3MpO1xuICAgICAgICBpZiAoYXJncy5jYW5jZWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ3JpZC5yb3dFZGl0YWJsZSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudEVkaXRSb3cgPSB0aGlzLmdldF9lZGl0X3Jvd19zdGF0ZShncmlkSWQpO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRFZGl0Um93ICYmIGN1cnJlbnRFZGl0Um93LnJvd0lEICE9PSBjZWxsLmNlbGxJRC5yb3dJRCkge1xuICAgICAgICAgICAgICAgIGdyaWQuZW5kRWRpdCh0cnVlKTtcbiAgICAgICAgICAgICAgICBncmlkLnN0YXJ0Um93RWRpdChjZWxsLmNlbGxJRCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRFZGl0Um93KSB7XG4gICAgICAgICAgICAgICAgZ3JpZC5zdGFydFJvd0VkaXQoY2VsbC5jZWxsSUQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLmdldF9jZWxsX2luRWRpdE1vZGUoZ3JpZElkKSkge1xuICAgICAgICAgICAgY29uc3QgY2VsbENvcHkgPSBPYmplY3QuYXNzaWduKHt9LCBjZWxsKTtcbiAgICAgICAgICAgIGNlbGxDb3B5LnJvdyA9IE9iamVjdC5hc3NpZ24oe30sIGNlbGwucm93KTtcbiAgICAgICAgdGhpcy5lZGl0Q2VsbFN0YXRlLnNldChncmlkSWQsIHsgY2VsbElEOiBjZWxsLmNlbGxJRCwgY2VsbDogY2VsbENvcHkgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZXNjYXBlX2VkaXRNb2RlKGdyaWRJZCwgY2VsbElkPykge1xuICAgICAgICBjb25zdCBlZGl0YWJsZUNlbGwgPSB0aGlzLmdldF9jZWxsX2luRWRpdE1vZGUoZ3JpZElkKTtcbiAgICAgICAgaWYgKGVkaXRhYmxlQ2VsbCkge1xuICAgICAgICAgICAgaWYgKGNlbGxJZCkge1xuICAgICAgICAgICAgICAgIGlmIChjZWxsSWQucm93SUQgPT09IGVkaXRhYmxlQ2VsbC5jZWxsSUQucm93SUQgJiZcbiAgICAgICAgICAgICAgICAgICAgY2VsbElkLmNvbHVtbklEID09PSBlZGl0YWJsZUNlbGwuY2VsbElELmNvbHVtbklEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdENlbGxTdGF0ZS5kZWxldGUoZ3JpZElkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldChncmlkSWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdENlbGxTdGF0ZS5kZWxldGUoZ3JpZElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ2V0KGdyaWRJZCkucmVmcmVzaFNlYXJjaCgpO1xuICAgIH1cblxuXG4gICAgcHVibGljIGdldF9jZWxsX2luRWRpdE1vZGUoZ3JpZElkKToge1xuICAgICAgICBjZWxsSUQ6IHtcbiAgICAgICAgICAgIHJvd0lEOiBhbnksXG4gICAgICAgICAgICBjb2x1bW5JRDogbnVtYmVyLFxuICAgICAgICAgICAgcm93SW5kZXg6IG51bWJlclxuICAgICAgICB9LFxuICAgICAgICBjZWxsOiBhbnlcbiAgICB9IHtcbiAgICAgICAgY29uc3QgZWRpdENlbGxJZCA9IHRoaXMuZWRpdENlbGxTdGF0ZS5nZXQoZ3JpZElkKTtcbiAgICAgICAgaWYgKGVkaXRDZWxsSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBlZGl0Q2VsbElkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0X3Jvd19pbmRleF9pbl9kYXRhKGlkOiBzdHJpbmcsIHJvd0lEOiBhbnkpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXQoaWQpIGFzIElneEdyaWRCYXNlQ29tcG9uZW50O1xuICAgICAgICBpZiAoIWdyaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRfYWxsX2RhdGEoaWQpO1xuICAgICAgICByZXR1cm4gZ3JpZC5wcmltYXJ5S2V5ID8gZGF0YS5maW5kSW5kZXgocmVjb3JkID0+IHJlY29yZFtncmlkLnByaW1hcnlLZXldID09PSByb3dJRCkgOiBkYXRhLmluZGV4T2Yocm93SUQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRfcm93X2J5X2tleShpZDogc3RyaW5nLCByb3dTZWxlY3RvcjogYW55KTogSWd4Um93Q29tcG9uZW50PElneEdyaWRCYXNlQ29tcG9uZW50PiB7XG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSB0aGlzLmdldChpZCkucHJpbWFyeUtleTtcbiAgICAgICAgaWYgKHByaW1hcnlLZXkgIT09IHVuZGVmaW5lZCAmJiBwcmltYXJ5S2V5ICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoaWQpLmRhdGFSb3dMaXN0LmZpbmQoKHJvdykgPT4gcm93LnJvd0RhdGFbcHJpbWFyeUtleV0gPT09IHJvd1NlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChpZCkuZGF0YVJvd0xpc3QuZmluZCgocm93KSA9PiByb3cucm93RGF0YSA9PT0gcm93U2VsZWN0b3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldF9yb3dfYnlfaW5kZXgoaWQ6IHN0cmluZywgcm93SW5kZXg6IG51bWJlcik6IElneFJvd0NvbXBvbmVudDxJZ3hHcmlkQmFzZUNvbXBvbmVudD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoaWQpLnJvd0xpc3QuZmluZCgocm93KSA9PiByb3cuaW5kZXggPT09IHJvd0luZGV4KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0X2VkaXRfcm93X3N0YXRlKGdyaWRJZCk6IHtcbiAgICAgICAgcm93SUQ6IGFueSxcbiAgICAgICAgcm93SW5kZXg6IG51bWJlclxuICAgIH0ge1xuICAgICAgICBjb25zdCBlZGl0Um93ID0gdGhpcy5lZGl0Um93U3RhdGUuZ2V0KGdyaWRJZCk7XG4gICAgICAgIHJldHVybiBlZGl0Um93ID8gZWRpdFJvdyA6IG51bGw7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0X2VkaXRfcm93X3N0YXRlKGdyaWRJZCwgcm93OiB7IHJvd0lEOiBhbnksIHJvd0luZGV4OiBudW1iZXIgfSkge1xuICAgICAgICBpZiAoIXJvdykge1xuICAgICAgICAgICAgdGhpcy5lZGl0Um93U3RhdGUuZGVsZXRlKGdyaWRJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVkaXRSb3dTdGF0ZS5zZXQoZ3JpZElkLCByb3cpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgZ2V0X2NlbGxfYnlfa2V5KGlkOiBzdHJpbmcsIHJvd1NlbGVjdG9yOiBhbnksIGZpZWxkOiBzdHJpbmcpOiBJZ3hHcmlkQ2VsbENvbXBvbmVudCB7XG4gICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuZ2V0X3Jvd19ieV9rZXkoaWQsIHJvd1NlbGVjdG9yKTtcbiAgICAgICAgaWYgKHJvdyAmJiByb3cuY2VsbHMpIHtcbiAgICAgICAgICAgIHJldHVybiByb3cuY2VsbHMuZmluZCgoY2VsbCkgPT4gY2VsbC5jb2x1bW4uZmllbGQgPT09IGZpZWxkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRfY2VsbF9ieV9pbmRleChpZDogc3RyaW5nLCByb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDogbnVtYmVyKTogSWd4R3JpZENlbGxDb21wb25lbnQge1xuICAgICAgICBjb25zdCByb3cgPSB0aGlzLmdldF9yb3dfYnlfaW5kZXgoaWQsIHJvd0luZGV4KTtcbiAgICAgICAgaWYgKHJvdyAmJiByb3cuY2VsbHMpIHtcbiAgICAgICAgICAgIHJldHVybiByb3cuY2VsbHMuZmluZCgoY2VsbCkgPT4gY2VsbC5jb2x1bW5JbmRleCA9PT0gY29sdW1uSW5kZXgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldF9jZWxsX2J5X3Zpc2libGVfaW5kZXgoaWQ6IHN0cmluZywgcm93SW5kZXg6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlcik6IElneEdyaWRDZWxsQ29tcG9uZW50IHtcbiAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5nZXRfcm93X2J5X2luZGV4KGlkLCByb3dJbmRleCk7XG4gICAgICAgIGlmIChyb3cgJiYgcm93LmNlbGxzKSB7XG4gICAgICAgICAgICByZXR1cm4gcm93LmNlbGxzLmZpbmQoKGNlbGwpID0+IGNlbGwudmlzaWJsZUNvbHVtbkluZGV4ID09PSBjb2x1bW5JbmRleCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3VibWl0X3ZhbHVlKGdyaWRJZCkge1xuICAgICAgICBjb25zdCBlZGl0YWJsZUNlbGwgPSB0aGlzLmdldF9jZWxsX2luRWRpdE1vZGUoZ3JpZElkKTtcbiAgICAgICAgaWYgKGVkaXRhYmxlQ2VsbCkge1xuICAgICAgICAgICAgY29uc3QgZ3JpZEVkaXRTdGF0ZSA9IHRoaXMuY3JlYXRlX2dyaWRfZWRpdF9hcmdzKGdyaWRJZCwgZWRpdGFibGVDZWxsLmNlbGxJRC5yb3dJRCxcbiAgICAgICAgICAgICAgICBlZGl0YWJsZUNlbGwuY2VsbElELmNvbHVtbklELCBlZGl0YWJsZUNlbGwuY2VsbC5lZGl0VmFsdWUpO1xuICAgICAgICAgICAgaWYgKCFlZGl0YWJsZUNlbGwuY2VsbC5jb2x1bW4uaW5saW5lRWRpdG9yVGVtcGxhdGUgJiYgZWRpdGFibGVDZWxsLmNlbGwuY29sdW1uLmRhdGFUeXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIGlmICghZWRpdGFibGVDZWxsLmNlbGwuZWRpdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRFZGl0U3RhdGUuYXJncy5uZXdWYWx1ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlX2NlbGwoZ3JpZElkLCBlZGl0YWJsZUNlbGwuY2VsbElELnJvd0lELCBlZGl0YWJsZUNlbGwuY2VsbElELmNvbHVtbklELCAwLCBncmlkRWRpdFN0YXRlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBwYXJzZUZsb2F0KGVkaXRhYmxlQ2VsbC5jZWxsLmVkaXRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4odmFsKSB8fCBpc0Zpbml0ZSh2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkRWRpdFN0YXRlLmFyZ3MubmV3VmFsdWUgPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZV9jZWxsKGdyaWRJZCwgZWRpdGFibGVDZWxsLmNlbGxJRC5yb3dJRCwgZWRpdGFibGVDZWxsLmNlbGxJRC5jb2x1bW5JRCwgdmFsLCBncmlkRWRpdFN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVfY2VsbChncmlkSWQsIGVkaXRhYmxlQ2VsbC5jZWxsSUQucm93SUQsIGVkaXRhYmxlQ2VsbC5jZWxsSUQuY29sdW1uSUQsXG4gICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlQ2VsbC5jZWxsLmVkaXRWYWx1ZSwgZ3JpZEVkaXRTdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JpZEVkaXRTdGF0ZS5hcmdzLmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZXNjYXBlX2VkaXRNb2RlKGdyaWRJZCwgZWRpdGFibGVDZWxsLmNlbGxJRCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlX2dyaWRfZWRpdF9hcmdzKGlkOiBzdHJpbmcsIHJvd0lELCBjb2x1bW5JRCwgZWRpdFZhbHVlKToge1xuICAgICAgICBhcmdzOiBJR3JpZEVkaXRFdmVudEFyZ3MsXG4gICAgICAgIGlzUm93U2VsZWN0ZWQ6IGJvb2xlYW4sXG4gICAgICAgIHJvd0RhdGE6IGFueVxuICAgIH0ge1xuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXQoaWQpO1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRfYWxsX2RhdGEoaWQpO1xuICAgICAgICBjb25zdCBpc1Jvd1NlbGVjdGVkID0gZ3JpZC5zZWxlY3Rpb24uaXNfaXRlbV9zZWxlY3RlZChpZCwgcm93SUQpO1xuICAgICAgICBjb25zdCBlZGl0YWJsZUNlbGwgPSB0aGlzLmdldF9jZWxsX2luRWRpdE1vZGUoaWQpO1xuICAgICAgICBjb25zdCBjb2x1bW4gPSBncmlkLmNvbHVtbkxpc3QudG9BcnJheSgpW2NvbHVtbklEXTtcbiAgICAgICAgY29sdW1uSUQgPSBjb2x1bW5JRCAhPT0gdW5kZWZpbmVkICYmIGNvbHVtbklEICE9PSBudWxsID8gY29sdW1uSUQgOiBudWxsO1xuICAgICAgICBsZXQgY2VsbE9iajtcbiAgICAgICAgaWYgKGNvbHVtbklEICE9PSBudWxsKSB7XG4gICAgICAgICAgICBpZiAoKGVkaXRhYmxlQ2VsbCAmJiBlZGl0YWJsZUNlbGwuY2VsbElELnJvd0lEID09PSByb3dJRCAmJiBlZGl0YWJsZUNlbGwuY2VsbElELmNvbHVtbklEID09PSBjb2x1bW5JRCkpIHtcbiAgICAgICAgICAgICAgICBjZWxsT2JqID0gZWRpdGFibGVDZWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjZWxsT2JqID0gZ3JpZC5jb2x1bW5MaXN0LnRvQXJyYXkoKVtjb2x1bW5JRF0uY2VsbHMuZmluZCgoY2VsbCkgPT4gY2VsbC5jZWxsSUQucm93SUQgPT09IHJvd0lEKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgcm93SW5kZXggPSB0aGlzLmdldF9yb3dfaW5kZXhfaW5fZGF0YShpZCwgcm93SUQpO1xuICAgICAgICBsZXQgb2xkVmFsdWU6IGFueTtcbiAgICAgICAgbGV0IHJvd0RhdGE6IGFueTtcbiAgICAgICAgaWYgKHJvd0luZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgb2xkVmFsdWUgPSBjb2x1bW5JRCAhPT0gbnVsbCA/IGRhdGFbcm93SW5kZXhdW2NvbHVtbi5maWVsZF0gOiBudWxsO1xuICAgICAgICAgICAgcm93RGF0YSA9IGRhdGFbcm93SW5kZXhdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gIGlmIHdlIGhhdmUgdHJhbnNhY3Rpb25zIGFuZCBhZGQgcm93IHdhcyBlZGl0ZWQgbG9vayBmb3Igb2xkIHZhbHVlIGFuZCByb3cgZGF0YSBpbiBhZGRlZCByb3dzXG4gICAgICAgIGlmIChyb3dJbmRleCA8IDAgJiYgZ3JpZC50cmFuc2FjdGlvbnMuZW5hYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgZGF0YVdpdGhUcmFuc2FjdGlvbnMgPSBncmlkLmRhdGFXaXRoQWRkZWRJblRyYW5zYWN0aW9uUm93cztcbiAgICAgICAgICAgIHJvd0luZGV4ID0gZ3JpZC5wcmltYXJ5S2V5ID9cbiAgICAgICAgICAgIGRhdGFXaXRoVHJhbnNhY3Rpb25zLm1hcCgocmVjb3JkKSA9PiByZWNvcmRbZ3JpZC5wcmltYXJ5S2V5XSkuaW5kZXhPZihyb3dJRCkgOlxuICAgICAgICAgICAgZGF0YVdpdGhUcmFuc2FjdGlvbnMuaW5kZXhPZihyb3dJRCk7XG4gICAgICAgICAgICBpZiAocm93SW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy8gIENoZWNrIGlmIGJlbG93IGNoYW5nZSB3aWxsIHdvcmsgb24gYWRkZWQgcm93cyB3aXRoIHRyYW5zYWN0aW9uc1xuICAgICAgICAgICAgICAgIC8vIG9sZFZhbHVlID0gdGhpcy5nZXRfYWxsX2RhdGEoaWQsIHRydWUpW3Jvd0luZGV4XVtjb2x1bW4uZmllbGRdO1xuICAgICAgICAgICAgICAgIC8vIHJvd0RhdGEgPSB0aGlzLmdldF9hbGxfZGF0YShpZCwgdHJ1ZSlbcm93SW5kZXhdO1xuICAgICAgICAgICAgICAgIG9sZFZhbHVlID0gY29sdW1uSUQgIT09IG51bGwgPyBkYXRhV2l0aFRyYW5zYWN0aW9uc1tyb3dJbmRleF1bY29sdW1uLmZpZWxkXSA6IG51bGw7XG4gICAgICAgICAgICAgICAgcm93RGF0YSA9IGRhdGFXaXRoVHJhbnNhY3Rpb25zW3Jvd0luZGV4XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhcmdzID0ge1xuICAgICAgICAgICAgcm93SUQsXG4gICAgICAgICAgICAgICAgb2xkVmFsdWU6IG9sZFZhbHVlLFxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBlZGl0VmFsdWUsXG4gICAgICAgICAgICAgICAgY2FuY2VsOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICBpZiAoY2VsbE9iaikge1xuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihhcmdzLCB7XG4gICAgICAgICAgICAgICAgY2VsbElEOiBjZWxsT2JqLmNlbGxJRFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFyZ3MsXG4gICAgICAgICAgICBpc1Jvd1NlbGVjdGVkLFxuICAgICAgICAgICAgcm93RGF0YVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vICBUT0RPOiByZWZhY3RvciB1cGRhdGVfY2VsbC4gTWF5YmUgc2VwYXJhdGUgbG9naWMgaW4gdHdvIG1ldGhvZHMgLSBvbmUgd2l0aCB0cmFuc2FjdGlvblxuICAgIC8vICBhbmQgb25lIHdpdGhvdXQgdHJhbnNhY3Rpb25cbiAgICBwdWJsaWMgdXBkYXRlX2NlbGwoaWQ6IHN0cmluZywgcm93SUQsIGNvbHVtbklELCBlZGl0VmFsdWUsIGdyaWRFZGl0U3RhdGU/OiB7XG4gICAgICAgIGFyZ3M6IElHcmlkRWRpdEV2ZW50QXJncyxcbiAgICAgICAgaXNSb3dTZWxlY3RlZDogYm9vbGVhbixcbiAgICAgICAgcm93RGF0YTogYW55XG4gICAgfSk6IHZvaWQge1xuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXQoaWQpO1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRfYWxsX2RhdGEoaWQpO1xuICAgICAgICBjb25zdCBjdXJyZW50R3JpZEVkaXRTdGF0ZSA9IGdyaWRFZGl0U3RhdGUgfHwgdGhpcy5jcmVhdGVfZ3JpZF9lZGl0X2FyZ3MoaWQsIHJvd0lELCBjb2x1bW5JRCwgZWRpdFZhbHVlKTtcbiAgICAgICAgY29uc3QgZW1pdHRlZEFyZ3MgPSBjdXJyZW50R3JpZEVkaXRTdGF0ZS5hcmdzO1xuICAgICAgICBjb25zdCBjb2x1bW4gPSBncmlkLmNvbHVtbkxpc3QudG9BcnJheSgpW2NvbHVtbklEXTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSB0aGlzLmdldF9yb3dfaW5kZXhfaW5fZGF0YShpZCwgcm93SUQpO1xuXG4gICAgICAgIGlmIChlbWl0dGVkQXJncy5vbGRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIGN1cnJlbnRHcmlkRWRpdFN0YXRlLnJvd0RhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZ3JpZC5vbkNlbGxFZGl0LmVtaXQoZW1pdHRlZEFyZ3MpO1xuICAgICAgICAgICAgaWYgKGVtaXR0ZWRBcmdzLmNhbmNlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICBpZiB3ZSBhcmUgZWRpdGluZyB0aGUgY2VsbCBmb3Igc2Vjb25kIG9yIG5leHQgdGltZSwgZ2V0IHRoZSBvbGQgdmFsdWUgZnJvbSB0cmFuc2FjdGlvblxuICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWVJblRyYW5zYWN0aW9uID0gZ3JpZC50cmFuc2FjdGlvbnMuZ2V0QWdncmVnYXRlZFZhbHVlKHJvd0lELCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChvbGRWYWx1ZUluVHJhbnNhY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBlbWl0dGVkQXJncy5vbGRWYWx1ZSA9IG9sZFZhbHVlSW5UcmFuc2FjdGlvbltjb2x1bW4uZmllbGRdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyAgaWYgZWRpdCAobmV3KSB2YWx1ZSBpcyBzYW1lIGFzIG9sZCB2YWx1ZSBkbyBub3RoaW5nIGhlcmVcbiAgICAgICAgICAgIGlmIChlbWl0dGVkQXJncy5vbGRWYWx1ZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgJiYgaXNFcXVhbChlbWl0dGVkQXJncy5vbGRWYWx1ZSwgZW1pdHRlZEFyZ3MubmV3VmFsdWUpKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uID0ge1xuICAgICAgICAgICAgICAgIGlkOiByb3dJRCwgdHlwZTogVHJhbnNhY3Rpb25UeXBlLlVQREFURSwgbmV3VmFsdWU6IHsgW2NvbHVtbi5maWVsZF06IGVtaXR0ZWRBcmdzLm5ld1ZhbHVlIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoZ3JpZC50cmFuc2FjdGlvbnMuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIGdyaWQudHJhbnNhY3Rpb25zLmFkZCh0cmFuc2FjdGlvbiwgY3VycmVudEdyaWRFZGl0U3RhdGUucm93RGF0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvd1ZhbHVlID0gdGhpcy5nZXRfYWxsX2RhdGEoaWQpW3Jvd0luZGV4XTtcbiAgICAgICAgICAgICAgICBtZXJnZU9iamVjdHMocm93VmFsdWUsIHtbY29sdW1uLmZpZWxkXTogZW1pdHRlZEFyZ3MubmV3VmFsdWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JpZC5wcmltYXJ5S2V5ID09PSBjb2x1bW4uZmllbGQgJiYgY3VycmVudEdyaWRFZGl0U3RhdGUuaXNSb3dTZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIGdyaWQuc2VsZWN0aW9uLmRlc2VsZWN0X2l0ZW0oaWQsIHJvd0lEKTtcbiAgICAgICAgICAgICAgICBncmlkLnNlbGVjdGlvbi5zZWxlY3RfaXRlbShpZCwgZW1pdHRlZEFyZ3MubmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFncmlkLnJvd0VkaXRhYmxlIHx8ICFncmlkLnJvd0luRWRpdE1vZGUgfHwgZ3JpZC5yb3dJbkVkaXRNb2RlLnJvd0lEICE9PSByb3dJRCkge1xuICAgICAgICAgICAgICAgIChncmlkIGFzIGFueSkuX3BpcGVUcmlnZ2VyKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlX3Jvdyh2YWx1ZTogYW55LCBpZDogc3RyaW5nLCByb3dJRDogYW55LCBncmlkU3RhdGU/OiB7XG4gICAgICAgIGFyZ3M6IElHcmlkRWRpdEV2ZW50QXJncyxcbiAgICAgICAgaXNSb3dTZWxlY3RlZDogYm9vbGVhbixcbiAgICAgICAgcm93RGF0YTogYW55XG4gICAgfSk6IHZvaWQge1xuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5nZXQoaWQpO1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRfYWxsX2RhdGEoaWQpO1xuICAgICAgICBjb25zdCBjdXJyZW50R3JpZFN0YXRlID0gZ3JpZFN0YXRlID8gZ3JpZFN0YXRlIDogdGhpcy5jcmVhdGVfZ3JpZF9lZGl0X2FyZ3MoaWQsIHJvd0lELCBudWxsLCB2YWx1ZSk7XG4gICAgICAgIGNvbnN0IGVtaXRBcmdzID0gY3VycmVudEdyaWRTdGF0ZS5hcmdzO1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0X3Jvd19pbmRleF9pbl9kYXRhKGlkLCByb3dJRCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJbkVkaXRNb2RlID0gdGhpcy5nZXRfZWRpdF9yb3dfc3RhdGUoaWQpO1xuICAgICAgICBsZXQgb2xkVmFsdWUgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhW2luZGV4XSk7XG4gICAgICAgIGlmIChncmlkLmN1cnJlbnRSb3dTdGF0ZSAmJiBncmlkLmN1cnJlbnRSb3dTdGF0ZVtncmlkLnByaW1hcnlLZXldID09PSByb3dJRFxuICAgICAgICAgICAgfHwgY3VycmVudFJvd0luRWRpdE1vZGUgJiYgY3VycmVudFJvd0luRWRpdE1vZGUucm93SUQgPT09IHJvd0lEKSB7XG4gICAgICAgICAgICBvbGRWYWx1ZSA9IE9iamVjdC5hc3NpZ24ob2xkVmFsdWUsIGdyaWQuY3VycmVudFJvd1N0YXRlKTtcbiAgICAgICAgfSBlbHNlIGlmIChncmlkLnRyYW5zYWN0aW9ucy5lbmFibGVkKSB7XG4gICAgICAgICAgICAvLyBJZiB0cmFuc2FjdGlvbnMgYXJlIGVuYWJsZWQsIG9sZCB2YWx1ZSA9PSBsYXN0IGNvbW1pdGVkIHZhbHVlIChhcyBpdCdzIG5vdCBhcHBsaWVkIGluIGRhdGEgeWV0KVxuICAgICAgICAgICAgY29uc3QgbGFzdENvbW1pdGVkVmFsdWUgPSAvLyBMYXN0IGNvbW1pdGVkIHZhbHVlICh3L28gcGVuZGluZylcbiAgICAgICAgICAgICAgICBncmlkLnRyYW5zYWN0aW9ucy5nZXRTdGF0ZShyb3dJRCkgPyBPYmplY3QuYXNzaWduKHt9LCBncmlkLnRyYW5zYWN0aW9ucy5nZXRTdGF0ZShyb3dJRCkudmFsdWUpIDogbnVsbDtcbiAgICAgICAgICAgIG9sZFZhbHVlID0gbGFzdENvbW1pdGVkVmFsdWUgPyBPYmplY3QuYXNzaWduKG9sZFZhbHVlLCBsYXN0Q29tbWl0ZWRWYWx1ZSkgOiBvbGRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3QuYXNzaWduKGVtaXRBcmdzLCB7IG9sZFZhbHVlLCByb3dJRH0pO1xuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBncmlkLm9uUm93RWRpdC5lbWl0KGVtaXRBcmdzKTtcbiAgICAgICAgICAgIGlmIChlbWl0QXJncy5jYW5jZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VycmVudFJvd0luRWRpdE1vZGUpIHtcbiAgICAgICAgICAgICAgICBncmlkLnRyYW5zYWN0aW9ucy5lbmRQZW5kaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncmlkLnRyYW5zYWN0aW9ucy5lbmFibGVkICYmIGVtaXRBcmdzLm5ld1ZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZ3JpZC50cmFuc2FjdGlvbnMuYWRkKHtpZDogcm93SUQsIG5ld1ZhbHVlOiBlbWl0QXJncy5uZXdWYWx1ZSwgdHlwZTogVHJhbnNhY3Rpb25UeXBlLlVQREFURX0sIGVtaXRBcmdzLm9sZFZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW1pdEFyZ3MubmV3VmFsdWUgIT09IG51bGwgJiYgZW1pdEFyZ3MubmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YVtpbmRleF0sIGVtaXRBcmdzLm5ld1ZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50R3JpZFN0YXRlLmlzUm93U2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBncmlkLnNlbGVjdGlvbi5kZXNlbGVjdF9pdGVtKGlkLCByb3dJRCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3Um93SUQgPSAoZ3JpZC5wcmltYXJ5S2V5KSA/IGVtaXRBcmdzLm5ld1ZhbHVlW2dyaWQucHJpbWFyeUtleV0gOiBlbWl0QXJncy5uZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICBncmlkLnNlbGVjdGlvbi5zZWxlY3RfaXRlbShpZCwgbmV3Um93SUQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKGdyaWQgYXMgYW55KS5fcGlwZVRyaWdnZXIrKztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCB1cGRhdGVfcm93X2luX2FycmF5KGlkOiBzdHJpbmcsIHZhbHVlOiBhbnksIHJvd0lEOiBhbnksIGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgZ3JpZCA9IHRoaXMuZ2V0KGlkKTtcbiAgICAgICAgZ3JpZC5kYXRhW2luZGV4XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzb3J0KGlkOiBzdHJpbmcsIGZpZWxkTmFtZTogc3RyaW5nLCBkaXI6IFNvcnRpbmdEaXJlY3Rpb24sIGlnbm9yZUNhc2U6IGJvb2xlYW4sIHN0cmF0ZWd5OiBJU29ydGluZ1N0cmF0ZWd5KTogdm9pZCB7XG4gICAgICAgIGlmIChkaXIgPT09IFNvcnRpbmdEaXJlY3Rpb24uTm9uZSkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVfZ3JvdXBpbmdfZXhwcmVzc2lvbihpZCwgZmllbGROYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzb3J0aW5nU3RhdGUgPSBjbG9uZUFycmF5KHRoaXMuZ2V0KGlkKS5zb3J0aW5nRXhwcmVzc2lvbnMpO1xuICAgICAgICBzdHJhdGVneSA9IHN0cmF0ZWd5ID8gc3RyYXRlZ3kgOiB0aGlzLmdldFNvcnRTdHJhdGVneVBlckNvbHVtbihpZCwgZmllbGROYW1lKTtcbiAgICAgICAgdGhpcy5wcmVwYXJlX3NvcnRpbmdfZXhwcmVzc2lvbihbc29ydGluZ1N0YXRlXSwgeyBmaWVsZE5hbWUsIGRpciwgaWdub3JlQ2FzZSwgc3RyYXRlZ3kgfSk7XG4gICAgICAgIHRoaXMuZ2V0KGlkKS5zb3J0aW5nRXhwcmVzc2lvbnMgPSBzb3J0aW5nU3RhdGU7XG4gICAgfVxuXG4gICAgcHVibGljIHNvcnRfbXVsdGlwbGUoaWQ6IHN0cmluZywgZXhwcmVzc2lvbnM6IElTb3J0aW5nRXhwcmVzc2lvbltdKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHNvcnRpbmdTdGF0ZSA9IGNsb25lQXJyYXkodGhpcy5nZXQoaWQpLnNvcnRpbmdFeHByZXNzaW9ucyk7XG5cbiAgICAgICAgZm9yIChjb25zdCBlYWNoIG9mIGV4cHJlc3Npb25zKSB7XG4gICAgICAgICAgICBpZiAoZWFjaC5kaXIgPT09IFNvcnRpbmdEaXJlY3Rpb24uTm9uZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlX2dyb3VwaW5nX2V4cHJlc3Npb24oaWQsIGVhY2guZmllbGROYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVhY2guc3RyYXRlZ3kgPSBlYWNoLnN0cmF0ZWd5ID8gZWFjaC5zdHJhdGVneSA6IHRoaXMuZ2V0U29ydFN0cmF0ZWd5UGVyQ29sdW1uKGlkLCBlYWNoLmZpZWxkTmFtZSk7XG4gICAgICAgICAgICB0aGlzLnByZXBhcmVfc29ydGluZ19leHByZXNzaW9uKFtzb3J0aW5nU3RhdGVdLCBlYWNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ2V0KGlkKS5zb3J0aW5nRXhwcmVzc2lvbnMgPSBzb3J0aW5nU3RhdGU7XG4gICAgfVxuXG4gICAgcHVibGljIGZpbHRlcihpZDogc3RyaW5nLCBmaWVsZE5hbWU6IHN0cmluZywgdGVybSwgY29uZGl0aW9uT3JFeHByZXNzaW9uc1RyZWU6IElGaWx0ZXJpbmdPcGVyYXRpb24gfCBJRmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlLFxuICAgICAgICBpZ25vcmVDYXNlOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldChpZCk7XG4gICAgICAgIGNvbnN0IGZpbHRlcmluZ1RyZWUgPSBncmlkLmZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZTtcbiAgICAgICAgZ3JpZC5lbmRFZGl0KGZhbHNlKTtcblxuICAgICAgICBpZiAoZ3JpZC5wYWdpbmcpIHtcbiAgICAgICAgICAgIGdyaWQucGFnZSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmaWVsZEZpbHRlckluZGV4ID0gZmlsdGVyaW5nVHJlZS5maW5kSW5kZXgoZmllbGROYW1lKTtcbiAgICAgICAgaWYgKGZpZWxkRmlsdGVySW5kZXggPiAtMSkge1xuICAgICAgICAgICAgZmlsdGVyaW5nVHJlZS5maWx0ZXJpbmdPcGVyYW5kcy5zcGxpY2UoZmllbGRGaWx0ZXJJbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnByZXBhcmVfZmlsdGVyaW5nX2V4cHJlc3Npb24oZmlsdGVyaW5nVHJlZSwgZmllbGROYW1lLCB0ZXJtLCBjb25kaXRpb25PckV4cHJlc3Npb25zVHJlZSwgaWdub3JlQ2FzZSk7XG4gICAgICAgIGdyaWQuZmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlID0gZmlsdGVyaW5nVHJlZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZmlsdGVyX2dsb2JhbChpZCwgdGVybSwgY29uZGl0aW9uLCBpZ25vcmVDYXNlKSB7XG4gICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldChpZCk7XG4gICAgICAgIGNvbnN0IGZpbHRlcmluZ1RyZWUgPSBncmlkLmZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZTtcbiAgICAgICAgaWYgKGdyaWQucGFnaW5nKSB7XG4gICAgICAgICAgICBncmlkLnBhZ2UgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgZmlsdGVyaW5nVHJlZS5maWx0ZXJpbmdPcGVyYW5kcyA9IFtdO1xuICAgICAgICB0aGlzLnJlbW92ZV9zdW1tYXJ5KGlkKTtcblxuICAgICAgICBpZiAoY29uZGl0aW9uKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNvbHVtbiBvZiBncmlkLmNvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByZXBhcmVfZmlsdGVyaW5nX2V4cHJlc3Npb24oZmlsdGVyaW5nVHJlZSwgY29sdW1uLmZpZWxkLCB0ZXJtLFxuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb24sIGlnbm9yZUNhc2UgfHwgY29sdW1uLmZpbHRlcmluZ0lnbm9yZUNhc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZ3JpZC5maWx0ZXJpbmdFeHByZXNzaW9uc1RyZWUgPSBmaWx0ZXJpbmdUcmVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhcl9maWx0ZXIoaWQsIGZpZWxkTmFtZSkge1xuICAgICAgICBpZiAoZmllbGROYW1lKSB7XG4gICAgICAgICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmdldF9jb2x1bW5fYnlfbmFtZShpZCwgZmllbGROYW1lKTtcbiAgICAgICAgICAgIGlmICghY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZ3JpZCA9IHRoaXMuZ2V0KGlkKTtcbiAgICAgICAgY29uc3QgZmlsdGVyaW5nU3RhdGUgPSBncmlkLmZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBmaWx0ZXJpbmdTdGF0ZS5maW5kSW5kZXgoZmllbGROYW1lKTtcblxuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgZmlsdGVyaW5nU3RhdGUuZmlsdGVyaW5nT3BlcmFuZHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlX3N1bW1hcnkoaWQsIGZpZWxkTmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmaWx0ZXJpbmdTdGF0ZS5maWx0ZXJpbmdPcGVyYW5kcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVfc3VtbWFyeShpZCk7XG4gICAgICAgIH1cblxuICAgICAgICBncmlkLmZpbHRlcmVkRGF0YSA9IG51bGw7XG4gICAgICAgIGdyaWQuZmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlID0gZmlsdGVyaW5nU3RhdGU7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNhbGN1bGF0ZVN1bW1hcmllcyhpZDogc3RyaW5nLCBjb2x1bW4sIGRhdGEpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN1bW1hcnlDYWNoZU1hcC5nZXQoaWQpLmdldChjb2x1bW4uZmllbGQpKSB7XG4gICAgICAgICAgICB0aGlzLnN1bW1hcnlDYWNoZU1hcC5nZXQoaWQpLnNldChjb2x1bW4uZmllbGQsXG4gICAgICAgICAgICAgICAgY29sdW1uLnN1bW1hcmllcy5vcGVyYXRlKGRhdGEpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhcl9zb3J0KGlkLCBmaWVsZE5hbWUpIHtcbiAgICAgICAgY29uc3Qgc29ydGluZ1N0YXRlID0gdGhpcy5nZXQoaWQpLnNvcnRpbmdFeHByZXNzaW9ucztcbiAgICAgICAgY29uc3QgaW5kZXggPSBzb3J0aW5nU3RhdGUuZmluZEluZGV4KChleHByKSA9PiBleHByLmZpZWxkTmFtZSA9PT0gZmllbGROYW1lKTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHNvcnRpbmdTdGF0ZS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdGhpcy5nZXQoaWQpLnNvcnRpbmdFeHByZXNzaW9ucyA9IHNvcnRpbmdTdGF0ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBwcmVwYXJlX2ZpbHRlcmluZ19leHByZXNzaW9uKGZpbHRlcmluZ1N0YXRlOiBJRmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlLCBmaWVsZE5hbWU6IHN0cmluZywgc2VhcmNoVmFsLFxuICAgICAgICBjb25kaXRpb25PckV4cHJlc3Npb25zVHJlZTogSUZpbHRlcmluZ09wZXJhdGlvbiB8IElGaWx0ZXJpbmdFeHByZXNzaW9uc1RyZWUsIGlnbm9yZUNhc2U6IGJvb2xlYW4pIHtcblxuICAgICAgICBsZXQgbmV3RXhwcmVzc2lvbnNUcmVlO1xuICAgICAgICBjb25zdCBvbGRFeHByZXNzaW9uc1RyZWVJbmRleCA9IGZpbHRlcmluZ1N0YXRlLmZpbmRJbmRleChmaWVsZE5hbWUpO1xuICAgICAgICBjb25zdCBleHByZXNzaW9uc1RyZWUgPSBjb25kaXRpb25PckV4cHJlc3Npb25zVHJlZSBpbnN0YW5jZW9mIEZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZSA/XG4gICAgICAgICAgICBjb25kaXRpb25PckV4cHJlc3Npb25zVHJlZSBhcyBJRmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlIDogbnVsbDtcbiAgICAgICAgY29uc3QgY29uZGl0aW9uID0gY29uZGl0aW9uT3JFeHByZXNzaW9uc1RyZWUgaW5zdGFuY2VvZiBGaWx0ZXJpbmdFeHByZXNzaW9uc1RyZWUgP1xuICAgICAgICAgICAgbnVsbCA6IGNvbmRpdGlvbk9yRXhwcmVzc2lvbnNUcmVlIGFzIElGaWx0ZXJpbmdPcGVyYXRpb247XG4gICAgICAgIGNvbnN0IG5ld0V4cHJlc3Npb246IElGaWx0ZXJpbmdFeHByZXNzaW9uID0geyBmaWVsZE5hbWUsIHNlYXJjaFZhbCwgY29uZGl0aW9uLCBpZ25vcmVDYXNlIH07XG5cbiAgICAgICAgaWYgKG9sZEV4cHJlc3Npb25zVHJlZUluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgLy8gbm8gZXhwcmVzc2lvbnMgdHJlZSBmb3VuZCBmb3IgdGhpcyBmaWVsZFxuICAgICAgICAgICAgaWYgKGV4cHJlc3Npb25zVHJlZSkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmluZ1N0YXRlLmZpbHRlcmluZ09wZXJhbmRzLnB1c2goZXhwcmVzc2lvbnNUcmVlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGV4cHJlc3Npb25zIHRyZWUgZm9yIHRoaXMgZmllbGQgYW5kIGFkZCB0aGUgbmV3IGV4cHJlc3Npb24gdG8gaXRcbiAgICAgICAgICAgICAgICBuZXdFeHByZXNzaW9uc1RyZWUgPSBuZXcgRmlsdGVyaW5nRXhwcmVzc2lvbnNUcmVlKGZpbHRlcmluZ1N0YXRlLm9wZXJhdG9yLCBmaWVsZE5hbWUpO1xuICAgICAgICAgICAgICAgIG5ld0V4cHJlc3Npb25zVHJlZS5maWx0ZXJpbmdPcGVyYW5kcy5wdXNoKG5ld0V4cHJlc3Npb24pO1xuICAgICAgICAgICAgICAgIGZpbHRlcmluZ1N0YXRlLmZpbHRlcmluZ09wZXJhbmRzLnB1c2gobmV3RXhwcmVzc2lvbnNUcmVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBwcmVwYXJlX3NvcnRpbmdfZXhwcmVzc2lvbihzdGF0ZUNvbGxlY3Rpb25zOiBBcnJheTxBcnJheTxhbnk+PiwgZXhwcmVzc2lvbjogSVNvcnRpbmdFeHByZXNzaW9uKSB7XG4gICAgICAgIGlmIChleHByZXNzaW9uLmRpciA9PT0gU29ydGluZ0RpcmVjdGlvbi5Ob25lKSB7XG4gICAgICAgICAgICBzdGF0ZUNvbGxlY3Rpb25zLmZvckVhY2goc3RhdGUgPT4ge1xuICAgICAgICAgICAgICAgIHN0YXRlLnNwbGljZShzdGF0ZS5maW5kSW5kZXgoKGV4cHIpID0+IGV4cHIuZmllbGROYW1lID09PSBleHByZXNzaW9uLmZpZWxkTmFtZSksIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogV2UgbmVlZCB0byBtYWtlIHN1cmUgdGhlIHN0YXRlcyBpbiBlYWNoIGNvbGxlY3Rpb24gd2l0aCBzYW1lIGZpZWxkcyBwb2ludCB0byB0aGUgc2FtZSBvYmplY3QgcmVmZXJlbmNlLlxuICAgICAgICAgKiBJZiB0aGUgZGlmZmVyZW50IHN0YXRlIGNvbGxlY3Rpb25zIHByb3ZpZGVkIGhhdmUgZGlmZmVyZW50IHNpemVzIHdlIG5lZWQgdG8gZ2V0IHRoZSBsYXJnZXN0IG9uZS5cbiAgICAgICAgICogVGhhdCB3YXkgd2UgY2FuIGdldCB0aGUgc3RhdGUgcmVmZXJlbmNlIGZyb20gdGhlIGxhcmdlc3Qgb25lIHRoYXQgaGFzIHRoZSBzYW1lIGZpZWxkTmFtZSBhcyB0aGUgZXhwcmVzc2lvbiB0byBwcmVwYXJlLlxuICAgICAgICAgKi9cbiAgICAgICAgbGV0IG1heENvbGxlY3Rpb24gPSBzdGF0ZUNvbGxlY3Rpb25zWzBdO1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN0YXRlQ29sbGVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChtYXhDb2xsZWN0aW9uLmxlbmd0aCA8IHN0YXRlQ29sbGVjdGlvbnNbaV0ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbWF4Q29sbGVjdGlvbiA9IHN0YXRlQ29sbGVjdGlvbnNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF4RXhwciA9IG1heENvbGxlY3Rpb24uZmluZCgoZXhwcikgPT4gZXhwci5maWVsZE5hbWUgPT09IGV4cHJlc3Npb24uZmllbGROYW1lKTtcblxuICAgICAgICBzdGF0ZUNvbGxlY3Rpb25zLmZvckVhY2goY29sbGVjdGlvbiA9PiB7XG4gICAgICAgICAgICBjb25zdCBteUV4cHIgPSBjb2xsZWN0aW9uLmZpbmQoKGV4cHIpID0+IGV4cHIuZmllbGROYW1lID09PSBleHByZXNzaW9uLmZpZWxkTmFtZSk7XG4gICAgICAgICAgICBpZiAoIW15RXhwciAmJiAhbWF4RXhwcikge1xuICAgICAgICAgICAgICAgIC8vIEV4cHJlc3Npb24gd2l0aCB0aGlzIGZpZWxkTmFtZSBpcyBtaXNzaW5nIGZyb20gdGhlIGN1cnJlbnQgYW5kIHRoZSBtYXggY29sbGVjdGlvbi5cbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLnB1c2goZXhwcmVzc2lvbik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFteUV4cHIgJiYgbWF4RXhwcikge1xuICAgICAgICAgICAgICAgIC8vIEV4cHJlc3Npb24gd2l0aCB0aGlzIGZpZWxkTmFtZSBpcyBtaXNzaW5nIGZyb20gdGhlIGN1cnJlbnQgYW5kIGJ1dCB0aGUgbWF4IGNvbGxlY3Rpb24gaGFzLlxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24ucHVzaChtYXhFeHByKTtcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG1heEV4cHIsIGV4cHJlc3Npb24pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgY3VycmVudCBjb2xsZWN0aW9uIGhhcyB0aGUgZXhwcmVzc2lvbiBzbyBqdXN0IHVwZGF0ZSBpdC5cbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG15RXhwciwgZXhwcmVzc2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCByZW1vdmVfZ3JvdXBpbmdfZXhwcmVzc2lvbihpZCwgZmllbGROYW1lKSB7XG4gICAgICAgIH1cblxuICAgIHB1YmxpYyBzaG91bGRfYXBwbHlfbnVtYmVyX3N0eWxlKGNvbHVtbjogSWd4Q29sdW1uQ29tcG9uZW50KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBjb2x1bW4uZGF0YVR5cGUgPT09IERhdGFUeXBlLk51bWJlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0X2FsbF9kYXRhKGlkOiBzdHJpbmcsIHRyYW5zYWN0aW9ucz86IGJvb2xlYW4pOiBhbnlbXSB7XG4gICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldChpZCk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB0cmFuc2FjdGlvbnMgPyBncmlkLmRhdGFXaXRoQWRkZWRJblRyYW5zYWN0aW9uUm93cyA6IGdyaWQuZGF0YTtcbiAgICAgICAgcmV0dXJuIGRhdGEgPyBkYXRhIDogW107XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldFNvcnRTdHJhdGVneVBlckNvbHVtbihpZDogc3RyaW5nLCBmaWVsZE5hbWU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRfY29sdW1uX2J5X25hbWUodGhpcy5nZXQoaWQpLmlkLCBmaWVsZE5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ2V0X2NvbHVtbl9ieV9uYW1lKGlkLCBmaWVsZE5hbWUpLnNvcnRTdHJhdGVneSA6IHVuZGVmaW5lZDtcbiAgICB9XG59XG4iXX0=