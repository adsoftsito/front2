/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ChangeDetectorRef, Component, HostBinding, Input, Optional, ViewChild } from '@angular/core';
import { CsvFileTypes, IgxCsvExporterOptions, IgxCsvExporterService, IgxExcelExporterOptions, IgxExcelExporterService, AbsoluteScrollStrategy } from '../services/index';
import { GridBaseAPIService } from './api.service';
import { IgxDropDownComponent } from '../drop-down/drop-down.component';
import { IgxColumnHidingComponent } from './column-hiding.component';
import { IgxColumnPinningComponent } from './column-pinning.component';
import { HorizontalAlignment, VerticalAlignment } from '../services/overlay/utilities';
import { ConnectedPositioningStrategy } from '../services/overlay/position';
/**
 * @hidden
 */
export class IgxGridToolbarComponent {
    /**
     * @param {?} gridAPI
     * @param {?} cdr
     * @param {?} excelExporter
     * @param {?} csvExporter
     */
    constructor(gridAPI, cdr, excelExporter, csvExporter) {
        this.gridAPI = gridAPI;
        this.cdr = cdr;
        this.excelExporter = excelExporter;
        this.csvExporter = csvExporter;
        this._filterColumnsPrompt = 'Filter columns list ...';
        this._positionSettings = {
            horizontalDirection: HorizontalAlignment.Left,
            horizontalStartPoint: HorizontalAlignment.Right,
            verticalDirection: VerticalAlignment.Bottom,
            verticalStartPoint: VerticalAlignment.Bottom
        };
        this._overlaySettings = {
            positionStrategy: new ConnectedPositioningStrategy(this._positionSettings),
            scrollStrategy: new AbsoluteScrollStrategy(),
            modal: false,
            closeOnOutsideClick: true
        };
    }
    /**
     * Gets the default text shown in the filtering box.
     * ```typescript
     * const filterPrompt = this.grid.toolbar.filterColumnsPrompt;
     * ```
     * @return {?}
     */
    get filterColumnsPrompt() {
        return this._filterColumnsPrompt;
    }
    /**
     * Sets the default text shown in the filtering box.
     * ```typescript
     * this.grid.toolbar.filterColumnsPrompt('Filter columns ...');
     * ```
     * @param {?} value
     * @return {?}
     */
    set filterColumnsPrompt(value) {
        this._filterColumnsPrompt = value;
    }
    /**
     * Gets the height for the `IgxGridToolbarComponent`'s drop down panels.
     * ```typescript
     * const dropdownHeight = this.grid.toolbar.defaultDropDownsMaxHeight;
     * ```
     * @return {?}
     */
    get defaultDropDownsMaxHeight() {
        const /** @type {?} */ gridHeight = this.grid.calcHeight;
        return (gridHeight) ? gridHeight * 0.7 + 'px' : '100%';
    }
    /**
     * Returns a reference to the `IgxGridComponent` component, hosting the `IgxGridToolbarComponent`.
     * ```typescript
     * const grid = this.igxGrid1.toolbar.grid;
     * ```
     * @return {?}
     */
    get grid() {
        return this.gridAPI.get(this.gridID);
    }
    /**
     * Returns whether the `IgxGridComponent` renders an export button.
     * ```typescript
     * cosnt exportButton = this.igxGrid1.toolbar.shouldShowExportButton;
     * ```
     * @return {?}
     */
    get shouldShowExportButton() {
        return (this.grid != null && (this.grid.exportExcel || this.grid.exportCsv));
    }
    /**
     * Returns whether the `IgxGridComponent` renders an Excel export button.
     * ```typescript
     * cosnt exportExcelButton = this.igxGrid1.toolbar.shouldShowExportExcelButton;
     * ```
     * @return {?}
     */
    get shouldShowExportExcelButton() {
        return (this.grid != null && this.grid.exportExcel);
    }
    /**
     * Returns whether the `IgxGridComponent` renders an CSV export button.
     * ```typescript
     * cosnt exportCSVButton = this.igxGrid1.toolbar.shouldShowExportCsvButton;
     * ```
     * @return {?}
     */
    get shouldShowExportCsvButton() {
        return (this.grid != null && this.grid.exportCsv);
    }
    /**
     * Returns how many columns are pinned.
     * ```typescript
     * const pinnedCount = this.igxGrid1.toolbar.pinnedColumnsCount;
     * ```
     * @return {?}
     */
    get pinnedColumnsCount() {
        return this.grid.pinnedColumns.length;
    }
    /**
     * Returns the theme of the `IgxGridToolbarComponent`.
     * The default theme is `comfortable`.
     * Available options are `comfortable`, `cosy`, `compact`.
     * ```typescript
     * let toolbarTheme = this.grid.toolbar.displayDensity;
     * ```
     * @return {?}
     */
    get displayDensity() {
        return this._displayDensity;
    }
    /**
     * Sets the theme of the `IgxGridToolbarComponent`.
     * ```html
     * <igx-grid #grid [data]="localData" [displayDensity]="'compact'" [autoGenerate]="true"></igx-grid>
     * ```
     * @param {?} val
     * @return {?}
     */
    set displayDensity(val) {
        switch (val) {
            case 'compact':
                this._displayDensity = "compact" /* compact */;
                break;
            case 'cosy':
                this._displayDensity = "cosy" /* cosy */;
                break;
            case 'comfortable':
            default:
                this._displayDensity = "comfortable" /* comfortable */;
        }
    }
    /**
     * Returns the theme of the `IgxGridToolbarComponent`.
     * ```typescript
     * const toolbarTheme = this.grid.toolbar.hostClass;
     * ```
     * @return {?}
     */
    get hostClass() {
        switch (this._displayDensity) {
            case "compact" /* compact */:
                return 'igx-grid-toolbar--compact';
            case "cosy" /* cosy */:
                return 'igx-grid-toolbar--cosy';
            case "comfortable" /* comfortable */:
            default:
                return 'igx-grid-toolbar';
        }
    }
    /**
     * Returns the title of `IgxGridToolbarComponent`.
     * ```typescript
     * const toolbarTitle = this.igxGrid1.toolbar.getTitle();
     * ```
     * @return {?}
     */
    getTitle() {
        return this.grid != null ? this.grid.toolbarTitle : '';
    }
    /**
     * Returns the text of the export button of the `IgxGridToolbarComponent`.
     * ```typescript
     * const toolbarExportText = this.igxGrid1.toolbar.getTitle();
     * ```
     * @return {?}
     */
    getExportText() {
        return this.grid != null ? this.grid.exportText : '';
    }
    /**
     * Returns the text of the Excel export button of the `IgxGridToolbarComponent`.
     * ```typescript
     * const toolbarExcelText = this.igxGrid1.toolbar.getExportExcelText();
     * ```
     * @return {?}
     */
    getExportExcelText() {
        return this.grid != null ? this.grid.exportExcelText : '';
    }
    /**
     * Returns the text of the CSV export button of the `IgxGridToolbarComponent`.
     * ```typescript
     * const toolbarCSVText = this.igxGrid1.toolbar.getExportCsvText();
     * ```
     * @return {?}
     */
    getExportCsvText() {
        return this.grid != null ? this.grid.exportCsvText : '';
    }
    /**
     * Toggles the export button's dropdown menu.
     * ```typescript
     * this.igxGrid1.toolbar.exportClicked();
     * ```
     * @return {?}
     */
    exportClicked() {
        this._overlaySettings.positionStrategy.settings.target = this.exportButton.nativeElement;
        this._overlaySettings.outlet = this.grid.outletDirective;
        this.exportDropdown.toggle(this._overlaySettings);
    }
    /**
     * Exports the grid to excel.
     * ```typescript
     * this.igxGrid1.toolbar.exportToExcelClicked();
     * ```
     * @return {?}
     */
    exportToExcelClicked() {
        this.performExport(this.excelExporter, 'excel');
    }
    /**
     * Exports the grid to CSV.
     * ```typescript
     * this.igxGrid1.toolbar.exportToCsvClicked();
     * ```
     * @return {?}
     */
    exportToCsvClicked() {
        this.performExport(this.csvExporter, 'csv');
    }
    /**
     * @param {?} exp
     * @param {?} exportType
     * @return {?}
     */
    performExport(exp, exportType) {
        this.exportClicked();
        const /** @type {?} */ fileName = 'ExportedData';
        const /** @type {?} */ options = exportType === 'excel' ?
            new IgxExcelExporterOptions(fileName) :
            new IgxCsvExporterOptions(fileName, CsvFileTypes.CSV);
        const /** @type {?} */ args = { grid: this.grid, exporter: exp, options: options, cancel: false };
        this.grid.onToolbarExporting.emit(args);
        if (args.cancel) {
            return;
        }
        exp.export(this.grid, options);
    }
    /**
     * Toggles the Column Hiding UI.
     * ```typescript
     * grid1.toolbar.toggleColumnHidingUI();
     * ```
     * @return {?}
     */
    toggleColumnHidingUI() {
        this._overlaySettings.positionStrategy.settings.target = this.columnHidingButton.nativeElement;
        this._overlaySettings.outlet = this.grid.outletDirective;
        this.columnHidingDropdown.toggle(this._overlaySettings);
    }
    /**
     * Toggles the Column Pinning UI.
     * ```typescript
     * grid1.toolbar.toggleColumnPinningUI();
     * ```
     * @return {?}
     */
    toggleColumnPinningUI() {
        this._overlaySettings.positionStrategy.settings.target = this.columnPinningButton.nativeElement;
        this._overlaySettings.outlet = this.grid.outletDirective;
        this.columnPinningDropdown.toggle(this._overlaySettings);
    }
}
IgxGridToolbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'igx-grid-toolbar',
                template: `<span class="igx-grid-toolbar__title">
    {{ getTitle() }}
</span>

<div class="igx-grid-toolbar__actions">
    <div *ngIf="grid.columnHiding">
        <button igxButton="flat" #columnHidingButton name="btnColumnHiding" igxButton igxRipple
            (click)="toggleColumnHidingUI()">
            <div  class="igx-grid-toolbar__button-space">
                <igx-icon *ngIf="grid.hiddenColumnsCount > 0">visibility_off</igx-icon>
                <igx-icon *ngIf="grid.hiddenColumnsCount === 0">visibility</igx-icon>
                <span>{{ grid.hiddenColumnsCount }}</span>
                <span>{{ grid.hiddenColumnsText }}</span>
            </div>
        </button>
        <igx-drop-down #columnHidingDropdown>
            <igx-column-hiding
                [columns]="grid.columnList"
                [title]="grid.columnHidingTitle"
                [filterColumnsPrompt]="filterColumnsPrompt"
                [columnsAreaMaxHeight]="defaultDropDownsMaxHeight"
                (onColumnVisibilityChanged)="grid.toggleColumnVisibility($event)">
            </igx-column-hiding>
        </igx-drop-down>
    </div>
    <div *ngIf="grid.columnPinning">
        <button igxButton="flat" #columnPinningButton name="btnColumnPinning" igxButton igxRipple
            (click)="toggleColumnPinningUI()">
            <div  class="igx-grid-toolbar__button-space">
                <igx-icon *ngIf="pinnedColumnsCount > 0">lock</igx-icon>
                <igx-icon *ngIf="pinnedColumnsCount === 0">lock_open</igx-icon>
                <span>{{ pinnedColumnsCount }}</span>
                <span>{{ grid.pinnedColumnsText }}</span>
                <span></span>
            </div>
        </button>
        <igx-drop-down #columnPinningDropdown>
            <igx-column-pinning
                [columns]="grid.columnList"
                [title]="grid.columnPinningTitle"
                [filterColumnsPrompt]="filterColumnsPrompt"
                [columnsAreaMaxHeight]="defaultDropDownsMaxHeight"></igx-column-pinning>
        </igx-drop-down>
    </div>


    <div class="igx-grid-toolbar__dropdown" *ngIf="shouldShowExportButton" id="btnExport">
        <button igxButton="flat" igxRipple #btnExport
                (click)="exportClicked()">
            <span class="igx-grid-toolbar__button-space">
                <igx-icon fontSet="material">import_export</igx-icon>
                <span>{{ getExportText() }}</span>
                <igx-icon fontSet="material">arrow_drop_down</igx-icon>
            </span>
        </button>

        <igx-drop-down #exportDropdown>
            <ul class="igx-grid-toolbar__dd-list">
                <li class="igx-grid-toolbar__dd-list-items" igxRipple *ngIf="shouldShowExportExcelButton" id="btnExportExcel"
                (click)="exportToExcelClicked()">{{ getExportExcelText() }}</li>
                <li class="igx-grid-toolbar__dd-list-items" igxRipple *ngIf="shouldShowExportCsvButton" id="btnExportCsv"
                (click)="exportToCsvClicked()">{{ getExportCsvText() }}</li>
            </ul>
        </igx-drop-down>
    </div>
</div>
`
            },] },
];
/** @nocollapse */
IgxGridToolbarComponent.ctorParameters = () => [
    { type: GridBaseAPIService, },
    { type: ChangeDetectorRef, },
    { type: IgxExcelExporterService, decorators: [{ type: Optional },] },
    { type: IgxCsvExporterService, decorators: [{ type: Optional },] },
];
IgxGridToolbarComponent.propDecorators = {
    "gridID": [{ type: HostBinding, args: ['class.igx-grid-toolbar',] }, { type: Input },],
    "filterColumnsPrompt": [{ type: Input },],
    "defaultDropDownsMaxHeight": [{ type: Input },],
    "columnHidingDropdown": [{ type: ViewChild, args: ['columnHidingDropdown', { read: IgxDropDownComponent },] },],
    "columnHidingUI": [{ type: ViewChild, args: [IgxColumnHidingComponent,] },],
    "columnHidingButton": [{ type: ViewChild, args: ['columnHidingButton',] },],
    "exportDropdown": [{ type: ViewChild, args: ['exportDropdown', { read: IgxDropDownComponent },] },],
    "exportButton": [{ type: ViewChild, args: ['btnExport',] },],
    "columnPinningDropdown": [{ type: ViewChild, args: ['columnPinningDropdown', { read: IgxDropDownComponent },] },],
    "columnPinningUI": [{ type: ViewChild, args: [IgxColumnPinningComponent,] },],
    "columnPinningButton": [{ type: ViewChild, args: ['columnPinningButton',] },],
    "displayDensity": [{ type: Input },],
    "hostClass": [{ type: HostBinding, args: ['attr.class',] },],
};
function IgxGridToolbarComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    IgxGridToolbarComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    IgxGridToolbarComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    IgxGridToolbarComponent.propDecorators;
    /**
     * @hidden
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.gridID;
    /** @type {?} */
    IgxGridToolbarComponent.prototype._filterColumnsPrompt;
    /**
     * Provides a reference to the `IgxDropDownComponent` of the Column Hiding UI.
     * ```typescript
     * const dropdownHiding = this.grid.toolbar.columnHidingDropdown;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.columnHidingDropdown;
    /**
     * Provides a reference to the `IgxColumnHidingComponent`.
     * ```typescript
     * const hidingUI = this.grid.toolbar.columnHidingUI;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.columnHidingUI;
    /**
     * Provides a reference to the Column Hiding button.
     * ```typescript
     * const hidingButton = this.grid.toolbar.columnHidingButton;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.columnHidingButton;
    /**
     * Provides a reference to the `IgxDropDownComponent` of the Export button.
     * ```typescript
     * const exportDropdown = this.grid.toolbar.exportDropdown;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.exportDropdown;
    /**
     * Provides a reference to the Export button.
     * ```typescript
     * const exportBtn = this.grid.toolbar.exportButton;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.exportButton;
    /**
     * Provides a reference to the `IgxDropDownComponent` of the Column Pinning UI.
     * ```typescript
     * const dropdownPinning = this.grid.toolbar.columnPinningDropdown;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.columnPinningDropdown;
    /**
     * Provides a reference to the `IgxColumnPinningComponent`.
     * ```typescript
     * const pinningUI = this.grid.toolbar.columnPinningDropdown;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.columnPinningUI;
    /**
     * Provides a reference to the Column Pinning button.
     * ```typescript
     * const pinningButton = this.grid.toolbar.columnPinningButton;
     * ```
     * @type {?}
     */
    IgxGridToolbarComponent.prototype.columnPinningButton;
    /** @type {?} */
    IgxGridToolbarComponent.prototype._displayDensity;
    /** @type {?} */
    IgxGridToolbarComponent.prototype._positionSettings;
    /** @type {?} */
    IgxGridToolbarComponent.prototype._overlaySettings;
    /** @type {?} */
    IgxGridToolbarComponent.prototype.gridAPI;
    /** @type {?} */
    IgxGridToolbarComponent.prototype.cdr;
    /** @type {?} */
    IgxGridToolbarComponent.prototype.excelExporter;
    /** @type {?} */
    IgxGridToolbarComponent.prototype.csvExporter;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC10b29sYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lnbml0ZXVpLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvZ3JpZHMvZ3JpZC10b29sYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsV0FBVyxFQUNYLEtBQUssRUFDTCxRQUFRLEVBQ1IsU0FBUyxFQUNaLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFDSCxZQUFZLEVBRVoscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix1QkFBdUIsRUFDdkIsdUJBQXVCLEVBQ3ZCLHNCQUFzQixFQUN6QixNQUFNLG1CQUFtQixDQUFDO0FBQzNCLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVuRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN2RSxPQUFPLEVBQXFDLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDMUgsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sOEJBQThCLENBQUM7Ozs7QUF5RTVFLE1BQU07Ozs7Ozs7SUE2TkYsWUFBbUIsT0FBaUQsRUFDekQsS0FDWSxlQUNBO1FBSEosWUFBTyxHQUFQLE9BQU8sQ0FBMEM7UUFDekQsUUFBRyxHQUFILEdBQUc7UUFDUyxrQkFBYSxHQUFiLGFBQWE7UUFDYixnQkFBVyxHQUFYLFdBQVc7b0NBbE1ILHlCQUF5QjtpQ0FxTVY7WUFDMUMsbUJBQW1CLEVBQUUsbUJBQW1CLENBQUMsSUFBSTtZQUM3QyxvQkFBb0IsRUFBRSxtQkFBbUIsQ0FBQyxLQUFLO1lBQy9DLGlCQUFpQixFQUFFLGlC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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQWtFYjthQUNBOzs7O1lBOUVRLGtCQUFrQjtZQWxCdkIsaUJBQWlCO1lBZWpCLHVCQUF1Qix1QkFpVGxCLFFBQVE7WUFuVGIscUJBQXFCLHVCQW9UaEIsUUFBUTs7O3VCQTNOWixXQUFXLFNBQUMsd0JBQXdCLGNBQ3BDLEtBQUs7b0NBU0wsS0FBSzswQ0F1QkwsS0FBSztxQ0FZTCxTQUFTLFNBQUMsc0JBQXNCLEVBQUUsRUFBRSxJQUFJLEVBQUUsb0JBQW9CLEVBQUU7K0JBU2hFLFNBQVMsU0FBQyx3QkFBd0I7bUNBU2xDLFNBQVMsU0FBQyxvQkFBb0I7K0JBUzlCLFNBQVMsU0FBQyxnQkFBZ0IsRUFBRSxFQUFFLElBQUksRUFBRSxvQkFBb0IsRUFBRTs2QkFTMUQsU0FBUyxTQUFDLFdBQVc7c0NBU3JCLFNBQVMsU0FBQyx1QkFBdUIsRUFBRSxFQUFFLElBQUksRUFBRSxvQkFBb0IsRUFBRTtnQ0FTakUsU0FBUyxTQUFDLHlCQUF5QjtvQ0FTbkMsU0FBUyxTQUFDLHFCQUFxQjsrQkErRC9CLEtBQUs7MEJBZ0NMLFdBQVcsU0FBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb21wb25lbnQsXG4gICAgSG9zdEJpbmRpbmcsXG4gICAgSW5wdXQsXG4gICAgT3B0aW9uYWwsXG4gICAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBEaXNwbGF5RGVuc2l0eSB9IGZyb20gJy4uL2NvcmUvZGlzcGxheURlbnNpdHknO1xuaW1wb3J0IHtcbiAgICBDc3ZGaWxlVHlwZXMsXG4gICAgSWd4QmFzZUV4cG9ydGVyLFxuICAgIElneENzdkV4cG9ydGVyT3B0aW9ucyxcbiAgICBJZ3hDc3ZFeHBvcnRlclNlcnZpY2UsXG4gICAgSWd4RXhjZWxFeHBvcnRlck9wdGlvbnMsXG4gICAgSWd4RXhjZWxFeHBvcnRlclNlcnZpY2UsXG4gICAgQWJzb2x1dGVTY3JvbGxTdHJhdGVneVxufSBmcm9tICcuLi9zZXJ2aWNlcy9pbmRleCc7XG5pbXBvcnQgeyBHcmlkQmFzZUFQSVNlcnZpY2UgfSBmcm9tICcuL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IElneEdyaWRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9ncmlkLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IElneERyb3BEb3duQ29tcG9uZW50IH0gZnJvbSAnLi4vZHJvcC1kb3duL2Ryb3AtZG93bi5jb21wb25lbnQnO1xuaW1wb3J0IHsgSWd4Q29sdW1uSGlkaW5nQ29tcG9uZW50IH0gZnJvbSAnLi9jb2x1bW4taGlkaW5nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJZ3hDb2x1bW5QaW5uaW5nQ29tcG9uZW50IH0gZnJvbSAnLi9jb2x1bW4tcGlubmluZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgT3ZlcmxheVNldHRpbmdzLCBQb3NpdGlvblNldHRpbmdzLCBIb3Jpem9udGFsQWxpZ25tZW50LCBWZXJ0aWNhbEFsaWdubWVudCB9IGZyb20gJy4uL3NlcnZpY2VzL292ZXJsYXkvdXRpbGl0aWVzJztcbmltcG9ydCB7IENvbm5lY3RlZFBvc2l0aW9uaW5nU3RyYXRlZ3kgfSBmcm9tICcuLi9zZXJ2aWNlcy9vdmVybGF5L3Bvc2l0aW9uJztcblxuLyoqIEBoaWRkZW4gKi9cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnaWd4LWdyaWQtdG9vbGJhcicsXG4gICAgdGVtcGxhdGU6IGA8c3BhbiBjbGFzcz1cImlneC1ncmlkLXRvb2xiYXJfX3RpdGxlXCI+XG4gICAge3sgZ2V0VGl0bGUoKSB9fVxuPC9zcGFuPlxuXG48ZGl2IGNsYXNzPVwiaWd4LWdyaWQtdG9vbGJhcl9fYWN0aW9uc1wiPlxuICAgIDxkaXYgKm5nSWY9XCJncmlkLmNvbHVtbkhpZGluZ1wiPlxuICAgICAgICA8YnV0dG9uIGlneEJ1dHRvbj1cImZsYXRcIiAjY29sdW1uSGlkaW5nQnV0dG9uIG5hbWU9XCJidG5Db2x1bW5IaWRpbmdcIiBpZ3hCdXR0b24gaWd4UmlwcGxlXG4gICAgICAgICAgICAoY2xpY2spPVwidG9nZ2xlQ29sdW1uSGlkaW5nVUkoKVwiPlxuICAgICAgICAgICAgPGRpdiAgY2xhc3M9XCJpZ3gtZ3JpZC10b29sYmFyX19idXR0b24tc3BhY2VcIj5cbiAgICAgICAgICAgICAgICA8aWd4LWljb24gKm5nSWY9XCJncmlkLmhpZGRlbkNvbHVtbnNDb3VudCA+IDBcIj52aXNpYmlsaXR5X29mZjwvaWd4LWljb24+XG4gICAgICAgICAgICAgICAgPGlneC1pY29uICpuZ0lmPVwiZ3JpZC5oaWRkZW5Db2x1bW5zQ291bnQgPT09IDBcIj52aXNpYmlsaXR5PC9pZ3gtaWNvbj5cbiAgICAgICAgICAgICAgICA8c3Bhbj57eyBncmlkLmhpZGRlbkNvbHVtbnNDb3VudCB9fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3Bhbj57eyBncmlkLmhpZGRlbkNvbHVtbnNUZXh0IH19PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8aWd4LWRyb3AtZG93biAjY29sdW1uSGlkaW5nRHJvcGRvd24+XG4gICAgICAgICAgICA8aWd4LWNvbHVtbi1oaWRpbmdcbiAgICAgICAgICAgICAgICBbY29sdW1uc109XCJncmlkLmNvbHVtbkxpc3RcIlxuICAgICAgICAgICAgICAgIFt0aXRsZV09XCJncmlkLmNvbHVtbkhpZGluZ1RpdGxlXCJcbiAgICAgICAgICAgICAgICBbZmlsdGVyQ29sdW1uc1Byb21wdF09XCJmaWx0ZXJDb2x1bW5zUHJvbXB0XCJcbiAgICAgICAgICAgICAgICBbY29sdW1uc0FyZWFNYXhIZWlnaHRdPVwiZGVmYXVsdERyb3BEb3duc01heEhlaWdodFwiXG4gICAgICAgICAgICAgICAgKG9uQ29sdW1uVmlzaWJpbGl0eUNoYW5nZWQpPVwiZ3JpZC50b2dnbGVDb2x1bW5WaXNpYmlsaXR5KCRldmVudClcIj5cbiAgICAgICAgICAgIDwvaWd4LWNvbHVtbi1oaWRpbmc+XG4gICAgICAgIDwvaWd4LWRyb3AtZG93bj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2ICpuZ0lmPVwiZ3JpZC5jb2x1bW5QaW5uaW5nXCI+XG4gICAgICAgIDxidXR0b24gaWd4QnV0dG9uPVwiZmxhdFwiICNjb2x1bW5QaW5uaW5nQnV0dG9uIG5hbWU9XCJidG5Db2x1bW5QaW5uaW5nXCIgaWd4QnV0dG9uIGlneFJpcHBsZVxuICAgICAgICAgICAgKGNsaWNrKT1cInRvZ2dsZUNvbHVtblBpbm5pbmdVSSgpXCI+XG4gICAgICAgICAgICA8ZGl2ICBjbGFzcz1cImlneC1ncmlkLXRvb2xiYXJfX2J1dHRvbi1zcGFjZVwiPlxuICAgICAgICAgICAgICAgIDxpZ3gtaWNvbiAqbmdJZj1cInBpbm5lZENvbHVtbnNDb3VudCA+IDBcIj5sb2NrPC9pZ3gtaWNvbj5cbiAgICAgICAgICAgICAgICA8aWd4LWljb24gKm5nSWY9XCJwaW5uZWRDb2x1bW5zQ291bnQgPT09IDBcIj5sb2NrX29wZW48L2lneC1pY29uPlxuICAgICAgICAgICAgICAgIDxzcGFuPnt7IHBpbm5lZENvbHVtbnNDb3VudCB9fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3Bhbj57eyBncmlkLnBpbm5lZENvbHVtbnNUZXh0IH19PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPGlneC1kcm9wLWRvd24gI2NvbHVtblBpbm5pbmdEcm9wZG93bj5cbiAgICAgICAgICAgIDxpZ3gtY29sdW1uLXBpbm5pbmdcbiAgICAgICAgICAgICAgICBbY29sdW1uc109XCJncmlkLmNvbHVtbkxpc3RcIlxuICAgICAgICAgICAgICAgIFt0aXRsZV09XCJncmlkLmNvbHVtblBpbm5pbmdUaXRsZVwiXG4gICAgICAgICAgICAgICAgW2ZpbHRlckNvbHVtbnNQcm9tcHRdPVwiZmlsdGVyQ29sdW1uc1Byb21wdFwiXG4gICAgICAgICAgICAgICAgW2NvbHVtbnNBcmVhTWF4SGVpZ2h0XT1cImRlZmF1bHREcm9wRG93bnNNYXhIZWlnaHRcIj48L2lneC1jb2x1bW4tcGlubmluZz5cbiAgICAgICAgPC9pZ3gtZHJvcC1kb3duPlxuICAgIDwvZGl2PlxuXG5cbiAgICA8ZGl2IGNsYXNzPVwiaWd4LWdyaWQtdG9vbGJhcl9fZHJvcGRvd25cIiAqbmdJZj1cInNob3VsZFNob3dFeHBvcnRCdXR0b25cIiBpZD1cImJ0bkV4cG9ydFwiPlxuICAgICAgICA8YnV0dG9uIGlneEJ1dHRvbj1cImZsYXRcIiBpZ3hSaXBwbGUgI2J0bkV4cG9ydFxuICAgICAgICAgICAgICAgIChjbGljayk9XCJleHBvcnRDbGlja2VkKClcIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaWd4LWdyaWQtdG9vbGJhcl9fYnV0dG9uLXNwYWNlXCI+XG4gICAgICAgICAgICAgICAgPGlneC1pY29uIGZvbnRTZXQ9XCJtYXRlcmlhbFwiPmltcG9ydF9leHBvcnQ8L2lneC1pY29uPlxuICAgICAgICAgICAgICAgIDxzcGFuPnt7IGdldEV4cG9ydFRleHQoKSB9fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8aWd4LWljb24gZm9udFNldD1cIm1hdGVyaWFsXCI+YXJyb3dfZHJvcF9kb3duPC9pZ3gtaWNvbj5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgPGlneC1kcm9wLWRvd24gI2V4cG9ydERyb3Bkb3duPlxuICAgICAgICAgICAgPHVsIGNsYXNzPVwiaWd4LWdyaWQtdG9vbGJhcl9fZGQtbGlzdFwiPlxuICAgICAgICAgICAgICAgIDxsaSBjbGFzcz1cImlneC1ncmlkLXRvb2xiYXJfX2RkLWxpc3QtaXRlbXNcIiBpZ3hSaXBwbGUgKm5nSWY9XCJzaG91bGRTaG93RXhwb3J0RXhjZWxCdXR0b25cIiBpZD1cImJ0bkV4cG9ydEV4Y2VsXCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwiZXhwb3J0VG9FeGNlbENsaWNrZWQoKVwiPnt7IGdldEV4cG9ydEV4Y2VsVGV4dCgpIH19PC9saT5cbiAgICAgICAgICAgICAgICA8bGkgY2xhc3M9XCJpZ3gtZ3JpZC10b29sYmFyX19kZC1saXN0LWl0ZW1zXCIgaWd4UmlwcGxlICpuZ0lmPVwic2hvdWxkU2hvd0V4cG9ydENzdkJ1dHRvblwiIGlkPVwiYnRuRXhwb3J0Q3N2XCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwiZXhwb3J0VG9Dc3ZDbGlja2VkKClcIj57eyBnZXRFeHBvcnRDc3ZUZXh0KCkgfX08L2xpPlxuICAgICAgICAgICAgPC91bD5cbiAgICAgICAgPC9pZ3gtZHJvcC1kb3duPlxuICAgIDwvZGl2PlxuPC9kaXY+XG5gXG59KVxuZXhwb3J0IGNsYXNzIElneEdyaWRUb29sYmFyQ29tcG9uZW50IHtcblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmlneC1ncmlkLXRvb2xiYXInKVxuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGdyaWRJRDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgZGVmYXVsdCB0ZXh0IHNob3duIGluIHRoZSBmaWx0ZXJpbmcgYm94LlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCBmaWx0ZXJQcm9tcHQgPSB0aGlzLmdyaWQudG9vbGJhci5maWx0ZXJDb2x1bW5zUHJvbXB0O1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGdldCBmaWx0ZXJDb2x1bW5zUHJvbXB0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZmlsdGVyQ29sdW1uc1Byb21wdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBkZWZhdWx0IHRleHQgc2hvd24gaW4gdGhlIGZpbHRlcmluZyBib3guXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIHRoaXMuZ3JpZC50b29sYmFyLmZpbHRlckNvbHVtbnNQcm9tcHQoJ0ZpbHRlciBjb2x1bW5zIC4uLicpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBzZXQgZmlsdGVyQ29sdW1uc1Byb21wdCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX2ZpbHRlckNvbHVtbnNQcm9tcHQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9maWx0ZXJDb2x1bW5zUHJvbXB0ID0gJ0ZpbHRlciBjb2x1bW5zIGxpc3QgLi4uJztcblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGhlaWdodCBmb3IgdGhlIGBJZ3hHcmlkVG9vbGJhckNvbXBvbmVudGAncyBkcm9wIGRvd24gcGFuZWxzLlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCBkcm9wZG93bkhlaWdodCA9IHRoaXMuZ3JpZC50b29sYmFyLmRlZmF1bHREcm9wRG93bnNNYXhIZWlnaHQ7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBnZXQgZGVmYXVsdERyb3BEb3duc01heEhlaWdodCgpIHtcbiAgICAgICAgY29uc3QgZ3JpZEhlaWdodCA9IHRoaXMuZ3JpZC5jYWxjSGVpZ2h0O1xuICAgICAgICByZXR1cm4gKGdyaWRIZWlnaHQpID8gZ3JpZEhlaWdodCAqIDAuNyArICdweCcgOiAnMTAwJSc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJvdmlkZXMgYSByZWZlcmVuY2UgdG8gdGhlIGBJZ3hEcm9wRG93bkNvbXBvbmVudGAgb2YgdGhlIENvbHVtbiBIaWRpbmcgVUkuXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IGRyb3Bkb3duSGlkaW5nID0gdGhpcy5ncmlkLnRvb2xiYXIuY29sdW1uSGlkaW5nRHJvcGRvd247XG4gICAgICogYGBgXG4gICAgICovXG4gICAgQFZpZXdDaGlsZCgnY29sdW1uSGlkaW5nRHJvcGRvd24nLCB7IHJlYWQ6IElneERyb3BEb3duQ29tcG9uZW50IH0pXG4gICAgcHVibGljIGNvbHVtbkhpZGluZ0Ryb3Bkb3duOiBJZ3hEcm9wRG93bkNvbXBvbmVudDtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBgSWd4Q29sdW1uSGlkaW5nQ29tcG9uZW50YC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgaGlkaW5nVUkgPSB0aGlzLmdyaWQudG9vbGJhci5jb2x1bW5IaWRpbmdVSTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBAVmlld0NoaWxkKElneENvbHVtbkhpZGluZ0NvbXBvbmVudClcbiAgICBwdWJsaWMgY29sdW1uSGlkaW5nVUk6IElneENvbHVtbkhpZGluZ0NvbXBvbmVudDtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBDb2x1bW4gSGlkaW5nIGJ1dHRvbi5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgaGlkaW5nQnV0dG9uID0gdGhpcy5ncmlkLnRvb2xiYXIuY29sdW1uSGlkaW5nQnV0dG9uO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIEBWaWV3Q2hpbGQoJ2NvbHVtbkhpZGluZ0J1dHRvbicpXG4gICAgcHVibGljIGNvbHVtbkhpZGluZ0J1dHRvbjtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBgSWd4RHJvcERvd25Db21wb25lbnRgIG9mIHRoZSBFeHBvcnQgYnV0dG9uLlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCBleHBvcnREcm9wZG93biA9IHRoaXMuZ3JpZC50b29sYmFyLmV4cG9ydERyb3Bkb3duO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIEBWaWV3Q2hpbGQoJ2V4cG9ydERyb3Bkb3duJywgeyByZWFkOiBJZ3hEcm9wRG93bkNvbXBvbmVudCB9KVxuICAgIHB1YmxpYyBleHBvcnREcm9wZG93bjogSWd4RHJvcERvd25Db21wb25lbnQ7XG5cbiAgICAvKipcbiAgICAgKiBQcm92aWRlcyBhIHJlZmVyZW5jZSB0byB0aGUgRXhwb3J0IGJ1dHRvbi5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgZXhwb3J0QnRuID0gdGhpcy5ncmlkLnRvb2xiYXIuZXhwb3J0QnV0dG9uO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIEBWaWV3Q2hpbGQoJ2J0bkV4cG9ydCcpXG4gICAgcHVibGljIGV4cG9ydEJ1dHRvbjtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBgSWd4RHJvcERvd25Db21wb25lbnRgIG9mIHRoZSBDb2x1bW4gUGlubmluZyBVSS5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgZHJvcGRvd25QaW5uaW5nID0gdGhpcy5ncmlkLnRvb2xiYXIuY29sdW1uUGlubmluZ0Ryb3Bkb3duO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIEBWaWV3Q2hpbGQoJ2NvbHVtblBpbm5pbmdEcm9wZG93bicsIHsgcmVhZDogSWd4RHJvcERvd25Db21wb25lbnQgfSlcbiAgICBwdWJsaWMgY29sdW1uUGlubmluZ0Ryb3Bkb3duOiBJZ3hEcm9wRG93bkNvbXBvbmVudDtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBgSWd4Q29sdW1uUGlubmluZ0NvbXBvbmVudGAuXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IHBpbm5pbmdVSSA9IHRoaXMuZ3JpZC50b29sYmFyLmNvbHVtblBpbm5pbmdEcm9wZG93bjtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBAVmlld0NoaWxkKElneENvbHVtblBpbm5pbmdDb21wb25lbnQpXG4gICAgcHVibGljIGNvbHVtblBpbm5pbmdVSTogSWd4Q29sdW1uUGlubmluZ0NvbXBvbmVudDtcblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBDb2x1bW4gUGlubmluZyBidXR0b24uXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IHBpbm5pbmdCdXR0b24gPSB0aGlzLmdyaWQudG9vbGJhci5jb2x1bW5QaW5uaW5nQnV0dG9uO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIEBWaWV3Q2hpbGQoJ2NvbHVtblBpbm5pbmdCdXR0b24nKVxuICAgIHB1YmxpYyBjb2x1bW5QaW5uaW5nQnV0dG9uO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgYElneEdyaWRDb21wb25lbnRgIGNvbXBvbmVudCwgaG9zdGluZyB0aGUgYElneEdyaWRUb29sYmFyQ29tcG9uZW50YC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgZ3JpZCA9IHRoaXMuaWd4R3JpZDEudG9vbGJhci5ncmlkO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgZ3JpZCgpOiBJZ3hHcmlkQmFzZUNvbXBvbmVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRBUEkuZ2V0KHRoaXMuZ3JpZElEKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGBJZ3hHcmlkQ29tcG9uZW50YCByZW5kZXJzIGFuIGV4cG9ydCBidXR0b24uXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvc250IGV4cG9ydEJ1dHRvbiA9IHRoaXMuaWd4R3JpZDEudG9vbGJhci5zaG91bGRTaG93RXhwb3J0QnV0dG9uO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgc2hvdWxkU2hvd0V4cG9ydEJ1dHRvbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdyaWQgIT0gbnVsbCAmJiAodGhpcy5ncmlkLmV4cG9ydEV4Y2VsIHx8IHRoaXMuZ3JpZC5leHBvcnRDc3YpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGBJZ3hHcmlkQ29tcG9uZW50YCByZW5kZXJzIGFuIEV4Y2VsIGV4cG9ydCBidXR0b24uXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvc250IGV4cG9ydEV4Y2VsQnV0dG9uID0gdGhpcy5pZ3hHcmlkMS50b29sYmFyLnNob3VsZFNob3dFeHBvcnRFeGNlbEJ1dHRvbjtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IHNob3VsZFNob3dFeHBvcnRFeGNlbEJ1dHRvbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdyaWQgIT0gbnVsbCAmJiB0aGlzLmdyaWQuZXhwb3J0RXhjZWwpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgYElneEdyaWRDb21wb25lbnRgIHJlbmRlcnMgYW4gQ1NWIGV4cG9ydCBidXR0b24uXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvc250IGV4cG9ydENTVkJ1dHRvbiA9IHRoaXMuaWd4R3JpZDEudG9vbGJhci5zaG91bGRTaG93RXhwb3J0Q3N2QnV0dG9uO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgc2hvdWxkU2hvd0V4cG9ydENzdkJ1dHRvbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdyaWQgIT0gbnVsbCAmJiB0aGlzLmdyaWQuZXhwb3J0Q3N2KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGhvdyBtYW55IGNvbHVtbnMgYXJlIHBpbm5lZC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgcGlubmVkQ291bnQgPSB0aGlzLmlneEdyaWQxLnRvb2xiYXIucGlubmVkQ29sdW1uc0NvdW50O1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgcGlubmVkQ29sdW1uc0NvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkLnBpbm5lZENvbHVtbnMubGVuZ3RoO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2Rpc3BsYXlEZW5zaXR5OiBEaXNwbGF5RGVuc2l0eSB8IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHRoZW1lIG9mIHRoZSBgSWd4R3JpZFRvb2xiYXJDb21wb25lbnRgLlxuICAgICAqIFRoZSBkZWZhdWx0IHRoZW1lIGlzIGBjb21mb3J0YWJsZWAuXG4gICAgICogQXZhaWxhYmxlIG9wdGlvbnMgYXJlIGBjb21mb3J0YWJsZWAsIGBjb3N5YCwgYGNvbXBhY3RgLlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBsZXQgdG9vbGJhclRoZW1lID0gdGhpcy5ncmlkLnRvb2xiYXIuZGlzcGxheURlbnNpdHk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgZ2V0IGRpc3BsYXlEZW5zaXR5KCk6IERpc3BsYXlEZW5zaXR5IHwgc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BsYXlEZW5zaXR5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHRoZW1lIG9mIHRoZSBgSWd4R3JpZFRvb2xiYXJDb21wb25lbnRgLlxuICAgICAqIGBgYGh0bWxcbiAgICAgKiA8aWd4LWdyaWQgI2dyaWQgW2RhdGFdPVwibG9jYWxEYXRhXCIgW2Rpc3BsYXlEZW5zaXR5XT1cIidjb21wYWN0J1wiIFthdXRvR2VuZXJhdGVdPVwidHJ1ZVwiPjwvaWd4LWdyaWQ+XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcHVibGljIHNldCBkaXNwbGF5RGVuc2l0eSh2YWw6IERpc3BsYXlEZW5zaXR5IHwgc3RyaW5nKSB7XG4gICAgICAgIHN3aXRjaCAodmFsKSB7XG4gICAgICAgICAgICBjYXNlICdjb21wYWN0JzpcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwbGF5RGVuc2l0eSA9IERpc3BsYXlEZW5zaXR5LmNvbXBhY3Q7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb3N5JzpcbiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwbGF5RGVuc2l0eSA9IERpc3BsYXlEZW5zaXR5LmNvc3k7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjb21mb3J0YWJsZSc6XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXlEZW5zaXR5ID0gRGlzcGxheURlbnNpdHkuY29tZm9ydGFibGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB0aGVtZSBvZiB0aGUgYElneEdyaWRUb29sYmFyQ29tcG9uZW50YC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgdG9vbGJhclRoZW1lID0gdGhpcy5ncmlkLnRvb2xiYXIuaG9zdENsYXNzO1xuICAgICAqIGBgYFxuICAgICAqL1xuXG4gICAgQEhvc3RCaW5kaW5nKCdhdHRyLmNsYXNzJylcbiAgICBnZXQgaG9zdENsYXNzKCk6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5fZGlzcGxheURlbnNpdHkpIHtcbiAgICAgICAgICAgIGNhc2UgRGlzcGxheURlbnNpdHkuY29tcGFjdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2lneC1ncmlkLXRvb2xiYXItLWNvbXBhY3QnO1xuICAgICAgICAgICAgY2FzZSBEaXNwbGF5RGVuc2l0eS5jb3N5OlxuICAgICAgICAgICAgICAgIHJldHVybiAnaWd4LWdyaWQtdG9vbGJhci0tY29zeSc7XG4gICAgICAgICAgICBjYXNlIERpc3BsYXlEZW5zaXR5LmNvbWZvcnRhYmxlOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2lneC1ncmlkLXRvb2xiYXInO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHVibGljIGdyaWRBUEk6IEdyaWRCYXNlQVBJU2VydmljZTxJZ3hHcmlkQmFzZUNvbXBvbmVudD4sXG4gICAgICAgIHB1YmxpYyBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICBAT3B0aW9uYWwoKSBwdWJsaWMgZXhjZWxFeHBvcnRlcjogSWd4RXhjZWxFeHBvcnRlclNlcnZpY2UsXG4gICAgICAgIEBPcHRpb25hbCgpIHB1YmxpYyBjc3ZFeHBvcnRlcjogSWd4Q3N2RXhwb3J0ZXJTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcG9zaXRpb25TZXR0aW5nczogUG9zaXRpb25TZXR0aW5ncyA9IHtcbiAgICAgICAgaG9yaXpvbnRhbERpcmVjdGlvbjogSG9yaXpvbnRhbEFsaWdubWVudC5MZWZ0LFxuICAgICAgICBob3Jpem9udGFsU3RhcnRQb2ludDogSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodCxcbiAgICAgICAgdmVydGljYWxEaXJlY3Rpb246IFZlcnRpY2FsQWxpZ25tZW50LkJvdHRvbSxcbiAgICAgICAgdmVydGljYWxTdGFydFBvaW50OiBWZXJ0aWNhbEFsaWdubWVudC5Cb3R0b21cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBfb3ZlcmxheVNldHRpbmdzOiBPdmVybGF5U2V0dGluZ3MgPSB7XG4gICAgICAgIHBvc2l0aW9uU3RyYXRlZ3k6IG5ldyBDb25uZWN0ZWRQb3NpdGlvbmluZ1N0cmF0ZWd5KHRoaXMuX3Bvc2l0aW9uU2V0dGluZ3MpLFxuICAgICAgICBzY3JvbGxTdHJhdGVneTogbmV3IEFic29sdXRlU2Nyb2xsU3RyYXRlZ3koKSxcbiAgICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgICBjbG9zZU9uT3V0c2lkZUNsaWNrOiB0cnVlXG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdGl0bGUgb2YgYElneEdyaWRUb29sYmFyQ29tcG9uZW50YC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgdG9vbGJhclRpdGxlID0gdGhpcy5pZ3hHcmlkMS50b29sYmFyLmdldFRpdGxlKCk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcHVibGljIGdldFRpdGxlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWQgIT0gbnVsbCA/IHRoaXMuZ3JpZC50b29sYmFyVGl0bGUgOiAnJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB0ZXh0IG9mIHRoZSBleHBvcnQgYnV0dG9uIG9mIHRoZSBgSWd4R3JpZFRvb2xiYXJDb21wb25lbnRgLlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCB0b29sYmFyRXhwb3J0VGV4dCA9IHRoaXMuaWd4R3JpZDEudG9vbGJhci5nZXRUaXRsZSgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRFeHBvcnRUZXh0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWQgIT0gbnVsbCA/IHRoaXMuZ3JpZC5leHBvcnRUZXh0IDogJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdGV4dCBvZiB0aGUgRXhjZWwgZXhwb3J0IGJ1dHRvbiBvZiB0aGUgYElneEdyaWRUb29sYmFyQ29tcG9uZW50YC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgdG9vbGJhckV4Y2VsVGV4dCA9IHRoaXMuaWd4R3JpZDEudG9vbGJhci5nZXRFeHBvcnRFeGNlbFRleHQoKTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0RXhwb3J0RXhjZWxUZXh0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWQgIT0gbnVsbCA/IHRoaXMuZ3JpZC5leHBvcnRFeGNlbFRleHQgOiAnJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB0ZXh0IG9mIHRoZSBDU1YgZXhwb3J0IGJ1dHRvbiBvZiB0aGUgYElneEdyaWRUb29sYmFyQ29tcG9uZW50YC5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgdG9vbGJhckNTVlRleHQgPSB0aGlzLmlneEdyaWQxLnRvb2xiYXIuZ2V0RXhwb3J0Q3N2VGV4dCgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRFeHBvcnRDc3ZUZXh0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWQgIT0gbnVsbCA/IHRoaXMuZ3JpZC5leHBvcnRDc3ZUZXh0IDogJyc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlcyB0aGUgZXhwb3J0IGJ1dHRvbidzIGRyb3Bkb3duIG1lbnUuXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIHRoaXMuaWd4R3JpZDEudG9vbGJhci5leHBvcnRDbGlja2VkKCk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcHVibGljIGV4cG9ydENsaWNrZWQoKSB7XG4gICAgICAgIHRoaXMuX292ZXJsYXlTZXR0aW5ncy5wb3NpdGlvblN0cmF0ZWd5LnNldHRpbmdzLnRhcmdldCA9IHRoaXMuZXhwb3J0QnV0dG9uLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIHRoaXMuX292ZXJsYXlTZXR0aW5ncy5vdXRsZXQgPSB0aGlzLmdyaWQub3V0bGV0RGlyZWN0aXZlO1xuICAgICAgICB0aGlzLmV4cG9ydERyb3Bkb3duLnRvZ2dsZSh0aGlzLl9vdmVybGF5U2V0dGluZ3MpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4cG9ydHMgdGhlIGdyaWQgdG8gZXhjZWwuXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIHRoaXMuaWd4R3JpZDEudG9vbGJhci5leHBvcnRUb0V4Y2VsQ2xpY2tlZCgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBleHBvcnRUb0V4Y2VsQ2xpY2tlZCgpIHtcbiAgICAgICAgdGhpcy5wZXJmb3JtRXhwb3J0KHRoaXMuZXhjZWxFeHBvcnRlciwgJ2V4Y2VsJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXhwb3J0cyB0aGUgZ3JpZCB0byBDU1YuXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIHRoaXMuaWd4R3JpZDEudG9vbGJhci5leHBvcnRUb0NzdkNsaWNrZWQoKTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBwdWJsaWMgZXhwb3J0VG9Dc3ZDbGlja2VkKCkge1xuICAgICAgICB0aGlzLnBlcmZvcm1FeHBvcnQodGhpcy5jc3ZFeHBvcnRlciwgJ2NzdicpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGVyZm9ybUV4cG9ydChleHA6IElneEJhc2VFeHBvcnRlciwgZXhwb3J0VHlwZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuZXhwb3J0Q2xpY2tlZCgpO1xuXG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gJ0V4cG9ydGVkRGF0YSc7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBleHBvcnRUeXBlID09PSAnZXhjZWwnID9cbiAgICAgICAgICAgIG5ldyBJZ3hFeGNlbEV4cG9ydGVyT3B0aW9ucyhmaWxlTmFtZSkgOlxuICAgICAgICAgICAgbmV3IElneENzdkV4cG9ydGVyT3B0aW9ucyhmaWxlTmFtZSwgQ3N2RmlsZVR5cGVzLkNTVik7XG5cbiAgICAgICAgY29uc3QgYXJncyA9IHsgZ3JpZDogdGhpcy5ncmlkLCBleHBvcnRlcjogZXhwLCBvcHRpb25zOiBvcHRpb25zLCBjYW5jZWw6IGZhbHNlIH07XG5cbiAgICAgICAgdGhpcy5ncmlkLm9uVG9vbGJhckV4cG9ydGluZy5lbWl0KGFyZ3MpO1xuICAgICAgICBpZiAoYXJncy5jYW5jZWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBleHAuZXhwb3J0KHRoaXMuZ3JpZCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlcyB0aGUgQ29sdW1uIEhpZGluZyBVSS5cbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogZ3JpZDEudG9vbGJhci50b2dnbGVDb2x1bW5IaWRpbmdVSSgpO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyB0b2dnbGVDb2x1bW5IaWRpbmdVSSgpIHtcbiAgICAgICAgdGhpcy5fb3ZlcmxheVNldHRpbmdzLnBvc2l0aW9uU3RyYXRlZ3kuc2V0dGluZ3MudGFyZ2V0ID0gdGhpcy5jb2x1bW5IaWRpbmdCdXR0b24ubmF0aXZlRWxlbWVudDtcbiAgICAgICAgdGhpcy5fb3ZlcmxheVNldHRpbmdzLm91dGxldCA9IHRoaXMuZ3JpZC5vdXRsZXREaXJlY3RpdmU7XG4gICAgICAgIHRoaXMuY29sdW1uSGlkaW5nRHJvcGRvd24udG9nZ2xlKHRoaXMuX292ZXJsYXlTZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlcyB0aGUgQ29sdW1uIFBpbm5pbmcgVUkuXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGdyaWQxLnRvb2xiYXIudG9nZ2xlQ29sdW1uUGlubmluZ1VJKCk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgcHVibGljIHRvZ2dsZUNvbHVtblBpbm5pbmdVSSgpIHtcbiAgICAgICAgdGhpcy5fb3ZlcmxheVNldHRpbmdzLnBvc2l0aW9uU3RyYXRlZ3kuc2V0dGluZ3MudGFyZ2V0ID0gdGhpcy5jb2x1bW5QaW5uaW5nQnV0dG9uLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIHRoaXMuX292ZXJsYXlTZXR0aW5ncy5vdXRsZXQgPSB0aGlzLmdyaWQub3V0bGV0RGlyZWN0aXZlO1xuICAgICAgICB0aGlzLmNvbHVtblBpbm5pbmdEcm9wZG93bi50b2dnbGUodGhpcy5fb3ZlcmxheVNldHRpbmdzKTtcbiAgICB9XG59XG4iXX0=