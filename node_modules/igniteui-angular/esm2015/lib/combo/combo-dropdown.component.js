/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ChangeDetectorRef, Component, ContentChild, ElementRef, forwardRef, Inject } from '@angular/core';
import { takeUntil } from 'rxjs/operators';
import { IgxDropDownBase, Navigate } from '../drop-down/drop-down.component';
import { IgxComboComponent } from './combo.component';
import { IgxSelectionAPIService } from '../core/selection';
import { IgxForOfDirective } from '../directives/for-of/for_of.directive';
import { Subject } from 'rxjs';
/**
 * @hidden
 */
export class IgxComboDropDownComponent extends IgxDropDownBase {
    /**
     * @param {?} elementRef
     * @param {?} cdr
     * @param {?} selection
     * @param {?} combo
     */
    constructor(elementRef, cdr, selection, combo) {
        super(elementRef, cdr, selection);
        this.elementRef = elementRef;
        this.cdr = cdr;
        this.selection = selection;
        this.combo = combo;
        this._scrollPosition = 0;
        this.destroy$ = new Subject();
        /**
         *  Event emitter overrides
         *
         * @hidden
         */
        this.onOpened = this.combo.onOpened;
        /**
         * @hidden
         */
        this.onOpening = this.combo.onOpening;
        /**
         * @hidden
         */
        this.onClosing = this.combo.onClosing;
        /**
         * @hidden
         */
        this.onClosed = this.combo.onClosed;
    }
    /**
     * @hidden
     * @return {?}
     */
    get scrollContainer() {
        return this.verticalScrollContainer.dc.location.nativeElement;
    }
    /**
     * @hidden
     * @return {?}
     */
    get isScrolledToLast() {
        const /** @type {?} */ scrollTop = this.verticalScrollContainer.getVerticalScroll().scrollTop;
        const /** @type {?} */ scrollHeight = this.verticalScrollContainer.getVerticalScroll().scrollHeight;
        return Math.floor(scrollTop + this.verticalScrollContainer.igxForContainerSize) === scrollHeight;
    }
    /**
     * @return {?}
     */
    get lastVisibleIndex() {
        return this.combo.totalItemCount ?
            Math.floor(this.combo.itemsMaxHeight / this.combo.itemHeight) :
            this.items.length - 1;
    }
    /**
     * @hidden
     * @return {?}
     */
    get children() {
        return this.combo.children;
    }
    /**
     * @param {?} list
     * @return {?}
     */
    set children(list) {
        this._children = list;
    }
    /**
     * @hidden
     * @return {?}
     */
    onFocus() {
        this._focusedItem = this._focusedItem ? this._focusedItem : this.items.length ? this.items[0] : this.children.first;
        if (this._focusedItem) {
            this._focusedItem.isFocused = true;
        }
    }
    /**
     * @hidden
     * @param {?=} evt
     * @return {?}
     */
    onBlur(evt) {
        if (this._focusedItem) {
            this._focusedItem.isFocused = false;
            this._focusedItem = null;
        }
    }
    /**
     * @hidden
     * @return {?}
     */
    get selectedItem() {
        const /** @type {?} */ sel = this.selection.get(this.combo.id);
        return sel ? Array.from(sel) : [];
    }
    /**
     * @hidden
     * @return {?}
     */
    navigatePrev() {
        if (this._focusedItem.index === 0 && this.verticalScrollContainer.state.startIndex === 0) {
            this.combo.searchInput.nativeElement.focus();
        }
        else {
            super.navigatePrev();
        }
    }
    /**
     * @hidden
     * @return {?}
     */
    navigateFirst() {
        const /** @type {?} */ vContainer = this.verticalScrollContainer;
        if (vContainer.state.startIndex === 0) {
            this.focusItem(0);
            return;
        }
        vContainer.scrollTo(0);
        this.subscribeNext(vContainer, () => {
            this.combo.triggerCheck();
            this.focusItem(0);
            this.combo.triggerCheck();
        });
    }
    /**
     * @hidden
     * @return {?}
     */
    navigateLast() {
        const /** @type {?} */ vContainer = this.verticalScrollContainer;
        const /** @type {?} */ scrollTarget = this.combo.totalItemCount ?
            this.combo.totalItemCount - 1 :
            Math.max(this.combo.data.length - 1, vContainer.igxForOf.length - 1);
        if (vContainer.igxForOf.length <= vContainer.state.startIndex + vContainer.state.chunkSize) {
            this.focusItem(this.items.length - 1);
            return;
        }
        vContainer.scrollTo(scrollTarget);
        this.subscribeNext(vContainer, () => {
            this.combo.triggerCheck();
            this.focusItem(this.items.length - 1);
            this.combo.triggerCheck();
        });
    }
    /**
     * @hidden
     * @param {?} direction
     * @return {?}
     */
    navigateRemoteItem(direction) {
        this.verticalScrollContainer.addScrollTop(direction * this.combo.itemHeight);
        this.subscribeNext(this.verticalScrollContainer, () => {
            if (direction === Navigate.Up) {
                this.focusItem(0);
            }
            else {
                this.focusItem(this.focusedItem.index);
            }
        });
    }
    /**
     * @hidden
     * @param {?} itemID
     * @param {?=} select
     * @return {?}
     */
    setSelectedItem(itemID, select = true) {
        this.combo.setSelectedItem(itemID, select);
    }
    /**
     * @hidden
     * @param {?} item
     * @param {?=} event
     * @return {?}
     */
    selectItem(item, event) {
        if (item.value === 'ADD ITEM') {
            if (event) {
                this.combo.addItemToCollection();
            }
        }
        else {
            this.setSelectedItem(item.itemID);
            this._focusedItem = item;
        }
    }
    /**
     * @hidden
     * @param {?} newIndex
     * @param {?=} direction
     * @return {?}
     */
    navigateItem(newIndex, direction) {
        // Virtual scrolling holds one hidden loaded element at the bottom of the drop down list.
        // At the top there isn't such a hidden element.
        // That's why we hold the first or the one before the last list item as focused, during keyboard navigation.
        // This means that if we want to focus next element, it's the last hidden element when scrolling down
        // and when scrolling up it is not loaded at all.
        // It's more special case when srcolling down and the hidden element is group header,
        // which is not part of the this.items collection.
        // In that case the real item is not hidden, but not loaded at all by the virtualization,
        // and this is the same case as normal scroll up.
        const /** @type {?} */ vContainer = this.verticalScrollContainer;
        const /** @type {?} */ extraScroll = this.combo.isAddButtonVisible();
        if (direction) {
            if (direction === Navigate.Down && extraScroll) {
                if (vContainer.igxForOf[vContainer.igxForOf.length - 1] === this.focusedItem.value) {
                    if (this.focusedItem) {
                        this.focusedItem.isFocused = false;
                    }
                    this.focusedItem = this.children.last;
                    this.focusedItem.isFocused = true;
                    return;
                }
                else if (vContainer.igxForOf[vContainer.state.chunkSize + vContainer.state.startIndex - 2] ===
                    this.focusedItem.value) {
                    this.subscribeNext(vContainer, () => {
                        if (this.focusedItem.isHeader &&
                            vContainer.state.startIndex + vContainer.state.chunkSize < vContainer.igxForOf.length) {
                            vContainer.scrollNext();
                        }
                    });
                    vContainer.scrollNext();
                    return;
                }
            }
        }
        if (newIndex === -1) {
            this.navigateVirtualItem(direction, extraScroll ? 1 : 0);
        }
        else if (newIndex === this.lastVisibleIndex && !this.isScrolledToLast) {
            this.navigateVirtualItem(direction, extraScroll ? 1 : 0);
        }
        else if (newIndex === this.lastVisibleIndex && this.isScrolledToLast) {
            // When initially scrolling to the last item, a pseudo element is present in the children list
            // We need to check if the element we're on is an actual element or an empty 'igx-combo-item' child
            if (this.items[newIndex].element && this.items[newIndex].element.nativeElement.clientHeight) {
                super.navigateItem(newIndex);
            }
            return;
        }
        else {
            super.navigateItem(newIndex);
        }
    }
    /**
     * @param {?} direction
     * @param {?=} extraScroll
     * @return {?}
     */
    navigateVirtualItem(direction, extraScroll) {
        const /** @type {?} */ vContainer = this.verticalScrollContainer;
        // If the data is vitualized, data.length === vContainer.chunkSize, so the below checks are no-longer valid
        if (vContainer && vContainer.totalItemCount && vContainer.totalItemCount !== 0) {
            this.navigateRemoteItem(direction);
            return;
        }
        let /** @type {?} */ state = vContainer.state;
        if (this.isScrolledToLast && direction === Navigate.Down) {
            // If on the bottom most item, do not subscribe
            return;
        }
        // If on the topmost item, do not subscribe
        if (this.verticalScrollContainer.getVerticalScroll().scrollTop === 0 && direction === Navigate.Up) {
            return;
        }
        const /** @type {?} */ isScrollUp = direction === Navigate.Up;
        let /** @type {?} */ newScrollStartIndex = isScrollUp ? state.startIndex - 1 : state.startIndex + 1;
        if (newScrollStartIndex < 0) {
            newScrollStartIndex = 0;
        }
        let /** @type {?} */ data = vContainer.igxForOf;
        if (data.length === 0) {
            const /** @type {?} */ newItem = this.children.first;
            if (!newItem) {
                return;
            }
            newItem.isFocused = true;
            this._focusedItem = newItem;
            return;
        }
        // Following the big comment above, when the new item is group header, then we need to load 2 elements at once.
        if (data[newScrollStartIndex].isHeader && direction === Navigate.Up ||
            data[newScrollStartIndex + state.chunkSize - 2].isHeader && direction === Navigate.Down) {
            newScrollStartIndex = isScrollUp ? newScrollStartIndex - 1 : newScrollStartIndex + 1;
            // newScrollStartIndex = mod && direction === Navigate.Down ? newScrollStartIndex + 1 : newScrollStartIndex;
            if (newScrollStartIndex < 0) {
                // If the next item loaded is a header and is also the very first item in the list.
                vContainer.scrollTo(0); // Scrolls to the beginning of the list and switches focus to the searchInput
                this.subscribeNext(vContainer, () => {
                    this.combo.searchInput.nativeElement.focus();
                    if (this.focusedItem) {
                        this.focusedItem.isFocused = false;
                    }
                    this.focusedItem = null;
                });
                return;
            }
        }
        // If it is the very last item in the collection, when moving down
        if (newScrollStartIndex + state.chunkSize === data.length + 1) {
            vContainer.scrollTo(newScrollStartIndex);
            return;
        }
        vContainer.scrollTo(newScrollStartIndex);
        this.subscribeNext(vContainer, () => {
            state = vContainer.state;
            data = vContainer.igxForOf;
            // Because we are sure that if we scroll up then the top element is not a header, then we focus the first one.
            // When we scroll down, if the newly loaded element that is hidden is group header,
            // then we focus the last item from the this.items array.
            // This is because the this.items doens't contains the group headers, while there are rendered in the combo drop down.
            // If the newly loaded element that is hidden isn't a header, this means that the first visible item, the one that needs focus,
            // should be either the one that is before the last item (this.items).
            const /** @type {?} */ isBottomHiddenHeader = data[state.startIndex + state.chunkSize - 1].isHeader;
            const /** @type {?} */ index = isScrollUp ? 0 : isBottomHiddenHeader ? this.items.length - 1 - extraScroll : this.items.length - 2 - extraScroll;
            this.focusItem(index);
        });
    }
    /**
     * @param {?} virtualContainer
     * @param {?} callback
     * @return {?}
     */
    subscribeNext(virtualContainer, callback) {
        virtualContainer.onChunkLoad.pipe(takeUntil(this.destroy$)).subscribe({
            next: (e) => {
                callback(e);
            }
        });
    }
    /**
     * @param {?} visibleIndex
     * @return {?}
     */
    focusItem(visibleIndex) {
        const /** @type {?} */ oldItem = this._focusedItem;
        if (oldItem) {
            oldItem.isFocused = false;
        }
        const /** @type {?} */ newItem = this.items[visibleIndex];
        newItem.isFocused = true;
        this._focusedItem = newItem;
    }
    /**
     * @hidden
     * @param {?} e
     * @return {?}
     */
    onToggleOpening(e) {
        const /** @type {?} */ eventArgs = { cancel: false };
        this.onOpening.emit(eventArgs);
        e.cancel = eventArgs.cancel;
        if (eventArgs.cancel) {
            return;
        }
        this.combo.handleInputChange();
    }
    /**
     * @hidden
     * @return {?}
     */
    onToggleOpened() {
        this.combo.triggerCheck();
        this.combo.searchInput.nativeElement.focus();
        this.onOpened.emit();
    }
    /**
     * @hidden
     * @return {?}
     */
    onToggleClosed() {
        this.combo.comboInput.nativeElement.focus();
        this.onClosed.emit();
    }
    /**
     * @hidden
     * @param {?} e
     * @return {?}
     */
    onToggleClosing(e) {
        this.combo.searchValue = '';
        super.onToggleClosing(e);
        this._scrollPosition = this.verticalScrollContainer.getVerticalScroll().scrollTop;
    }
    /**
     * @hidden
     * @return {?}
     */
    updateScrollPosition() {
        this.verticalScrollContainer.getVerticalScroll().scrollTop = this._scrollPosition;
    }
    /**
     * @hidden
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy$.next(true);
        this.destroy$.complete();
    }
}
IgxComboDropDownComponent.decorators = [
    { type: Component, args: [{
                selector: 'igx-combo-drop-down',
                template: `<div class="igx-drop-down">
    <div class="igx-drop-down__list" igxToggle (onOpening)="onToggleOpening($event)" (onOpened)="onToggleOpened()" (onClosing)="onToggleClosing($event)" (onClosed)="onToggleClosed()">
        <ng-container *ngIf="!collapsed">
            <ng-content></ng-content>
        </ng-container>
    </div>
</div>`
            },] },
];
/** @nocollapse */
IgxComboDropDownComponent.ctorParameters = () => [
    { type: ElementRef, },
    { type: ChangeDetectorRef, },
    { type: IgxSelectionAPIService, },
    { type: IgxComboComponent, decorators: [{ type: Inject, args: [forwardRef(() => IgxComboComponent),] },] },
];
IgxComboDropDownComponent.propDecorators = {
    "verticalScrollContainer": [{ type: ContentChild, args: [forwardRef(() => IgxForOfDirective), { read: IgxForOfDirective },] },],
};
function IgxComboDropDownComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    IgxComboDropDownComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    IgxComboDropDownComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    IgxComboDropDownComponent.propDecorators;
    /** @type {?} */
    IgxComboDropDownComponent.prototype._children;
    /** @type {?} */
    IgxComboDropDownComponent.prototype._scrollPosition;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.destroy$;
    /**
     *  Event emitter overrides
     *
     * @hidden
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.onOpened;
    /**
     * @hidden
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.onOpening;
    /**
     * @hidden
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.onClosing;
    /**
     * @hidden
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.onClosed;
    /**
     * @hidden
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.verticalScrollContainer;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.elementRef;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.cdr;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.selection;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.combo;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vaWduaXRldWktYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb21iby9jb21iby1kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUMxQyxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFDakMsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFN0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFdEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDM0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDMUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQzs7OztBQWMvQixNQUFNLGdDQUFpQyxTQUFRLGVBQWU7Ozs7Ozs7SUFJMUQsWUFDYyxVQUFzQixFQUN0QixHQUFzQixFQUN0QixTQUFpQyxFQUVwQztRQUNQLEtBQUssQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBTHhCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsY0FBUyxHQUFULFNBQVMsQ0FBd0I7UUFFcEMsVUFBSyxHQUFMLEtBQUs7K0JBUFUsQ0FBQzt3QkFDUixJQUFJLE9BQU8sRUFBVzs7Ozs7O3dCQXFDdkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFROzs7O3lCQUtsQixJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVM7Ozs7eUJBS3BCLElBQUksQ0FBQyxLQUFLLENB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Q0FBQztRQUM1QyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ3hCOzs7Ozs7SUFLRCxlQUFlLENBQUMsQ0FBc0I7UUFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQzVCLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxTQUFTLENBQUM7S0FDckY7Ozs7O0lBS0Qsb0JBQW9CO1FBQ2hCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO0tBQ3JGOzs7OztJQUtNLFdBQVc7UUFDZCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDOzs7O1lBbFloQyxTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHFCQUFxQjtnQkFDL0IsUUFBUSxFQUFFOzs7Ozs7T0FNUDthQUNOOzs7O1lBdEJHLFVBQVU7WUFEVixpQkFBaUI7WUFRWixzQkFBc0I7WUFGdEIsaUJBQWlCLHVCQTBCakIsTUFBTSxTQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQzs7O3dDQW9EOUMsWUFBWSxTQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb250ZW50Q2hpbGQsXG4gICAgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgSW5qZWN0LCBRdWVyeUxpc3QsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSWd4RHJvcERvd25CYXNlLCBOYXZpZ2F0ZSB9IGZyb20gJy4uL2Ryb3AtZG93bi9kcm9wLWRvd24uY29tcG9uZW50JztcbmltcG9ydCB7IElneERyb3BEb3duSXRlbUJhc2UgfSBmcm9tICcuLi9kcm9wLWRvd24vZHJvcC1kb3duLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IElneENvbWJvQ29tcG9uZW50IH0gZnJvbSAnLi9jb21iby5jb21wb25lbnQnO1xuaW1wb3J0IHsgSWd4Q29tYm9JdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9jb21iby1pdGVtLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJZ3hTZWxlY3Rpb25BUElTZXJ2aWNlIH0gZnJvbSAnLi4vY29yZS9zZWxlY3Rpb24nO1xuaW1wb3J0IHsgSWd4Rm9yT2ZEaXJlY3RpdmUgfSBmcm9tICcuLi9kaXJlY3RpdmVzL2Zvci1vZi9mb3Jfb2YuZGlyZWN0aXZlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IENhbmNlbGFibGVFdmVudEFyZ3MgfSBmcm9tICcuLi9jb3JlL3V0aWxzJztcblxuLyoqIEBoaWRkZW4gKi9cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnaWd4LWNvbWJvLWRyb3AtZG93bicsXG4gICAgdGVtcGxhdGU6IGA8ZGl2IGNsYXNzPVwiaWd4LWRyb3AtZG93blwiPlxuICAgIDxkaXYgY2xhc3M9XCJpZ3gtZHJvcC1kb3duX19saXN0XCIgaWd4VG9nZ2xlIChvbk9wZW5pbmcpPVwib25Ub2dnbGVPcGVuaW5nKCRldmVudClcIiAob25PcGVuZWQpPVwib25Ub2dnbGVPcGVuZWQoKVwiIChvbkNsb3NpbmcpPVwib25Ub2dnbGVDbG9zaW5nKCRldmVudClcIiAob25DbG9zZWQpPVwib25Ub2dnbGVDbG9zZWQoKVwiPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWNvbGxhcHNlZFwiPlxuICAgICAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8L2Rpdj5cbjwvZGl2PmBcbn0pXG5leHBvcnQgY2xhc3MgSWd4Q29tYm9Ecm9wRG93bkNvbXBvbmVudCBleHRlbmRzIElneERyb3BEb3duQmFzZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gICAgcHJpdmF0ZSBfY2hpbGRyZW46IFF1ZXJ5TGlzdDxJZ3hEcm9wRG93bkl0ZW1CYXNlPjtcbiAgICBwcml2YXRlIF9zY3JvbGxQb3NpdGlvbiA9IDA7XG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByb3RlY3RlZCBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICBwcm90ZWN0ZWQgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJvdGVjdGVkIHNlbGVjdGlvbjogSWd4U2VsZWN0aW9uQVBJU2VydmljZSxcbiAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IElneENvbWJvQ29tcG9uZW50KSlcbiAgICAgICAgcHVibGljIGNvbWJvOiBJZ3hDb21ib0NvbXBvbmVudCkge1xuICAgICAgICBzdXBlcihlbGVtZW50UmVmLCBjZHIsIHNlbGVjdGlvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXQgc2Nyb2xsQ29udGFpbmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5kYy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0IGlzU2Nyb2xsZWRUb0xhc3QoKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5zY3JvbGxUb3A7XG4gICAgICAgIGNvbnN0IHNjcm9sbEhlaWdodCA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKHNjcm9sbFRvcCArIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuaWd4Rm9yQ29udGFpbmVyU2l6ZSkgPT09IHNjcm9sbEhlaWdodDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGxhc3RWaXNpYmxlSW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tYm8udG90YWxJdGVtQ291bnQgP1xuICAgICAgICAgICAgTWF0aC5mbG9vcih0aGlzLmNvbWJvLml0ZW1zTWF4SGVpZ2h0IC8gdGhpcy5jb21iby5pdGVtSGVpZ2h0KSA6XG4gICAgICAgICAgICB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogIEV2ZW50IGVtaXR0ZXIgb3ZlcnJpZGVzXG4gICAgICpcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcHVibGljIG9uT3BlbmVkID0gdGhpcy5jb21iby5vbk9wZW5lZDtcblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBwdWJsaWMgb25PcGVuaW5nID0gdGhpcy5jb21iby5vbk9wZW5pbmc7XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcHVibGljIG9uQ2xvc2luZyA9IHRoaXMuY29tYm8ub25DbG9zaW5nO1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHB1YmxpYyBvbkNsb3NlZCA9IHRoaXMuY29tYm8ub25DbG9zZWQ7XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgQENvbnRlbnRDaGlsZChmb3J3YXJkUmVmKCgpID0+IElneEZvck9mRGlyZWN0aXZlKSwgeyByZWFkOiBJZ3hGb3JPZkRpcmVjdGl2ZSB9KVxuICAgIHB1YmxpYyB2ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjogSWd4Rm9yT2ZEaXJlY3RpdmU8YW55PjtcblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0IGNoaWxkcmVuKCk6IFF1ZXJ5TGlzdDxJZ3hEcm9wRG93bkl0ZW1CYXNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbWJvLmNoaWxkcmVuO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzZXQgY2hpbGRyZW4obGlzdDogUXVlcnlMaXN0PElneERyb3BEb3duSXRlbUJhc2U+KSB7XG4gICAgICAgIHRoaXMuX2NoaWxkcmVuID0gbGlzdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Gb2N1cygpIHtcbiAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0gPSB0aGlzLl9mb2N1c2VkSXRlbSA/IHRoaXMuX2ZvY3VzZWRJdGVtIDogdGhpcy5pdGVtcy5sZW5ndGggPyB0aGlzLml0ZW1zWzBdIDogdGhpcy5jaGlsZHJlbi5maXJzdDtcbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzZWRJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c2VkSXRlbS5pc0ZvY3VzZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQmx1cihldnQ/KSB7XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c2VkSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0uaXNGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c2VkSXRlbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcHVibGljIGdldCBzZWxlY3RlZEl0ZW0oKTogYW55W10ge1xuICAgICAgICBjb25zdCBzZWwgPSB0aGlzLnNlbGVjdGlvbi5nZXQodGhpcy5jb21iby5pZCk7XG4gICAgICAgIHJldHVybiBzZWwgPyBBcnJheS5mcm9tKHNlbCkgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgbmF2aWdhdGVQcmV2KCkge1xuICAgICAgICBpZiAodGhpcy5fZm9jdXNlZEl0ZW0uaW5kZXggPT09IDAgJiYgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5zdGF0ZS5zdGFydEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmNvbWJvLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlUHJldigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG5hdmlnYXRlRmlyc3QoKSB7XG4gICAgICAgIGNvbnN0IHZDb250YWluZXIgPSB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyO1xuICAgICAgICBpZiAodkNvbnRhaW5lci5zdGF0ZS5zdGFydEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzSXRlbSgwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2Q29udGFpbmVyLnNjcm9sbFRvKDApO1xuICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNJdGVtKDApO1xuICAgICAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG5hdmlnYXRlTGFzdCgpIHtcbiAgICAgICAgY29uc3QgdkNvbnRhaW5lciA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXI7XG4gICAgICAgIGNvbnN0IHNjcm9sbFRhcmdldCA9IHRoaXMuY29tYm8udG90YWxJdGVtQ291bnQgP1xuICAgICAgICAgICAgdGhpcy5jb21iby50b3RhbEl0ZW1Db3VudCAtIDEgOlxuICAgICAgICAgICAgTWF0aC5tYXgodGhpcy5jb21iby5kYXRhLmxlbmd0aCAtIDEsIHZDb250YWluZXIuaWd4Rm9yT2YubGVuZ3RoIC0gMSk7XG4gICAgICAgIGlmICh2Q29udGFpbmVyLmlneEZvck9mLmxlbmd0aCA8PSB2Q29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXggKyB2Q29udGFpbmVyLnN0YXRlLmNodW5rU2l6ZSkge1xuICAgICAgICAgICAgdGhpcy5mb2N1c0l0ZW0odGhpcy5pdGVtcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2Q29udGFpbmVyLnNjcm9sbFRvKHNjcm9sbFRhcmdldCk7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTmV4dCh2Q29udGFpbmVyLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbWJvLnRyaWdnZXJDaGVjaygpO1xuICAgICAgICAgICAgdGhpcy5mb2N1c0l0ZW0odGhpcy5pdGVtcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIHRoaXMuY29tYm8udHJpZ2dlckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBwcml2YXRlIG5hdmlnYXRlUmVtb3RlSXRlbShkaXJlY3Rpb24pIHtcbiAgICAgICAgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5hZGRTY3JvbGxUb3AoZGlyZWN0aW9uICogdGhpcy5jb21iby5pdGVtSGVpZ2h0KTtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVOZXh0KHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IE5hdmlnYXRlLlVwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c0l0ZW0oMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNJdGVtKHRoaXMuZm9jdXNlZEl0ZW0uaW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgc2V0U2VsZWN0ZWRJdGVtKGl0ZW1JRDogYW55LCBzZWxlY3QgPSB0cnVlKSB7XG4gICAgICAgIHRoaXMuY29tYm8uc2V0U2VsZWN0ZWRJdGVtKGl0ZW1JRCwgc2VsZWN0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgc2VsZWN0SXRlbShpdGVtOiBJZ3hDb21ib0l0ZW1Db21wb25lbnQsIGV2ZW50PzogRXZlbnQpIHtcbiAgICAgICAgaWYgKGl0ZW0udmFsdWUgPT09ICdBREQgSVRFTScpIHtcbiAgICAgICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29tYm8uYWRkSXRlbVRvQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxlY3RlZEl0ZW0oaXRlbS5pdGVtSUQpO1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0gPSBpdGVtO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG5hdmlnYXRlSXRlbShuZXdJbmRleDogbnVtYmVyLCBkaXJlY3Rpb24/OiBudW1iZXIpIHtcbiAgICAgICAgLy8gVmlydHVhbCBzY3JvbGxpbmcgaG9sZHMgb25lIGhpZGRlbiBsb2FkZWQgZWxlbWVudCBhdCB0aGUgYm90dG9tIG9mIHRoZSBkcm9wIGRvd24gbGlzdC5cbiAgICAgICAgLy8gQXQgdGhlIHRvcCB0aGVyZSBpc24ndCBzdWNoIGEgaGlkZGVuIGVsZW1lbnQuXG4gICAgICAgIC8vIFRoYXQncyB3aHkgd2UgaG9sZCB0aGUgZmlyc3Qgb3IgdGhlIG9uZSBiZWZvcmUgdGhlIGxhc3QgbGlzdCBpdGVtIGFzIGZvY3VzZWQsIGR1cmluZyBrZXlib2FyZCBuYXZpZ2F0aW9uLlxuICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgaWYgd2Ugd2FudCB0byBmb2N1cyBuZXh0IGVsZW1lbnQsIGl0J3MgdGhlIGxhc3QgaGlkZGVuIGVsZW1lbnQgd2hlbiBzY3JvbGxpbmcgZG93blxuICAgICAgICAvLyBhbmQgd2hlbiBzY3JvbGxpbmcgdXAgaXQgaXMgbm90IGxvYWRlZCBhdCBhbGwuXG4gICAgICAgIC8vIEl0J3MgbW9yZSBzcGVjaWFsIGNhc2Ugd2hlbiBzcmNvbGxpbmcgZG93biBhbmQgdGhlIGhpZGRlbiBlbGVtZW50IGlzIGdyb3VwIGhlYWRlcixcbiAgICAgICAgLy8gd2hpY2ggaXMgbm90IHBhcnQgb2YgdGhlIHRoaXMuaXRlbXMgY29sbGVjdGlvbi5cbiAgICAgICAgLy8gSW4gdGhhdCBjYXNlIHRoZSByZWFsIGl0ZW0gaXMgbm90IGhpZGRlbiwgYnV0IG5vdCBsb2FkZWQgYXQgYWxsIGJ5IHRoZSB2aXJ0dWFsaXphdGlvbixcbiAgICAgICAgLy8gYW5kIHRoaXMgaXMgdGhlIHNhbWUgY2FzZSBhcyBub3JtYWwgc2Nyb2xsIHVwLlxuICAgICAgICBjb25zdCB2Q29udGFpbmVyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgY29uc3QgZXh0cmFTY3JvbGwgPSB0aGlzLmNvbWJvLmlzQWRkQnV0dG9uVmlzaWJsZSgpO1xuICAgICAgICBpZiAoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBOYXZpZ2F0ZS5Eb3duICYmIGV4dHJhU2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZDb250YWluZXIuaWd4Rm9yT2ZbdkNvbnRhaW5lci5pZ3hGb3JPZi5sZW5ndGggLSAxXSA9PT0gdGhpcy5mb2N1c2VkSXRlbS52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2N1c2VkSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbS5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtID0gdGhpcy5jaGlsZHJlbi5sYXN0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtLmlzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZDb250YWluZXIuaWd4Rm9yT2ZbdkNvbnRhaW5lci5zdGF0ZS5jaHVua1NpemUgKyB2Q29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXggLSAyXSA9PT1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbS52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEl0ZW0uaXNIZWFkZXIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Q29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXggKyB2Q29udGFpbmVyLnN0YXRlLmNodW5rU2l6ZSA8IHZDb250YWluZXIuaWd4Rm9yT2YubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxOZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2Q29udGFpbmVyLnNjcm9sbE5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3SW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRlVmlydHVhbEl0ZW0oZGlyZWN0aW9uLCBleHRyYVNjcm9sbCA/IDEgOiAwKTtcbiAgICAgICAgfSBlbHNlIGlmIChuZXdJbmRleCA9PT0gdGhpcy5sYXN0VmlzaWJsZUluZGV4ICYmICF0aGlzLmlzU2Nyb2xsZWRUb0xhc3QpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGVWaXJ0dWFsSXRlbShkaXJlY3Rpb24sIGV4dHJhU2Nyb2xsID8gMSA6IDApO1xuICAgICAgICB9IGVsc2UgaWYgKG5ld0luZGV4ID09PSB0aGlzLmxhc3RWaXNpYmxlSW5kZXggJiYgdGhpcy5pc1Njcm9sbGVkVG9MYXN0KSB7XG4gICAgICAgICAgICAvLyBXaGVuIGluaXRpYWxseSBzY3JvbGxpbmcgdG8gdGhlIGxhc3QgaXRlbSwgYSBwc2V1ZG8gZWxlbWVudCBpcyBwcmVzZW50IGluIHRoZSBjaGlsZHJlbiBsaXN0XG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGlmIHRoZSBlbGVtZW50IHdlJ3JlIG9uIGlzIGFuIGFjdHVhbCBlbGVtZW50IG9yIGFuIGVtcHR5ICdpZ3gtY29tYm8taXRlbScgY2hpbGRcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zW25ld0luZGV4XS5lbGVtZW50ICYmIHRoaXMuaXRlbXNbbmV3SW5kZXhdLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0obmV3SW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKG5ld0luZGV4KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbmF2aWdhdGVWaXJ0dWFsSXRlbShkaXJlY3Rpb246IE5hdmlnYXRlLCBleHRyYVNjcm9sbD86IG51bWJlcikge1xuICAgICAgICBjb25zdCB2Q29udGFpbmVyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgLy8gSWYgdGhlIGRhdGEgaXMgdml0dWFsaXplZCwgZGF0YS5sZW5ndGggPT09IHZDb250YWluZXIuY2h1bmtTaXplLCBzbyB0aGUgYmVsb3cgY2hlY2tzIGFyZSBuby1sb25nZXIgdmFsaWRcbiAgICAgICAgaWYgKHZDb250YWluZXIgJiYgdkNvbnRhaW5lci50b3RhbEl0ZW1Db3VudCAmJiB2Q29udGFpbmVyLnRvdGFsSXRlbUNvdW50ICE9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRlUmVtb3RlSXRlbShkaXJlY3Rpb24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzdGF0ZSA9IHZDb250YWluZXIuc3RhdGU7XG4gICAgICAgIGlmICh0aGlzLmlzU2Nyb2xsZWRUb0xhc3QgJiYgZGlyZWN0aW9uID09PSBOYXZpZ2F0ZS5Eb3duKSB7IC8vIElmIG9uIHRoZSBib3R0b20gbW9zdCBpdGVtLCBkbyBub3Qgc3Vic2NyaWJlXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgb24gdGhlIHRvcG1vc3QgaXRlbSwgZG8gbm90IHN1YnNjcmliZVxuICAgICAgICBpZiAodGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRWZXJ0aWNhbFNjcm9sbCgpLnNjcm9sbFRvcCA9PT0gMCAmJiBkaXJlY3Rpb24gPT09IE5hdmlnYXRlLlVwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNTY3JvbGxVcCA9IGRpcmVjdGlvbiA9PT0gTmF2aWdhdGUuVXA7XG4gICAgICAgIGxldCBuZXdTY3JvbGxTdGFydEluZGV4ID0gaXNTY3JvbGxVcCA/IHN0YXRlLnN0YXJ0SW5kZXggLSAxIDogc3RhdGUuc3RhcnRJbmRleCArIDE7XG4gICAgICAgIGlmIChuZXdTY3JvbGxTdGFydEluZGV4IDwgMCkge1xuICAgICAgICAgICAgbmV3U2Nyb2xsU3RhcnRJbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhdGEgPSB2Q29udGFpbmVyLmlneEZvck9mO1xuXG4gICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgbmV3SXRlbSA9IHRoaXMuY2hpbGRyZW4uZmlyc3Q7XG4gICAgICAgICAgICBpZiAoIW5ld0l0ZW0pIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICBuZXdJdGVtLmlzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c2VkSXRlbSA9IG5ld0l0ZW07XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRm9sbG93aW5nIHRoZSBiaWcgY29tbWVudCBhYm92ZSwgd2hlbiB0aGUgbmV3IGl0ZW0gaXMgZ3JvdXAgaGVhZGVyLCB0aGVuIHdlIG5lZWQgdG8gbG9hZCAyIGVsZW1lbnRzIGF0IG9uY2UuXG4gICAgICAgIGlmIChkYXRhW25ld1Njcm9sbFN0YXJ0SW5kZXhdLmlzSGVhZGVyICYmIGRpcmVjdGlvbiA9PT0gTmF2aWdhdGUuVXAgfHxcbiAgICAgICAgICAgIGRhdGFbbmV3U2Nyb2xsU3RhcnRJbmRleCArIHN0YXRlLmNodW5rU2l6ZSAtIDJdLmlzSGVhZGVyICYmIGRpcmVjdGlvbiA9PT0gTmF2aWdhdGUuRG93bikge1xuICAgICAgICAgICAgbmV3U2Nyb2xsU3RhcnRJbmRleCA9IGlzU2Nyb2xsVXAgPyBuZXdTY3JvbGxTdGFydEluZGV4IC0gMSA6IG5ld1Njcm9sbFN0YXJ0SW5kZXggKyAxO1xuICAgICAgICAgICAgLy8gbmV3U2Nyb2xsU3RhcnRJbmRleCA9IG1vZCAmJiBkaXJlY3Rpb24gPT09IE5hdmlnYXRlLkRvd24gPyBuZXdTY3JvbGxTdGFydEluZGV4ICsgMSA6IG5ld1Njcm9sbFN0YXJ0SW5kZXg7XG4gICAgICAgICAgICBpZiAobmV3U2Nyb2xsU3RhcnRJbmRleCA8IDApIHsgLy8gSWYgdGhlIG5leHQgaXRlbSBsb2FkZWQgaXMgYSBoZWFkZXIgYW5kIGlzIGFsc28gdGhlIHZlcnkgZmlyc3QgaXRlbSBpbiB0aGUgbGlzdC5cbiAgICAgICAgICAgICAgICB2Q29udGFpbmVyLnNjcm9sbFRvKDApOyAvLyBTY3JvbGxzIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGxpc3QgYW5kIHN3aXRjaGVzIGZvY3VzIHRvIHRoZSBzZWFyY2hJbnB1dFxuICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlTmV4dCh2Q29udGFpbmVyLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tYm8uc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2N1c2VkSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbS5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgaXQgaXMgdGhlIHZlcnkgbGFzdCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLCB3aGVuIG1vdmluZyBkb3duXG4gICAgICAgIGlmIChuZXdTY3JvbGxTdGFydEluZGV4ICsgc3RhdGUuY2h1bmtTaXplID09PSBkYXRhLmxlbmd0aCArIDEpIHtcbiAgICAgICAgICAgIHZDb250YWluZXIuc2Nyb2xsVG8obmV3U2Nyb2xsU3RhcnRJbmRleCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbyhuZXdTY3JvbGxTdGFydEluZGV4KTtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVOZXh0KHZDb250YWluZXIsICgpID0+IHtcbiAgICAgICAgICAgIHN0YXRlID0gdkNvbnRhaW5lci5zdGF0ZTtcbiAgICAgICAgICAgIGRhdGEgPSB2Q29udGFpbmVyLmlneEZvck9mO1xuXG4gICAgICAgICAgICAvLyBCZWNhdXNlIHdlIGFyZSBzdXJlIHRoYXQgaWYgd2Ugc2Nyb2xsIHVwIHRoZW4gdGhlIHRvcCBlbGVtZW50IGlzIG5vdCBhIGhlYWRlciwgdGhlbiB3ZSBmb2N1cyB0aGUgZmlyc3Qgb25lLlxuICAgICAgICAgICAgLy8gV2hlbiB3ZSBzY3JvbGwgZG93biwgaWYgdGhlIG5ld2x5IGxvYWRlZCBlbGVtZW50IHRoYXQgaXMgaGlkZGVuIGlzIGdyb3VwIGhlYWRlcixcbiAgICAgICAgICAgIC8vIHRoZW4gd2UgZm9jdXMgdGhlIGxhc3QgaXRlbSBmcm9tIHRoZSB0aGlzLml0ZW1zIGFycmF5LlxuICAgICAgICAgICAgLy8gVGhpcyBpcyBiZWNhdXNlIHRoZSB0aGlzLml0ZW1zIGRvZW5zJ3QgY29udGFpbnMgdGhlIGdyb3VwIGhlYWRlcnMsIHdoaWxlIHRoZXJlIGFyZSByZW5kZXJlZCBpbiB0aGUgY29tYm8gZHJvcCBkb3duLlxuICAgICAgICAgICAgLy8gSWYgdGhlIG5ld2x5IGxvYWRlZCBlbGVtZW50IHRoYXQgaXMgaGlkZGVuIGlzbid0IGEgaGVhZGVyLCB0aGlzIG1lYW5zIHRoYXQgdGhlIGZpcnN0IHZpc2libGUgaXRlbSwgdGhlIG9uZSB0aGF0IG5lZWRzIGZvY3VzLFxuICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGVpdGhlciB0aGUgb25lIHRoYXQgaXMgYmVmb3JlIHRoZSBsYXN0IGl0ZW0gKHRoaXMuaXRlbXMpLlxuICAgICAgICAgICAgY29uc3QgaXNCb3R0b21IaWRkZW5IZWFkZXIgPSBkYXRhW3N0YXRlLnN0YXJ0SW5kZXggKyBzdGF0ZS5jaHVua1NpemUgLSAxXS5pc0hlYWRlcjtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gaXNTY3JvbGxVcCA/IDAgOiBpc0JvdHRvbUhpZGRlbkhlYWRlciA/IHRoaXMuaXRlbXMubGVuZ3RoIC0gMSAtIGV4dHJhU2Nyb2xsIDogdGhpcy5pdGVtcy5sZW5ndGggLSAyIC0gZXh0cmFTY3JvbGw7XG5cbiAgICAgICAgICAgIHRoaXMuZm9jdXNJdGVtKGluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdWJzY3JpYmVOZXh0KHZpcnR1YWxDb250YWluZXI6IGFueSwgY2FsbGJhY2s6IChlbGVtPykgPT4gdm9pZCkge1xuICAgICAgICB2aXJ0dWFsQ29udGFpbmVyLm9uQ2h1bmtMb2FkLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgbmV4dDogKGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZvY3VzSXRlbSh2aXNpYmxlSW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCBvbGRJdGVtID0gdGhpcy5fZm9jdXNlZEl0ZW07XG4gICAgICAgIGlmIChvbGRJdGVtKSB7XG4gICAgICAgICAgICBvbGRJdGVtLmlzRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0l0ZW0gPSB0aGlzLml0ZW1zW3Zpc2libGVJbmRleF07XG4gICAgICAgIG5ld0l0ZW0uaXNGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0gPSBuZXdJdGVtO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvblRvZ2dsZU9wZW5pbmcoZTogQ2FuY2VsYWJsZUV2ZW50QXJncykge1xuICAgICAgICBjb25zdCBldmVudEFyZ3MgPSB7IGNhbmNlbDogZmFsc2UgfTtcbiAgICAgICAgdGhpcy5vbk9wZW5pbmcuZW1pdChldmVudEFyZ3MpO1xuICAgICAgICBlLmNhbmNlbCA9IGV2ZW50QXJncy5jYW5jZWw7XG4gICAgICAgIGlmIChldmVudEFyZ3MuY2FuY2VsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb21iby5oYW5kbGVJbnB1dENoYW5nZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvblRvZ2dsZU9wZW5lZCgpIHtcbiAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgdGhpcy5jb21iby5zZWFyY2hJbnB1dC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgIHRoaXMub25PcGVuZWQuZW1pdCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvblRvZ2dsZUNsb3NlZCgpIHtcbiAgICAgICAgdGhpcy5jb21iby5jb21ib0lucHV0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgdGhpcy5vbkNsb3NlZC5lbWl0KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uVG9nZ2xlQ2xvc2luZyhlOiBDYW5jZWxhYmxlRXZlbnRBcmdzKSB7XG4gICAgICAgIHRoaXMuY29tYm8uc2VhcmNoVmFsdWUgPSAnJztcbiAgICAgICAgc3VwZXIub25Ub2dnbGVDbG9zaW5nKGUpO1xuICAgICAgICB0aGlzLl9zY3JvbGxQb3NpdGlvbiA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5zY3JvbGxUb3A7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHVwZGF0ZVNjcm9sbFBvc2l0aW9uKCkge1xuICAgICAgICB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLmdldFZlcnRpY2FsU2Nyb2xsKCkuc2Nyb2xsVG9wID0gdGhpcy5fc2Nyb2xsUG9zaXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpAaGlkZGVuXG4gICAgICovXG4gICAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG59XG4iXX0=