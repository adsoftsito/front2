/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { CommonModule } from '@angular/common';
import { Directive, ElementRef, EventEmitter, Input, NgModule, Output, Pipe, Renderer2 } from '@angular/core';
var IgxFilterDirective = /** @class */ (function () {
    function IgxFilterDirective(element, renderer) {
        this.element = element;
        this.filtering = new EventEmitter(false);
        this.filtered = new EventEmitter();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    IgxFilterDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // Detect only changes of input value
        if (changes["filterOptions"] &&
            changes["filterOptions"].currentValue &&
            changes["filterOptions"].currentValue.inputValue !== undefined &&
            changes["filterOptions"].previousValue &&
            changes["filterOptions"].currentValue.inputValue !== changes["filterOptions"].previousValue.inputValue) {
            this.filter();
        }
    };
    /**
     * @return {?}
     */
    IgxFilterDirective.prototype.filter = /**
     * @return {?}
     */
    function () {
        if (!this.filterOptions.items) {
            return;
        }
        var /** @type {?} */ args = { cancel: false, items: this.filterOptions.items };
        this.filtering.emit(args);
        if (args.cancel) {
            return;
        }
        var /** @type {?} */ pipe = new IgxFilterPipe();
        var /** @type {?} */ filtered = pipe.transform(this.filterOptions.items, this.filterOptions);
        this.filtered.emit({ filteredItems: filtered });
    };
    IgxFilterDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[igxFilter]'
                },] },
    ];
    /** @nocollapse */
    IgxFilterDirective.ctorParameters = function () { return [
        { type: ElementRef, },
        { type: Renderer2, },
    ]; };
    IgxFilterDirective.propDecorators = {
        "filtering": [{ type: Output },],
        "filtered": [{ type: Output },],
        "filterOptions": [{ type: Input, args: ['igxFilter',] },],
    };
    return IgxFilterDirective;
}());
export { IgxFilterDirective };
function IgxFilterDirective_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    IgxFilterDirective.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    IgxFilterDirective.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    IgxFilterDirective.propDecorators;
    /** @type {?} */
    IgxFilterDirective.prototype.filtering;
    /** @type {?} */
    IgxFilterDirective.prototype.filtered;
    /** @type {?} */
    IgxFilterDirective.prototype.filterOptions;
    /** @type {?} */
    IgxFilterDirective.prototype.element;
}
var IgxFilterPipe = /** @class */ (function () {
    function IgxFilterPipe() {
    }
    /**
     * @param {?} items
     * @param {?} options
     * @return {?}
     */
    IgxFilterPipe.prototype.transform = /**
     * @param {?} items
     * @param {?} options
     * @return {?}
     */
    function (items, 
    // options - initial settings of filter functionality
    // options - initial settings of filter functionality
    options) {
        var /** @type {?} */ result = [];
        if (!items || !items.length || !options) {
            return;
        }
        if (options.items) {
            items = options.items;
        }
        result = items.filter(function (item) {
            var /** @type {?} */ match = options.matchFn(options.formatter(options.get_value(item, options.key)), options.inputValue);
            if (match) {
                if (options.metConditionFn) {
                    options.metConditionFn(item);
                }
            }
            else {
                if (options.overdueConditionFn) {
                    options.overdueConditionFn(item);
                }
            }
            return match;
        });
        return result;
    };
    IgxFilterPipe.decorators = [
        { type: Pipe, args: [{
                    name: 'igxFilter',
                    pure: false
                },] },
    ];
    return IgxFilterPipe;
}());
export { IgxFilterPipe };
function IgxFilterPipe_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    IgxFilterPipe.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    IgxFilterPipe.ctorParameters;
}
var IgxFilterOptions = /** @class */ (function () {
    function IgxFilterOptions() {
        this.inputValue = '';
    }
    /**
     * @param {?} item
     * @param {?} key
     * @return {?}
     */
    IgxFilterOptions.prototype.get_value = /**
     * @param {?} item
     * @param {?} key
     * @return {?}
     */
    function (item, key) {
        var /** @type {?} */ result = '';
        if (key) {
            result = item[key].toString();
        }
        else if (item.element) {
            if (item.element.nativeElement) {
                result = item.element.nativeElement.textContent.trim();
                // Check if element doesn't return the DOM element directly
            }
            else if (item.element.textContent) {
                result = item.element.textContent.trim();
            }
        }
        return result;
    };
    /**
     * @param {?} valueToTest
     * @return {?}
     */
    IgxFilterOptions.prototype.formatter = /**
     * @param {?} valueToTest
     * @return {?}
     */
    function (valueToTest) {
        return valueToTest.toLowerCase();
    };
    /**
     * @param {?} valueToTest
     * @param {?} inputValue
     * @return {?}
     */
    IgxFilterOptions.prototype.matchFn = /**
     * @param {?} valueToTest
     * @param {?} inputValue
     * @return {?}
     */
    function (valueToTest, inputValue) {
        return valueToTest.indexOf(inputValue && inputValue.toLowerCase() || '') > -1;
    };
    /**
     * @param {?} item
     * @return {?}
     */
    IgxFilterOptions.prototype.metConditionFn = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item.hasOwnProperty('hidden')) {
            item.hidden = false;
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    IgxFilterOptions.prototype.overdueConditionFn = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item.hasOwnProperty('hidden')) {
            item.hidden = true;
        }
    };
    return IgxFilterOptions;
}());
export { IgxFilterOptions };
function IgxFilterOptions_tsickle_Closure_declarations() {
    /** @type {?} */
    IgxFilterOptions.prototype.inputValue;
    /** @type {?} */
    IgxFilterOptions.prototype.key;
    /** @type {?} */
    IgxFilterOptions.prototype.items;
}
var IgxFilterModule = /** @class */ (function () {
    function IgxFilterModule() {
    }
    IgxFilterModule.decorators = [
        { type: NgModule, args: [{
                    declarations: [IgxFilterDirective, IgxFilterPipe],
                    exports: [IgxFilterDirective, IgxFilterPipe],
                    imports: [CommonModule]
                },] },
    ];
    return IgxFilterModule;
}());
export { IgxFilterModule };
function IgxFilterModule_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    IgxFilterModule.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    IgxFilterModule.ctorParameters;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lnbml0ZXVpLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9maWx0ZXIvZmlsdGVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFDSCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsUUFBUSxFQUVSLE1BQU0sRUFDTixJQUFJLEVBRUosU0FBUyxFQUVaLE1BQU0sZUFBZSxDQUFDOztJQVduQiw0QkFBb0IsT0FBbUIsRUFBRSxRQUFtQjtRQUF4QyxZQUFPLEdBQVAsT0FBTyxDQUFZO3lCQUxWLElBQUksWUFBWSxDQUFDLEtBQUssQ0FBQzt3QkFDeEIsSUFBSSxZQUFZLEVBQUU7S0FLN0M7Ozs7O0lBRU0sd0NBQVc7Ozs7Y0FBQyxPQUFzQjs7UUFFckMsRUFBRSxDQUFDLENBQUMsT0FBTztZQUNQLE9BQU8sa0JBQWUsWUFBWTtZQUNsQyxPQUFPLGtCQUFlLFlBQVksQ0FBQyxVQUFVLEtBQUssU0FBUztZQUMzRCxPQUFPLGtCQUFlLGFBQWE7WUFDbkMsT0FBTyxrQkFBZSxZQUFZLENBQUMsVUFBVSxLQUFLLE9BQU8sa0JBQWUsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDbkcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ2pCOzs7OztJQUdHLG1DQUFNOzs7O1FBQ1YsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDNUIsTUFBTSxDQUFDO1NBQ1Y7UUFFRCxxQkFBTSxJQUFJLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2hFLElBQUksQ0FBQyxT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b25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgICBEaXJlY3RpdmUsXG4gICAgRWxlbWVudFJlZixcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgSW5wdXQsXG4gICAgTmdNb2R1bGUsXG4gICAgT25DaGFuZ2VzLFxuICAgIE91dHB1dCxcbiAgICBQaXBlLFxuICAgIFBpcGVUcmFuc2Zvcm0sXG4gICAgUmVuZGVyZXIyLFxuICAgIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAnW2lneEZpbHRlcl0nXG59KVxuZXhwb3J0IGNsYXNzIElneEZpbHRlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBmaWx0ZXJpbmcgPSBuZXcgRXZlbnRFbWl0dGVyKGZhbHNlKTsgLy8gc3luY2hyb25vdXMgZXZlbnQgZW1pdHRlclxuICAgIEBPdXRwdXQoKSBwdWJsaWMgZmlsdGVyZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBASW5wdXQoJ2lneEZpbHRlcicpIHB1YmxpYyBmaWx0ZXJPcHRpb25zOiBJZ3hGaWx0ZXJPcHRpb25zO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmLCByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgfVxuXG4gICAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgLy8gRGV0ZWN0IG9ubHkgY2hhbmdlcyBvZiBpbnB1dCB2YWx1ZVxuICAgICAgICBpZiAoY2hhbmdlcy5maWx0ZXJPcHRpb25zICYmXG4gICAgICAgICAgICBjaGFuZ2VzLmZpbHRlck9wdGlvbnMuY3VycmVudFZhbHVlICYmXG4gICAgICAgICAgICBjaGFuZ2VzLmZpbHRlck9wdGlvbnMuY3VycmVudFZhbHVlLmlucHV0VmFsdWUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgY2hhbmdlcy5maWx0ZXJPcHRpb25zLnByZXZpb3VzVmFsdWUgJiZcbiAgICAgICAgICAgIGNoYW5nZXMuZmlsdGVyT3B0aW9ucy5jdXJyZW50VmFsdWUuaW5wdXRWYWx1ZSAhPT0gY2hhbmdlcy5maWx0ZXJPcHRpb25zLnByZXZpb3VzVmFsdWUuaW5wdXRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyKCkge1xuICAgICAgICBpZiAoIXRoaXMuZmlsdGVyT3B0aW9ucy5pdGVtcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXJncyA9IHsgY2FuY2VsOiBmYWxzZSwgaXRlbXM6IHRoaXMuZmlsdGVyT3B0aW9ucy5pdGVtcyB9O1xuICAgICAgICB0aGlzLmZpbHRlcmluZy5lbWl0KGFyZ3MpO1xuXG4gICAgICAgIGlmIChhcmdzLmNhbmNlbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGlwZSA9IG5ldyBJZ3hGaWx0ZXJQaXBlKCk7XG5cbiAgICAgICAgY29uc3QgZmlsdGVyZWQgPSBwaXBlLnRyYW5zZm9ybSh0aGlzLmZpbHRlck9wdGlvbnMuaXRlbXMsIHRoaXMuZmlsdGVyT3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZmlsdGVyZWQuZW1pdCh7IGZpbHRlcmVkSXRlbXM6IGZpbHRlcmVkIH0pO1xuICAgIH1cbn1cblxuQFBpcGUoe1xuICAgIG5hbWU6ICdpZ3hGaWx0ZXInLFxuICAgIHB1cmU6IGZhbHNlXG59KVxuXG5leHBvcnQgY2xhc3MgSWd4RmlsdGVyUGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuICAgIHB1YmxpYyB0cmFuc2Zvcm0oaXRlbXM6IGFueVtdLFxuICAgICAgICAgICAgICAgICAgICAgLy8gb3B0aW9ucyAtIGluaXRpYWwgc2V0dGluZ3Mgb2YgZmlsdGVyIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IElneEZpbHRlck9wdGlvbnMpIHtcblxuICAgICAgICBsZXQgcmVzdWx0ID0gW107XG5cbiAgICAgICAgaWYgKCFpdGVtcyB8fCAhaXRlbXMubGVuZ3RoIHx8ICFvcHRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5pdGVtcykge1xuICAgICAgICAgICAgaXRlbXMgPSBvcHRpb25zLml0ZW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzdWx0ID0gaXRlbXMuZmlsdGVyKChpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gb3B0aW9ucy5tYXRjaEZuKG9wdGlvbnMuZm9ybWF0dGVyKG9wdGlvbnMuZ2V0X3ZhbHVlKGl0ZW0sIG9wdGlvbnMua2V5KSksIG9wdGlvbnMuaW5wdXRWYWx1ZSk7XG5cbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1ldENvbmRpdGlvbkZuKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubWV0Q29uZGl0aW9uRm4oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5vdmVyZHVlQ29uZGl0aW9uRm4pIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5vdmVyZHVlQ29uZGl0aW9uRm4oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2g7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgSWd4RmlsdGVyT3B0aW9ucyB7XG4gICAgLy8gSW5wdXQgdGV4dCB2YWx1ZSB0aGF0IHdpbGwgYmUgdXNlZCBhcyBhIGZpbHRlcmluZyBwYXR0ZXJuIChtYXRjaGluZyBjb25kaXRpb24gaXMgYmFzZWQgb24gaXQpXG4gICAgcHVibGljIGlucHV0VmFsdWUgPSAnJztcblxuICAgIC8vIEl0ZW0gcHJvcGVydHksIHdoaWNoIHZhbHVlIHNob3VsZCBiZSB1c2VkIGZvciBmaWx0ZXJpbmdcbiAgICBwdWJsaWMga2V5OiBzdHJpbmc7XG5cbiAgICAvLyBSZXByZXNlbnQgaXRlbXMgb2YgdGhlIGxpc3QuIEl0IHNob3VsZCBiZSB1c2VkIHRvIGhhbmRsZSBkZWNhbGFyYXRldmVseSBkZWZpbmVkIHdpZGdldHNcbiAgICBwdWJsaWMgaXRlbXM6IGFueVtdO1xuXG4gICAgLy8gRnVuY3Rpb24gLSBnZXQgdmFsdWUgdG8gYmUgdGVzdGVkIGZyb20gdGhlIGl0ZW1cbiAgICAvLyBpdGVtIC0gc2luZ2xlIGl0ZW0gb2YgdGhlIGxpc3QgdG8gYmUgZmlsdGVyZWRcbiAgICAvLyBrZXkgLSBwcm9wZXJ0eSBuYW1lIG9mIGl0ZW0sIHdoaWNoIHZhbHVlIHNob3VsZCBiZSB0ZXN0ZWRcbiAgICAvLyBEZWZhdWx0IGJlaGF2aW9yIC0gcmV0dXJucyBcImtleVwiLSBuYW1lZCBwcm9wZXJ0eSB2YWx1ZSBvZiBpdGVtIGlmIGtleSBzaSBwcm92aWRlZCxcbiAgICAvLyBvdGhlcndpc2UgdGV4dENvbnRlbnQgb2YgdGhlIGl0ZW0ncyBodG1sIGVsZW1lbnRcbiAgICBwdWJsaWMgZ2V0X3ZhbHVlKGl0ZW06IGFueSwga2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgcmVzdWx0ID0gJyc7XG5cbiAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaXRlbVtrZXldLnRvU3RyaW5nKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbS5lbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudC50ZXh0Q29udGVudC50cmltKCk7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBlbGVtZW50IGRvZXNuJ3QgcmV0dXJuIHRoZSBET00gZWxlbWVudCBkaXJlY3RseVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmVsZW1lbnQudGV4dENvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBpdGVtLmVsZW1lbnQudGV4dENvbnRlbnQudHJpbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiAtIGZvcm1hdHMgdGhlIG9yaWdpbmFsIHRleHQgYmVmb3JlIG1hdGNoaW5nIHByb2Nlc3NcbiAgICAvLyBEZWZhdWx0IGJlaGF2aW9yIC0gcmV0dXJucyB0ZXh0IHRvIGxvd2VyIGNhc2VcbiAgICBwdWJsaWMgZm9ybWF0dGVyKHZhbHVlVG9UZXN0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdmFsdWVUb1Rlc3QudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiAtIGRldGVybWluZXMgd2hldGhlciB0aGUgaXRlbSBtZXQgdGhlIGNvbmRpdGlvblxuICAgIC8vIHZhbHVlVG9UZXN0IC0gdGV4dCB2YWx1ZSB0aGF0IHNob3VsZCBiZSB0ZXN0ZWRcbiAgICAvLyBpbnB1dFZhbHVlIC0gdGV4dCB2YWx1ZSBmcm9tIGlucHV0IHRoYXQgY29uZGl0aW9uIGlzIGJhc2VkIG9uXG4gICAgLy8gRGVmYXVsdCBiZWhhdmlvciAtIFwiY29udGFpbnNcIlxuICAgIHB1YmxpYyBtYXRjaEZuKHZhbHVlVG9UZXN0OiBzdHJpbmcsIGlucHV0VmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdmFsdWVUb1Rlc3QuaW5kZXhPZihpbnB1dFZhbHVlICYmIGlucHV0VmFsdWUudG9Mb3dlckNhc2UoKSB8fCAnJykgPiAtMTtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiAtIGV4ZWN1dGVkIGFmdGVyIG1hdGNoaW5nIHRlc3QgZm9yIGV2ZXJ5IG1hdGNoZWQgaXRlbVxuICAgIC8vIERlZmF1bHQgYmVoYXZpb3IgLSBzaG93cyB0aGUgaXRlbVxuICAgIHB1YmxpYyBtZXRDb25kaXRpb25GbihpdGVtOiBhbnkpIHtcbiAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoJ2hpZGRlbicpKSB7XG4gICAgICAgICAgICBpdGVtLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gRnVuY3Rpb24gLSBleGVjdXRlZCBmb3IgZXZlcnkgTk9UIG1hdGNoZWQgaXRlbSBhZnRlciBtYXRjaGluZyB0ZXN0XG4gICAgLy8gRGVmYXVsdCBiZWhhdmlvciAtIGhpZGVzIHRoZSBpdGVtXG4gICAgcHVibGljIG92ZXJkdWVDb25kaXRpb25GbihpdGVtOiBhbnkpIHtcbiAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoJ2hpZGRlbicpKSB7XG4gICAgICAgICAgICBpdGVtLmhpZGRlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbkBOZ01vZHVsZSh7XG4gICAgZGVjbGFyYXRpb25zOiBbSWd4RmlsdGVyRGlyZWN0aXZlLCBJZ3hGaWx0ZXJQaXBlXSxcbiAgICBleHBvcnRzOiBbSWd4RmlsdGVyRGlyZWN0aXZlLCBJZ3hGaWx0ZXJQaXBlXSxcbiAgICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXVxufSlcbmV4cG9ydCBjbGFzcyBJZ3hGaWx0ZXJNb2R1bGUge1xufVxuIl19